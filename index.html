<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Screwdriver Economy: Vietnam's $475 Billion Export Model</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&family=Source+Serif+4:ital,opsz,wght@0,8..60,300;0,8..60,400;0,8..60,600;1,8..60,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --red: #DA251D;
    --gold: #F2C94C;
    --dark: #1A1A1A;
    --cream: #FAF7F2;
    --slate: #4A4A4A;
    --light-gray: #E8E4DF;
    --accent-green: #2D6A4F;
    --accent-blue: #1B4965;
    --warning: #E67E22;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  html {
    scroll-behavior: smooth;
    overflow-x: hidden;
  }

  body {
    font-family: 'Source Serif 4', Georgia, serif;
    background: var(--cream);
    color: var(--dark);
    line-height: 1.7;
    font-size: 18px;
  }

  .hero {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    background: var(--dark);
    color: var(--cream);
    position: relative;
    overflow: hidden;
    padding: 2rem;
  }

  .hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background:
      radial-gradient(ellipse at 20% 50%, rgba(218,37,29,0.15) 0%, transparent 60%),
      radial-gradient(ellipse at 80% 50%, rgba(242,201,76,0.1) 0%, transparent 60%);
    pointer-events: none;
  }

  .hero-star {
    font-size: 4rem;
    color: var(--gold);
    margin-bottom: 1.5rem;
    opacity: 0;
    animation: fadeInDown 1s ease 0.3s forwards;
  }

  .hero h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2.5rem, 6vw, 5rem);
    font-weight: 900;
    line-height: 1.1;
    letter-spacing: -0.02em;
    max-width: 900px;
    opacity: 0;
    animation: fadeInUp 1s ease 0.5s forwards;
  }

  .hero h1 em {
    color: var(--gold);
    font-style: italic;
  }

  .hero-subtitle {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.85rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-top: 2rem;
    color: rgba(250,247,242,0.5);
    opacity: 0;
    animation: fadeInUp 1s ease 0.8s forwards;
  }

  .hero-hook {
    font-family: 'Source Serif 4', serif;
    font-size: 1.15rem;
    max-width: 650px;
    margin-top: 1.5rem;
    color: rgba(250,247,242,0.7);
    opacity: 0;
    animation: fadeInUp 1s ease 1s forwards;
    line-height: 1.6;
  }

  .hero-framework {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-top: 2.5rem;
    padding: 0.5rem 1rem;
    border: 1px solid rgba(242,201,76,0.3);
    border-radius: 3px;
    color: var(--gold);
    opacity: 0;
    animation: fadeInUp 1s ease 1.2s forwards;
  }

  .hero-scroll-cue {
    position: absolute;
    bottom: 2.5rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    color: rgba(250,247,242,0.35);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    animation: pulse 2s ease-in-out infinite;
  }

  .hero-scroll-cue::after {
    content: '';
    font-size: 1.2rem;
  }

  .section {
    max-width: 720px;
    margin: 0 auto;
    padding: 5rem 2rem;
  }

  .section-wide {
    max-width: 960px;
    margin: 0 auto;
    padding: 5rem 2rem;
  }

  .section-full {
    width: 100%;
    padding: 5rem 2rem;
  }

  .reveal {
    opacity: 0;
    transform: translateY(40px);
    transition: opacity 0.8s ease, transform 0.8s ease;
  }

  .reveal.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .reveal-delay-1 { transition-delay: 0.15s; }
  .reveal-delay-2 { transition-delay: 0.3s; }
  .reveal-delay-3 { transition-delay: 0.45s; }
  .reveal-delay-4 { transition-delay: 0.6s; }

  h2 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(1.8rem, 4vw, 2.6rem);
    font-weight: 900;
    line-height: 1.2;
    margin-bottom: 1.25rem;
    letter-spacing: -0.01em;
  }

  h3 {
    font-family: 'Playfair Display', serif;
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 0.75rem;
  }

  p {
    margin-bottom: 1.1rem;
    color: var(--slate);
  }

  .lead {
    font-size: 1.15rem;
    line-height: 1.75;
    color: var(--dark);
  }

  .chapter-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.72rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--red);
    margin-bottom: 0.6rem;
    display: block;
  }

  .framework-badge {
    display: inline-block;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    font-weight: 500;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    background: var(--red);
    color: white;
    padding: 0.2rem 0.5rem;
    border-radius: 2px;
    margin-right: 0.5rem;
    vertical-align: middle;
  }

  .framework-badge.gold {
    background: var(--gold);
    color: var(--dark);
  }

  .dropcap::first-letter {
    float: left;
    font-family: 'Playfair Display', serif;
    font-size: 4rem;
    font-weight: 900;
    line-height: 0.8;
    margin-right: 0.1em;
    color: var(--red);
  }

  .stat-banner {
    background: var(--dark);
    color: var(--cream);
    padding: 4rem 2rem;
    text-align: center;
  }

  .stat-row {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 2.5rem;
    max-width: 1000px;
    margin: 0 auto;
  }

  .stat-item {
    flex: 1;
    min-width: 150px;
  }

  .stat-number {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2rem, 4vw, 3.2rem);
    font-weight: 900;
    color: var(--gold);
    display: block;
  }

  .stat-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.68rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: rgba(250,247,242,0.6);
    margin-top: 0.4rem;
    display: block;
  }

  .chart-container {
    margin: 2rem 0;
    padding: 1.75rem;
    background: white;
    border-radius: 4px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    border: 1px solid var(--light-gray);
  }

  .chart-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 0.2rem;
  }

  .chart-subtitle {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.68rem;
    color: #999;
    letter-spacing: 0.05em;
    margin-bottom: 1.25rem;
  }

  .bar-chart .bar-row {
    display: flex;
    align-items: center;
    margin-bottom: 0.65rem;
  }

  .bar-label {
    width: 85px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.72rem;
    color: var(--slate);
    text-align: right;
    padding-right: 0.85rem;
    flex-shrink: 0;
  }

  .bar-track {
    flex: 1;
    height: 26px;
    background: var(--light-gray);
    border-radius: 2px;
    overflow: hidden;
    position: relative;
  }

  .bar-fill {
    height: 100%;
    border-radius: 2px;
    width: 0%;
    transition: width 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    display: flex;
    align-items: center;
    padding-left: 0.5rem;
  }

  .bar-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.68rem;
    font-weight: 500;
    color: white;
    white-space: nowrap;
    margin-left: 0.4rem;
  }

  .bar-value-outside {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.68rem;
    font-weight: 500;
    color: var(--slate);
    margin-left: 0.5rem;
    white-space: nowrap;
  }

  .timeline {
    position: relative;
    padding-left: 3rem;
    margin: 2.5rem 0;
  }

  .timeline::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: linear-gradient(to bottom, var(--red), var(--gold));
  }

  .timeline-item {
    position: relative;
    margin-bottom: 2rem;
    padding-bottom: 0.5rem;
  }

  .timeline-item::before {
    content: '';
    position: absolute;
    left: -3.4rem;
    top: 0.35rem;
    width: 14px;
    height: 14px;
    background: var(--red);
    border-radius: 50%;
    border: 3px solid var(--cream);
    box-shadow: 0 0 0 2px var(--red);
  }

  .timeline-year {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1rem;
    font-weight: 600;
    color: var(--red);
    margin-bottom: 0.4rem;
    letter-spacing: 0.02em;
  }

  .timeline-text {
    font-size: 1.05rem;
    color: var(--slate);
    line-height: 1.65;
  }

  .pull-quote {
    border-left: 4px solid var(--red);
    padding: 1.25rem 1.75rem;
    margin: 2rem 0;
    background: white;
  }

  .pull-quote p {
    font-family: 'Playfair Display', serif;
    font-size: 1.2rem;
    font-style: italic;
    line-height: 1.45;
    color: var(--dark);
    margin-bottom: 0.4rem;
  }

  .pull-quote cite {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    font-style: normal;
    color: #999;
    letter-spacing: 0.05em;
  }

  .comparison-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.25rem;
    margin: 1.75rem 0;
  }

  .comparison-card {
    background: white;
    padding: 1.5rem;
    border-radius: 4px;
    border: 1px solid var(--light-gray);
    box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .comparison-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }

  .comparison-card .stat-number {
    color: var(--red);
    font-size: 1.9rem;
  }

  .comparison-card.warning .stat-number {
    color: var(--warning);
  }

  .comparison-card h3 {
    font-size: 1rem;
    margin-bottom: 0.4rem;
  }

  .comparison-card p {
    font-size: 0.85rem;
    margin-bottom: 0;
    line-height: 1.5;
  }

  .donut-section {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 2.5rem;
    margin: 1.75rem 0;
  }

  .donut-chart {
    width: 200px;
    height: 200px;
    flex-shrink: 0;
  }

  .donut-legend {
    flex: 1;
    min-width: 180px;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 0.65rem;
    margin-bottom: 0.6rem;
  }

  .legend-color {
    width: 12px;
    height: 12px;
    border-radius: 2px;
    flex-shrink: 0;
  }

  .legend-label {
    font-size: 0.85rem;
    color: var(--slate);
  }

  .legend-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    font-weight: 500;
    margin-left: auto;
  }

  .insight-box {
    background: linear-gradient(135deg, var(--dark) 0%, #2a2a2a 100%);
    color: var(--cream);
    padding: 1.75rem;
    border-radius: 4px;
    margin: 2rem 0;
    border-left: 4px solid var(--gold);
  }

  .insight-box h4 {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 0.75rem;
  }

  .insight-box p {
    color: rgba(250,247,242,0.85);
    margin-bottom: 0;
    font-size: 0.95rem;
  }

  .insight-box-light {
    background: linear-gradient(135deg, var(--cream) 0%, #f5f0e6 100%);
    color: var(--dark);
    border-left-color: var(--accent-green);
  }

  .insight-box-light h4 {
    color: var(--accent-green);
  }

  .insight-box-light p {
    color: rgba(30,30,30,0.85);
  }

  .insight-box-light a {
    color: var(--accent-green) !important;
    text-decoration: underline !important;
  }

  .divider {
    text-align: center;
    padding: 2rem 0;
  }

  .divider::before {
    content: '';
    color: var(--red);
    font-size: 1.25rem;
  }

  .dual-column {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    margin: 1.5rem 0;
  }

  @media (max-width: 700px) {
    .dual-column { grid-template-columns: 1fr; }
  }

  .data-table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5rem 0;
    font-size: 0.88rem;
  }

  .data-table th, .data-table td {
    padding: 0.65rem 0.85rem;
    text-align: left;
    border-bottom: 1px solid var(--light-gray);
  }

  .data-table th {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.68rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #888;
    font-weight: 500;
  }

  .data-table td {
    color: var(--slate);
  }

  .data-table .highlight {
    font-weight: 600;
    color: var(--dark);
  }

  .data-table .red { color: var(--red); }
  .data-table .warning { color: var(--warning); }

  .footer {
    background: var(--dark);
    color: rgba(250,247,242,0.5);
    padding: 2.5rem 2rem;
    text-align: center;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.05em;
    line-height: 2;
  }

  .footer a {
    color: var(--gold);
    text-decoration: none;
  }

  .sources-section {
    background: #f5f3ee;
    padding: 2rem;
    margin-top: 2rem;
    border-radius: 4px;
  }

  .sources-section h4 {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: #888;
    margin-bottom: 0.75rem;
  }

  .sources-section h5 {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.62rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--red);
    margin-top: 1rem;
    margin-bottom: 0.4rem;
  }

  .sources-section p {
    font-size: 0.72rem;
    line-height: 1.9;
    color: #777;
    margin-bottom: 0;
  }

  .progress-bar {
    position: fixed;
    top: 0;
    left: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--red), var(--gold));
    width: 0%;
    z-index: 1000;
    transition: width 0.1s linear;
  }

  .equation-box {
    background: white;
    border: 1px solid var(--light-gray);
    border-left: 4px solid var(--red);
    padding: 1.25rem 1.5rem;
    margin: 1.5rem 0;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.9rem;
  }

  .equation-box .equation {
    font-size: 1.1rem;
    color: var(--dark);
    margin-bottom: 0.5rem;
  }

  .equation-box .explanation {
    font-size: 0.75rem;
    color: #777;
  }

  /* Collapsible Sidebar Styles */
  .collapsible-sidebar {
    background: linear-gradient(135deg, var(--dark) 0%, #2a2a2a 100%);
    color: var(--cream);
    border-radius: 4px;
    margin: 1.5rem 0;
    border-left: 4px solid var(--gold);
    overflow: hidden;
  }

  .collapsible-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.9rem 1.25rem;
    cursor: pointer;
    transition: background 0.2s ease;
  }

  .collapsible-header:hover {
    background: rgba(255,255,255,0.03);
  }

  .collapsible-header h4 {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--gold);
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .collapsible-header h4::before {
    content: '?';
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 18px;
    height: 18px;
    background: var(--gold);
    color: var(--dark);
    border-radius: 50%;
    font-size: 0.65rem;
    font-weight: 700;
  }

  .collapsible-toggle {
    font-size: 0.7rem;
    color: rgba(250,247,242,0.5);
    transition: transform 0.3s ease;
  }

  .collapsible-sidebar.open .collapsible-toggle {
    transform: rotate(180deg);
  }

  .collapsible-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease, padding 0.3s ease;
  }

  .collapsible-sidebar.open .collapsible-content {
    max-height: 500px;
    padding: 0 1.25rem 1.25rem;
  }

  .collapsible-content p {
    color: rgba(250,247,242,0.85);
    margin-bottom: 0;
    font-size: 0.9rem;
    line-height: 1.65;
  }

  .collapsible-content a {
    color: var(--gold);
    text-decoration: underline;
  }

  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeInDown {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes pulse {
    0%, 100% { opacity: 0.35; }
    50% { opacity: 0.7; }
  }

  @keyframes pulseGlow {
    0%, 100% { box-shadow: 0 0 20px rgba(242,201,76,0.3); }
    50% { box-shadow: 0 0 40px rgba(242,201,76,0.6); }
  }

  @keyframes drawLine {
    to { stroke-dashoffset: 0; }
  }

  @keyframes fadeInUpInterstitial {
    from { opacity: 0; transform: translateY(60px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes dropBounce {
    0% { transform: translateY(-50px); opacity: 0; }
    60% { transform: translateY(5px); opacity: 1; }
    80% { transform: translateY(-3px); }
    100% { transform: translateY(0); }
  }

  @keyframes countPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
  }

  .count-up {
    font-variant-numeric: tabular-nums;
  }

  /* Sticky Export Counter */
  .sticky-counter {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(26, 26, 26, 0.95);
    backdrop-filter: blur(10px);
    padding: 14px 20px;
    border-radius: 8px;
    z-index: 999;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 4px;
    opacity: 0;
    transform: translateY(-20px);
    transition: opacity 0.5s ease, transform 0.5s ease;
    border: 1px solid rgba(242, 201, 76, 0.3);
    min-width: 180px;
  }

  .sticky-counter.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .sticky-counter.pulsing {
    animation: pulseGlow 2s ease-in-out infinite;
  }

  .sticky-counter-header {
    display: flex;
    align-items: center;
    gap: 6px;
    width: 100%;
    justify-content: space-between;
  }

  .sticky-counter-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: rgba(250, 247, 242, 0.5);
  }

  .sticky-counter-era {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.05em;
    color: var(--gold);
    opacity: 0.8;
  }

  .sticky-counter-main {
    display: flex;
    align-items: baseline;
    gap: 8px;
    width: 100%;
    justify-content: flex-end;
  }

  .sticky-counter-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.6rem;
    font-weight: 500;
    color: var(--gold);
    font-variant-numeric: tabular-nums;
  }

  .sticky-counter-context {
    font-family: 'Source Serif 4', serif;
    font-size: 0.65rem;
    color: rgba(250, 247, 242, 0.4);
    font-style: italic;
  }

  .sticky-counter-question {
    color: var(--gold);
    font-size: 1rem;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .sticky-counter.pulsing .sticky-counter-question {
    opacity: 1;
  }

  .sticky-counter-subtitle {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.5rem;
    color: rgba(250, 247, 242, 0.35);
    text-align: right;
    margin-top: 2px;
  }

  /* Section Navigation Dots */
  .section-nav {
    position: fixed;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 998;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .section-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(26, 26, 26, 0.2);
    border: 2px solid var(--dark);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
  }

  .section-dot::before {
    content: attr(data-tooltip);
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    background: var(--dark);
    color: var(--cream);
    padding: 4px 10px;
    border-radius: 4px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }

  .section-dot:hover::before {
    opacity: 1;
  }

  .section-dot:hover {
    transform: scale(1.3);
  }

  .section-dot.active {
    background: var(--red);
    border-color: var(--red);
  }

  /* Interstitial Shock Stats */
  .interstitial {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    background: var(--dark);
    padding: 4rem 2rem;
    position: relative;
    overflow: hidden;
  }

  .interstitial::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse at center, rgba(218,37,29,0.08) 0%, transparent 70%);
    pointer-events: none;
  }

  .interstitial-content {
    max-width: 800px;
    opacity: 0;
    transform: translateY(60px);
    transition: opacity 1s ease, transform 1s ease;
  }

  .interstitial-content.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .interstitial-stat {
    font-family: 'Playfair Display', serif;
    font-size: clamp(1.8rem, 4vw, 2.8rem);
    font-style: italic;
    font-weight: 400;
    line-height: 1.4;
    color: var(--cream);
    margin-bottom: 1.5rem;
  }

  .interstitial-stat em {
    color: var(--gold);
    font-style: normal;
  }

  .interstitial-context {
    font-family: 'Source Serif 4', serif;
    font-size: 1.1rem;
    color: rgba(250, 247, 242, 0.5);
    max-width: 600px;
    margin: 0 auto;
    text-align: center;
  }

  /* Parallax Star Background */
  .parallax-star {
    position: absolute;
    font-size: 40rem;
    color: var(--gold);
    opacity: 0.05;
    pointer-events: none;
    z-index: 0;
    transform: translate(-50%, -50%);
    left: 50%;
    top: 50%;
  }

  .parallax-dots {
    position: absolute;
    inset: 0;
    background-image: radial-gradient(rgba(26, 26, 26, 0.03) 1px, transparent 1px);
    background-size: 30px 30px;
    pointer-events: none;
    z-index: 0;
  }

  /* Sankey Flow Diagram */
  .sankey-container {
    margin: 2.5rem 0;
    padding: 2rem;
    background: white;
    border-radius: 4px;
    border: 1px solid var(--light-gray);
    overflow-x: auto;
  }

  .sankey-svg {
    width: 100%;
    min-width: 700px;
    height: 400px;
  }

  .sankey-path {
    fill: none;
    stroke-linecap: round;
  }

  .sankey-path-import {
    stroke: var(--gold);
    opacity: 0.7;
  }

  .sankey-path-export {
    stroke: var(--red);
    opacity: 0.7;
  }

  .sankey-node {
    fill: var(--cream);
    stroke: var(--dark);
    stroke-width: 2;
  }

  .sankey-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    fill: var(--slate);
  }

  .sankey-center-label {
    font-family: 'Playfair Display', serif;
    font-size: 14px;
    font-weight: 700;
    fill: var(--dark);
  }

  .sankey-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    fill: var(--slate);
  }

  /* Solow Curve */
  .solow-container {
    margin: 2rem 0;
    padding: 2rem;
    background: white;
    border-radius: 4px;
    border: 1px solid var(--light-gray);
  }

  .solow-svg {
    width: 100%;
    max-width: 600px;
    height: 350px;
    margin: 0 auto;
    display: block;
  }

  .solow-axis {
    stroke: var(--slate);
    stroke-width: 1;
  }

  .solow-curve {
    fill: none;
    stroke: var(--dark);
    stroke-width: 3;
  }

  .solow-curve-ghost {
    fill: none;
    stroke: #999;
    stroke-width: 2;
    stroke-dasharray: 5 5;
    opacity: 0.5;
  }

  .solow-curve-tfp {
    fill: none;
    stroke: var(--accent-green);
    stroke-width: 2;
    stroke-dasharray: 8 4;
  }

  .solow-dot {
    fill: var(--red);
    stroke: white;
    stroke-width: 2;
  }

  .solow-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    fill: var(--slate);
  }

  .solow-axis-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    fill: #999;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  /* Demographic Ring */
  .demo-ring-container {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    gap: 3rem;
    margin: 2rem 0;
    padding: 2rem;
    background: white;
    border-radius: 4px;
    border: 1px solid var(--light-gray);
  }

  .demo-ring-svg {
    width: 220px;
    height: 220px;
  }

  .demo-ring-track {
    fill: none;
    stroke: var(--light-gray);
    stroke-width: 20;
  }

  .demo-ring-fill {
    fill: none;
    stroke: var(--gold);
    stroke-width: 20;
    stroke-linecap: round;
    transform: rotate(-90deg);
    transform-origin: 150px 130px;
    stroke-dasharray: 0 597;
    transition: stroke-dasharray 1.5s ease-out;
  }

  .demo-ring-center {
    font-family: 'Playfair Display', serif;
    font-size: 28px;
    font-weight: 900;
    fill: var(--dark);
  }

  .demo-ring-subtitle {
    font-family: 'Source Serif 4', serif;
    font-size: 11px;
    fill: var(--slate);
  }

  .demo-ring-info {
    max-width: 280px;
  }

  .demo-ring-info p {
    font-size: 0.9rem;
    margin-bottom: 0.8rem;
  }

  .demo-ring-ticks {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    fill: var(--slate);
  }

  /* Vietnam Map */
  .vietnam-map-container {
    margin: 2rem 0;
    padding: 2rem;
    background: white;
    border-radius: 4px;
    border: 1px solid var(--light-gray);
    position: relative;
  }

  .vietnam-map-svg {
    width: 100%;
    max-width: 450px;
    height: auto;
    margin: 0 auto;
    display: block;
  }

  .map-pin {
    cursor: pointer;
    opacity: 1;
    transform-origin: center bottom;
  }

  .map-pin.animate-in {
    opacity: 0;
  }

  .map-pin.animate-in.visible {
    animation: dropBounce 0.6s ease forwards;
  }

  .map-pin-marker {
    fill: var(--red);
    stroke: white;
    stroke-width: 2;
    transition: transform 0.2s ease, r 0.2s ease;
  }

  .map-pin:hover .map-pin-marker {
    transform: scale(1.2);
  }

  .map-pin-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    fill: var(--gold);
    font-weight: 500;
  }

  .pulse-ring {
    animation: pulseRing 2s ease-out infinite;
  }

  @keyframes pulseRing {
    0% { opacity: 0.6; transform: scale(1); }
    100% { opacity: 0; transform: scale(2); }
  }

  .map-legend-item {
    transition: background 0.2s ease;
    border-radius: 4px;
    margin: 0 -0.25rem;
    padding-left: 0.25rem !important;
    padding-right: 0.25rem !important;
  }

  .map-legend-item:hover {
    background: rgba(218,37,29,0.05);
  }

  .map-tooltip {
    position: absolute;
    background: var(--dark);
    color: var(--cream);
    padding: 10px 14px;
    border-radius: 4px;
    font-size: 0.75rem;
    max-width: 220px;
    z-index: 100;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }

  .map-tooltip.visible {
    opacity: 1;
  }

  .map-tooltip-title {
    font-family: 'JetBrains Mono', monospace;
    font-weight: 500;
    color: var(--gold);
    margin-bottom: 4px;
  }

  /* Racing Bar Chart */
  .racing-bar-container {
    margin: 2rem 0;
    padding: 2rem;
    background: white;
    border-radius: 4px;
    border: 1px solid var(--light-gray);
  }

  .racing-bar-chart {
    position: relative;
  }

  .racing-bar-row {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
    position: relative;
  }

  .racing-bar-label {
    width: 90px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.72rem;
    color: var(--slate);
    text-align: right;
    padding-right: 1rem;
    flex-shrink: 0;
  }

  .racing-bar-track {
    flex: 1;
    height: 32px;
    background: var(--light-gray);
    border-radius: 2px;
    overflow: hidden;
    position: relative;
  }

  .racing-bar-fill {
    height: 100%;
    border-radius: 2px;
    width: 0%;
    transition: width 2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 0.5rem;
  }

  .racing-bar-fill.vietnam {
    background: linear-gradient(90deg, var(--red), #E74C3C);
  }

  .racing-bar-fill.other {
    background: #999;
  }

  .racing-bar-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    font-weight: 500;
    color: white;
  }

  .racing-bar-start {
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 3px;
    background: var(--dark);
    opacity: 0.3;
  }

  .racing-bar-year {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: #999;
    margin-left: 0.5rem;
    white-space: nowrap;
  }

  /* Chart Tooltips */
  .chart-tooltip {
    position: absolute;
    background: var(--dark);
    color: var(--cream);
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 0.72rem;
    z-index: 100;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    max-width: 200px;
  }

  .chart-tooltip.visible {
    opacity: 1;
  }

  .chart-tooltip-value {
    font-family: 'JetBrains Mono', monospace;
    font-weight: 500;
    color: var(--gold);
    margin-bottom: 2px;
  }

  .chart-tooltip-source {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    color: rgba(250, 247, 242, 0.5);
  }

  .bar-row {
    position: relative;
    cursor: pointer;
  }

  .legend-item {
    position: relative;
    cursor: pointer;
  }

  @media (max-width: 768px) {
    .sticky-counter {
      top: 10px;
      right: 10px;
      padding: 10px 14px;
      min-width: 150px;
    }
    .sticky-counter-value {
      font-size: 1.2rem;
    }
    .sticky-counter-subtitle {
      display: none;
    }
    .sticky-counter-label {
      font-size: 0.5rem;
    }
    .sticky-counter-era {
      font-size: 0.5rem;
    }
    .section-nav {
      right: 8px;
    }
    .section-dot {
      width: 8px;
      height: 8px;
    }
    .interstitial-stat {
      font-size: 1.5rem;
    }
    .sankey-container {
      padding: 1rem;
    }
    .demo-ring-container {
      flex-direction: column;
    }
  }

  @media (max-width: 600px) {
    .stat-row { gap: 1.5rem; }
    .donut-section { flex-direction: column; align-items: center; }
    .section, .section-wide { padding: 3.5rem 1.5rem; }
    body { font-size: 16px; }
    .bar-label { width: 65px; font-size: 0.62rem; }
    .comparison-grid { gap: 1rem; }
  }
</style>
</head>
<body>

<div class="progress-bar" id="progressBar"></div>

<!-- Sticky Export Counter -->
<div class="sticky-counter" id="stickyCounter">
  <div class="sticky-counter-header">
    <span class="sticky-counter-label">Total Exports</span>
    <span class="sticky-counter-era" id="counterEra">1990</span>
  </div>
  <div class="sticky-counter-main">
    <span class="sticky-counter-value" id="counterValue">$2.4B</span>
    <span class="sticky-counter-question">?</span>
  </div>
  <div class="sticky-counter-subtitle" id="counterSubtitle">Watch this number grow as you scroll through Vietnam's economic history</div>
</div>

<!-- Section Navigation Dots -->
<nav class="section-nav" id="sectionNav">
  <div class="section-dot" data-section="0" data-tooltip="Introduction"></div>
  <div class="section-dot" data-section="1" data-tooltip="The Boom"></div>
  <div class="section-dot" data-section="2" data-tooltip="The Screwdriver"></div>
  <div class="section-dot" data-section="3" data-tooltip="The Window"></div>
  <div class="section-dot" data-section="4" data-tooltip="Simulator"></div>
</nav>

<!-- SECTION 1: HERO + HOOK -->
<section class="hero" data-section-index="0">
  <div class="parallax-star" id="parallaxStar">&#9733;</div>
  <div class="parallax-dots" id="parallaxDots"></div>
  <div class="hero-star">&#9733;</div>
  <h1>The <em>Screwdriver</em> Economy</h1>
  <div class="hero-subtitle">Vietnam's <a href="https://www.vietnam-briefing.com/news/vietnam-gdp-fdi-and-trade-2025.html/" target="_blank" style="color:var(--gold);text-decoration:none;">$475 Billion</a> Export Model and Its Structural Weaknesses</div>
  <div class="hero-hook">GDP per capita rose from $98 to $5,026 in one generation. Exports grew 200-fold. Foreign firms control 72% of output. The question is whether Vietnam captured the value.</div>
  <div class="hero-scroll-cue">Scroll to explore</div>
</section>

<section class="stat-banner">
  <div class="stat-row">
    <div class="stat-item reveal">
      <span class="stat-number"><a href="https://www.vietnam-briefing.com/news/vietnam-gdp-fdi-and-trade-2025.html/" target="_blank" style="color:var(--gold);text-decoration:none;">$475B</a></span>
      <span class="stat-label">Total exports 2025</span>
    </div>
    <div class="stat-item reveal reveal-delay-1">
      <span class="stat-number"><a href="https://data.worldbank.org/country/viet-nam" target="_blank" style="color:var(--gold);text-decoration:none;">200&times;</a></span>
      <span class="stat-label">Export growth since 1990</span>
    </div>
    <div class="stat-item reveal reveal-delay-2">
      <span class="stat-number count-up" data-target="187"><a href="https://www.macrotrends.net/global-metrics/countries/vnm/vietnam/trade-gdp-ratio" target="_blank" style="color:var(--gold);text-decoration:none;">0</a></span>
      <span class="stat-label">Trade-to-GDP ratio (%)</span>
    </div>
    <div class="stat-item reveal reveal-delay-3">
      <span class="stat-number"><a href="https://www.trade.gov/country-commercial-guides/vietnam-trade-agreements" target="_blank" style="color:var(--gold);text-decoration:none;">17</a></span>
      <span class="stat-label">Active FTAs</span>
    </div>
  </div>
</section>

<!-- ACT I: THE BOOM -->
<section class="section" data-section-index="1" data-export-value="150">
  <div class="reveal">
    <span class="chapter-label">Act I</span>
    <h2>The Boom</h2>
  </div>
  <div class="reveal reveal-delay-1">
    <p class="lead dropcap">In 1986, Vietnam was collapsing. <a href="https://www.rosalux.de/en/news?tx_news_pi1%5Baction%5D=detail&tx_news_pi1%5Bcontroller%5D=News&tx_news_pi1%5Bnews%5D=45887" target="_blank" style="color:var(--red);text-decoration:none;">Inflation exceeded 700%</a>. <a href="https://data.worldbank.org/indicator/NY.GDP.PCAP.CD?locations=VN" target="_blank" style="color:var(--red);text-decoration:none;">GDP per capita was $98</a>. Two-thirds lived in poverty. The Communist Party made a calculated pivot: <a href="https://www.ucl.ac.uk/social-historical-sciences/sites/social_historical_sciences/files/decoding_vietnams_economic_miracle.pdf" target="_blank" style="color:var(--red);text-decoration:none;">Đổi Mới</a> (renovation)—market mechanisms without political liberalization. They legalized private enterprise, dismantled agricultural collectives, and opened to foreign investment. Within a decade, growth recovered. Within a generation, <a href="https://databankfiles.worldbank.org/public/ddpext_download/poverty/987B9C90-CB9F-4D93-AE8C-750588BF00QA/current/Global_POVEQ_VNM.pdf" target="_blank" style="color:var(--slate);text-decoration:none;">poverty fell from 58% to 12%</a>.</p>
  </div>
  <div class="reveal reveal-delay-2">
    <p>The accelerant was trade integration. Vietnam joined ASEAN (1995), signed a <a href="https://ustr.gov/sites/default/files/US-VietNam-BilateralTradeAgreement.pdf" target="_blank" style="color:var(--slate);text-decoration:none;">bilateral trade agreement with the US</a> (2001), entered the <a href="https://www.wto.org/english/thewto_e/acc_e/a1_vietnam_e.htm" target="_blank" style="color:var(--slate);text-decoration:none;">WTO</a> (2007), then CPTPP and EVFTA. The result: <a href="https://web.wtocenter.org.tw/file/PageFile/359006/WTTPRS410R1.pdf" target="_blank" style="color:var(--slate);text-decoration:none;">17 free trade agreements</a> covering 90% of global GDP. Tariff arbitrage became national strategy—a company manufacturing in China faces 10-15% EU tariffs on electronics; the same company assembling in Vietnam faces nearly zero.</p>
  </div>

  <div class="reveal">
    <div class="collapsible-sidebar" onclick="this.classList.toggle('open')">
      <div class="collapsible-header">
        <h4>What is Đổi Mới?</h4>
        <span class="collapsible-toggle">▼</span>
      </div>
      <div class="collapsible-content">
        <p>Vietnam's 1986 market reforms—similar to China's 1978 opening under Deng. The Party retained political control while introducing market mechanisms: legalizing private enterprise, dismantling collectives, opening to FDI. Unlike the Soviet collapse, Vietnam managed a controlled transition. GDP rose from $6.5B (1990) to $31.2B (2000).</p>
      </div>
    </div>
  </div>

  <div class="reveal">
    <p>Foreign investment flooded in. <a href="https://www.oecd.org/en/publications/oecd-economic-surveys-viet-nam-2025_fb37254b-en/full-report/harnessing-trade-and-investment-flows-to-boost-productivity_98d56c90.html" target="_blank" style="color:var(--red);text-decoration:none;">Foreign firms now account for ~73% of Vietnam's exports</a>. Samsung alone invested <a href="https://www.oecd.org/en/publications/oecd-economic-surveys-viet-nam-2025_fb37254b-en/full-report/harnessing-trade-and-investment-flows-to-boost-productivity_98d56c90.html" target="_blank" style="color:var(--slate);text-decoration:none;">$22 billion</a>, produces 40%+ of its global smartphones here, and accounts for <a href="https://www.oecd.org/en/publications/oecd-economic-surveys-viet-nam-2025_fb37254b-en/full-report/harnessing-trade-and-investment-flows-to-boost-productivity_98d56c90.html" target="_blank" style="color:var(--red);text-decoration:none;">~20% of Vietnam's total exports</a>. <a href="https://theinvestor.vn/intels-20-years-in-vietnam-15-bln-invested-4-bln-chips-produced-d16287.html" target="_blank" style="color:var(--slate);text-decoration:none;">Intel operates a $1.5B facility</a>—its largest globally. Apple has <a href="https://en.baochinhphu.vn/jpmorgan-65-of-worlds-airpods-production-to-be-located-in-viet-nam-in-2025-111220927105738214.htm" target="_blank" style="color:var(--slate);text-decoration:none;">35 supplier facilities</a> assembling ~65% of AirPods and ~20% of iPads. <a href="https://www.vietnam-briefing.com/news/where-are-nikes-factories-located-in-vietnam.html/" target="_blank" style="color:var(--slate);text-decoration:none;">Nike sources 51% of global footwear</a> from 162 Vietnamese factories.</p>
  </div>

  <div class="reveal">
    <div class="chart-container">
      <div class="chart-title">The Samsung Effect</div>
      <div class="chart-subtitle">One company's dominance in Vietnam's export model | Source: <a href="https://www.oecd.org/en/publications/oecd-economic-surveys-viet-nam-2025_fb37254b-en/full-report/harnessing-trade-and-investment-flows-to-boost-productivity_98d56c90.html" target="_blank" style="color:#999;text-decoration:underline;">OECD 2025</a></div>
      <table class="data-table">
        <tr>
          <th>Metric</th>
          <th>Value</th>
          <th>Context</th>
        </tr>
        <tr>
          <td>Total investment</td>
          <td class="highlight">~$22B</td>
          <td>Vietnam's largest foreign investor</td>
        </tr>
        <tr>
          <td>Export share</td>
          <td class="highlight red">~20%</td>
          <td>One firm = 1/5 of Vietnam's exports</td>
        </tr>
        <tr>
          <td>Employees</td>
          <td class="highlight">~112,000</td>
          <td>~35% of Samsung's global workforce</td>
        </tr>
        <tr>
          <td>Global production</td>
          <td class="highlight">40%+</td>
          <td>Of all Samsung smartphones</td>
        </tr>
      </table>
    </div>
  </div>

  <div class="reveal">
    <div class="pull-quote" style="margin: 2rem 0; padding: 1.5rem 2rem; background: linear-gradient(135deg, rgba(218,37,29,0.08) 0%, rgba(212,175,55,0.08) 100%); border-left: 4px solid var(--red); border-radius: 0 8px 8px 0;">
      <p style="font-size: 1.3rem; line-height: 1.5; margin: 0; font-weight: 400;">The model worked—until it revealed its limits. <a href="https://www.vietnam-briefing.com/news/vietnam-economy-gdp-fdi-and-trade-2025.html/" target="_blank" style="color:var(--warning);text-decoration:none;font-weight:600;">77.3% of exports come from foreign firms</a>. Domestic companies collectively run a trade deficit.</p>
      <p style="font-size: 1.5rem; line-height: 1.4; margin: 1rem 0 0 0; font-family: 'Playfair Display', serif; font-weight: 700; color: var(--dark);">The question is whether Vietnam captured the value—or just the jobs.</p>
    </div>
  </div>
</section>

<!-- INTERSTITIAL 1: The Turn -->
<section class="interstitial" id="interstitial1">
  <div class="interstitial-content">
    <p class="interstitial-stat"><em><a href="https://www.vietnam-briefing.com/news/vietnam-economy-gdp-fdi-and-trade-2025.html/" target="_blank" style="color:var(--gold);text-decoration:none;">73%</a></em> of exports are foreign-owned.</p>
    <p class="interstitial-context">The question is whether Vietnam captured the value—or just the jobs.</p>
  </div>
</section>

<!-- ACT II: THE SCREWDRIVER -->
<section class="section-wide" data-section-index="2" data-export-value="336">
  <div class="reveal">
    <span class="chapter-label">Act II</span>
    <h2>The Screwdriver Economy</h2>
  </div>
  <div class="reveal reveal-delay-1">
    <p class="lead dropcap" style="max-width:720px;">The FDI boom created jobs and drove exports. It also created a dependency. <a href="https://www.oecd.org/content/dam/oecd/en/topics/policy-sub-issues/trade-in-value-added/tiva-2023-VNM.pdf" target="_blank" style="color:var(--red);text-decoration:none;">Foreign value-added in Vietnam's exports rose from 43% in 2008 to 48% in 2020</a>, well above the OECD average of 27%. Domestic value capture fell even as exports surged. This is the core paradox: <a href="https://www.worldbank.org/en/country/vietnam/publication/viet-nam-2045-trading-up-in-a-changing-world" target="_blank" style="color:var(--slate);text-decoration:none;">local business participation in global supply chains dropped from 35% to 18% between 2009 and 2023</a>. The structural transformation has been dramatic: <a href="https://www.theglobaleconomy.com/Vietnam/share_of_agriculture/" target="_blank" style="color:var(--slate);text-decoration:none;">agriculture's share of GDP fell from nearly 46% in 1988 to only about 11.9% in 2024</a>. <a href="https://tradingeconomics.com/vietnam/employment-in-agriculture-percent-of-total-employment-wb-data.html" target="_blank" style="color:var(--slate);text-decoration:none;">Agricultural employment fell to about 33% by 2023</a>. Yet the benefits of this transformation are increasingly captured by foreign firms.</p>
  </div>

  <div class="reveal">
    <div class="collapsible-sidebar" onclick="this.classList.toggle('open')">
      <div class="collapsible-header">
        <h4>What is DVA vs FVA?</h4>
        <span class="collapsible-toggle">▼</span>
      </div>
      <div class="collapsible-content">
        <p><strong>Domestic Value-Added (DVA)</strong> = Vietnamese labor, materials, profits. <strong>Foreign Value-Added (FVA)</strong> = imported components and foreign IP. Vietnam's DVA is 52%—meaning $480 of a $1,000 smartphone came from imports (Korean chips, Japanese screens, Taiwanese components). The $520 Vietnam "adds" is mostly assembly—the lowest-margin step. Compare: China 68%, Germany 74%.</p>
      </div>
    </div>
  </div>

  <!-- Sankey Flow Diagram -->
  <div class="reveal">
    <div class="sankey-container">
      <div class="chart-title">The Pass-Through Economy: Trade Flow Visualization</div>
      <div class="chart-subtitle">Vietnam as assembly hub: imports from suppliers, exports to consumers (2024) | Source: <a href="https://www.gso.gov.vn/en/homepage/" target="_blank" style="color:#999;text-decoration:underline;">GSO</a>, <a href="https://www.vietnam-briefing.com/news/vietnams-trade-performance-in-2024-how-to-read-the-data.html/" target="_blank" style="color:#999;text-decoration:underline;">Vietnam Briefing</a>, <a href="https://oec.world/en/profile/country/vnm" target="_blank" style="color:#999;text-decoration:underline;">OEC</a>, <a href="https://www.wita.org/atp-research/vietnam-imports-from-china/" target="_blank" style="color:#999;text-decoration:underline;">WITA</a></div>
      <svg class="sankey-svg" viewBox="0 0 900 340" id="sankeyChart">
        <defs>
          <!-- Gradient for import flows -->
          <linearGradient id="importGrad" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#F2C94C;stop-opacity:0.85"/>
            <stop offset="100%" style="stop-color:#F2C94C;stop-opacity:0.4"/>
          </linearGradient>
          <!-- Gradient for export flows -->
          <linearGradient id="exportGrad" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#DA251D;stop-opacity:0.4"/>
            <stop offset="100%" style="stop-color:#DA251D;stop-opacity:0.85"/>
          </linearGradient>
          <!-- Drop shadow for center node -->
          <filter id="nodeShadow" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="0" dy="2" stdDeviation="4" flood-opacity="0.15"/>
          </filter>
        </defs>

        <!-- Column headers -->
        <text x="70" y="20" class="sankey-label" style="font-size:9px;fill:#999;text-transform:uppercase;letter-spacing:0.1em">Suppliers</text>
        <text x="450" y="20" text-anchor="middle" class="sankey-label" style="font-size:9px;fill:#999;text-transform:uppercase;letter-spacing:0.1em">Assembly</text>
        <text x="830" y="20" text-anchor="end" class="sankey-label" style="font-size:9px;fill:#999;text-transform:uppercase;letter-spacing:0.1em">Markets</text>

        <!-- Total indicators -->
        <g id="totalImports" opacity="0">
          <rect x="25" y="28" width="80" height="20" rx="3" fill="var(--gold)" opacity="0.2"/>
          <text x="65" y="42" text-anchor="middle" style="font-family:'JetBrains Mono',monospace;font-size:10px;fill:var(--dark);font-weight:600">$230B in</text>
        </g>
        <g id="totalExports" opacity="0">
          <rect x="795" y="28" width="80" height="20" rx="3" fill="var(--red)" opacity="0.2"/>
          <text x="835" y="42" text-anchor="middle" style="font-family:'JetBrains Mono',monospace;font-size:10px;fill:var(--dark);font-weight:600">$343B out</text>
        </g>

        <!-- LEFT SIDE: Imports flowing IN -->
        <!-- China (largest supplier) -->
        <g class="import-group" id="importGroup1">
          <path d="M 110 75 C 220 75, 300 100, 355 100" class="sankey-path" stroke="url(#importGrad)"
                stroke-width="40" id="sankeyImport1" stroke-dasharray="400" stroke-dashoffset="400"/>
          <rect x="25" y="53" width="80" height="42" rx="3" fill="white" stroke="var(--gold)" stroke-width="1.5"/>
          <text x="65" y="70" class="sankey-label" text-anchor="middle" style="font-weight:600">China</text>
          <text x="65" y="87" class="sankey-value" text-anchor="middle" style="font-size:11px;fill:var(--dark)">$186B</text>
        </g>

        <!-- South Korea -->
        <g class="import-group" id="importGroup2">
          <path d="M 110 130 C 220 130, 300 120, 355 120" class="sankey-path" stroke="url(#importGrad)"
                stroke-width="16" id="sankeyImport2" stroke-dasharray="400" stroke-dashoffset="400"/>
          <rect x="25" y="112" width="80" height="36" rx="3" fill="white" stroke="var(--gold)" stroke-width="1"/>
          <text x="65" y="128" class="sankey-label" text-anchor="middle">S. Korea</text>
          <text x="65" y="142" class="sankey-value" text-anchor="middle">$31.6B</text>
        </g>

        <!-- Japan -->
        <g class="import-group" id="importGroup3">
          <path d="M 110 175 C 220 175, 300 155, 355 155" class="sankey-path" stroke="url(#importGrad)"
                stroke-width="11" id="sankeyImport3" stroke-dasharray="400" stroke-dashoffset="400"/>
          <rect x="25" y="157" width="80" height="36" rx="3" fill="white" stroke="var(--gold)" stroke-width="1"/>
          <text x="65" y="173" class="sankey-label" text-anchor="middle">Japan</text>
          <text x="65" y="187" class="sankey-value" text-anchor="middle">$21B</text>
        </g>

        <!-- Taiwan -->
        <g class="import-group" id="importGroup4">
          <path d="M 110 220 C 220 220, 300 175, 355 175" class="sankey-path" stroke="url(#importGrad)"
                stroke-width="9" id="sankeyImport4" stroke-dasharray="400" stroke-dashoffset="400"/>
          <rect x="25" y="202" width="80" height="36" rx="3" fill="white" stroke="var(--gold)" stroke-width="1"/>
          <text x="65" y="218" class="sankey-label" text-anchor="middle">Taiwan</text>
          <text x="65" y="232" class="sankey-value" text-anchor="middle">$18B</text>
        </g>

        <!-- ASEAN -->
        <g class="import-group" id="importGroup5">
          <path d="M 110 265 C 220 265, 300 192, 355 192" class="sankey-path" stroke="url(#importGrad)"
                stroke-width="8" id="sankeyImport5" stroke-dasharray="400" stroke-dashoffset="400"/>
          <rect x="25" y="247" width="80" height="36" rx="3" fill="white" stroke="var(--gold)" stroke-width="1"/>
          <text x="65" y="263" class="sankey-label" text-anchor="middle">ASEAN</text>
          <text x="65" y="277" class="sankey-value" text-anchor="middle">$15B</text>
        </g>

        <!-- RIGHT SIDE: Exports flowing OUT - drawn first so Vietnam box appears on top -->
        <!-- USA (largest market) -->
        <g class="export-group" id="exportGroup1">
          <path d="M 545 100 C 620 100, 700 75, 790 75" class="sankey-path" stroke="url(#exportGrad)"
                stroke-width="44" id="sankeyExport1" stroke-dasharray="400" stroke-dashoffset="400"/>
          <rect x="795" y="53" width="80" height="42" rx="3" fill="white" stroke="var(--red)" stroke-width="1.5"/>
          <text x="835" y="70" class="sankey-label" text-anchor="middle" style="font-weight:600">USA</text>
          <text x="835" y="87" class="sankey-value" text-anchor="middle" style="font-size:11px;fill:var(--dark)">$153B</text>
        </g>

        <!-- EU -->
        <g class="export-group" id="exportGroup2">
          <path d="M 545 120 C 620 120, 700 130, 790 130" class="sankey-path" stroke="url(#exportGrad)"
                stroke-width="20" id="sankeyExport2" stroke-dasharray="400" stroke-dashoffset="400"/>
          <rect x="795" y="112" width="80" height="36" rx="3" fill="white" stroke="var(--red)" stroke-width="1"/>
          <text x="835" y="128" class="sankey-label" text-anchor="middle">EU</text>
          <text x="835" y="142" class="sankey-value" text-anchor="middle">$72.9B</text>
        </g>

        <!-- China (exports) -->
        <g class="export-group" id="exportGroup3">
          <path d="M 545 155 C 620 155, 700 175, 790 175" class="sankey-path" stroke="url(#exportGrad)"
                stroke-width="18" id="sankeyExport3" stroke-dasharray="400" stroke-dashoffset="400"/>
          <rect x="795" y="157" width="80" height="36" rx="3" fill="white" stroke="var(--red)" stroke-width="1"/>
          <text x="835" y="173" class="sankey-label" text-anchor="middle">China</text>
          <text x="835" y="187" class="sankey-value" text-anchor="middle">$64.5B</text>
        </g>

        <!-- Japan (exports) -->
        <g class="export-group" id="exportGroup4">
          <path d="M 545 175 C 620 175, 700 220, 790 220" class="sankey-path" stroke="url(#exportGrad)"
                stroke-width="9" id="sankeyExport4" stroke-dasharray="400" stroke-dashoffset="400"/>
          <rect x="795" y="202" width="80" height="36" rx="3" fill="white" stroke="var(--red)" stroke-width="1"/>
          <text x="835" y="218" class="sankey-label" text-anchor="middle">Japan</text>
          <text x="835" y="232" class="sankey-value" text-anchor="middle">$27B</text>
        </g>

        <!-- ASEAN (exports) -->
        <g class="export-group" id="exportGroup5">
          <path d="M 545 192 C 620 192, 700 265, 790 265" class="sankey-path" stroke="url(#exportGrad)"
                stroke-width="8" id="sankeyExport5" stroke-dasharray="400" stroke-dashoffset="400"/>
          <rect x="795" y="247" width="80" height="36" rx="3" fill="white" stroke="var(--red)" stroke-width="1"/>
          <text x="835" y="263" class="sankey-label" text-anchor="middle">ASEAN</text>
          <text x="835" y="277" class="sankey-value" text-anchor="middle">$25B</text>
        </g>

        <!-- CENTER: Vietnam Assembly Node - drawn last so it appears on top of paths -->
        <g id="vietnamNodeGroup">
          <rect x="355" y="70" width="190" height="150" rx="8" fill="var(--cream)" stroke="var(--dark)" stroke-width="2.5" filter="url(#nodeShadow)"/>

          <!-- Vietnam flag star -->
          <text x="450" y="105" text-anchor="middle" style="font-size:20px">★</text>

          <text x="450" y="132" text-anchor="middle" style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;fill:var(--dark)">Vietnam</text>
          <text x="450" y="152" text-anchor="middle" style="font-family:'JetBrains Mono',monospace;font-size:10px;fill:var(--slate);text-transform:uppercase;letter-spacing:0.05em">Assembly Hub</text>

          <!-- Value added indicator -->
          <line x1="380" y1="168" x2="520" y2="168" stroke="var(--light-gray)" stroke-width="1"/>
          <rect x="390" y="176" width="120" height="22" rx="3" fill="var(--warning)" opacity="0.15"/>
          <text x="450" y="192" text-anchor="middle" style="font-family:'JetBrains Mono',monospace;font-size:11px;fill:var(--warning);font-weight:600">DVA: only 52%</text>
        </g>

        <!-- Trade surplus indicator - below center box -->
        <g id="surplusIndicator" opacity="0">
          <rect x="380" y="230" width="140" height="26" rx="4" fill="var(--accent-green)" opacity="0.1" stroke="var(--accent-green)" stroke-width="1"/>
          <text x="450" y="248" text-anchor="middle" style="font-family:'JetBrains Mono',monospace;font-size:10px;fill:var(--accent-green);font-weight:600">Trade Surplus: +$113B</text>
        </g>

        <!-- Legend and insight row at bottom -->
        <g transform="translate(0, 295)">
          <!-- Key insight callout - THE CORE QUESTION -->
          <g id="sankeyInsight" opacity="0">
            <rect x="15" y="-5" width="180" height="45" rx="6" fill="var(--dark)" stroke="var(--gold)" stroke-width="1"/>
            <text x="105" y="12" text-anchor="middle" style="font-family:'JetBrains Mono',monospace;font-size:8px;fill:var(--gold);text-transform:uppercase;letter-spacing:0.08em;font-weight:600">The Core Question</text>
            <text x="105" y="28" text-anchor="middle" style="font-family:'Playfair Display',serif;font-size:11px;fill:white;font-weight:600">Did Vietnam capture the value</text>
            <text x="105" y="40" text-anchor="middle" style="font-family:'Playfair Display',serif;font-size:11px;fill:white;font-weight:600">—or just the jobs?</text>
          </g>

          <!-- Legend - with prominent DVA highlight -->
          <rect x="230" y="8" width="12" height="10" rx="2" fill="var(--gold)" opacity="0.7"/>
          <text x="248" y="17" class="sankey-value" style="font-size:9px">Imports (components)</text>
          <rect x="390" y="8" width="12" height="10" rx="2" fill="var(--red)" opacity="0.7"/>
          <text x="408" y="17" class="sankey-value" style="font-size:9px">Exports (finished goods)</text>

          <!-- DVA Highlight Box -->
          <rect x="540" y="-2" width="165" height="28" rx="4" fill="rgba(212,175,55,0.15)" stroke="var(--gold)" stroke-width="1"/>
          <rect x="550" y="8" width="12" height="10" rx="2" fill="var(--gold)" opacity="0.4"/>
          <text x="568" y="17" class="sankey-value" style="font-size:10px;font-weight:600;fill:var(--dark)">Vietnam keeps only 52%</text>
        </g>
      </svg>
    </div>
  </div>

  <div class="reveal">
    <div class="chart-container">
      <div class="chart-title">Foreign Value-Added in Exports</div>
      <div class="chart-subtitle">Import intensity as % of export value. Higher = less domestic value capture. | Source: <a href="https://www.oecd.org/content/dam/oecd/en/topics/policy-sub-issues/trade-in-value-added/tiva-2023-VNM.pdf" target="_blank" style="color:#999;text-decoration:underline;">OECD TiVA 2023</a>, <a href="https://www.tresor.economie.gouv.fr/Articles/1bb7ebaa-6a0d-42d0-b22b-6ed06fefdcd9/files/0c7af478-2c44-4b5f-8889-64cbd15a5c45" target="_blank" style="color:#999;text-decoration:underline;">French Treasury</a></div>
      <div class="bar-chart" id="fvaChart">
        <div class="bar-row">
          <span class="bar-label">Vietnam</span>
          <div class="bar-track"><div class="bar-fill" data-width="100" style="background:var(--warning)"><span class="bar-value">48%</span></div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Malaysia</span>
          <div class="bar-track"><div class="bar-fill" data-width="73" style="background:var(--accent-blue)"><span class="bar-value">35%</span></div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Thailand</span>
          <div class="bar-track"><div class="bar-fill" data-width="63" style="background:var(--accent-blue)"><span class="bar-value">30%</span></div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">OECD avg</span>
          <div class="bar-track"><div class="bar-fill" data-width="56" style="background:var(--accent-green)"><span class="bar-value">27%</span></div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Indonesia</span>
          <div class="bar-track"><div class="bar-fill" data-width="31" style="background:var(--accent-green)"><span class="bar-value">15%</span></div></div>
        </div>
      </div>
    </div>
  </div>

  <div class="reveal">
    <div class="chart-container">
      <div class="chart-title">Export Composition by Sector, 2025</div>
      <div class="chart-subtitle">Share of $475B total merchandise exports | Source: <a href="https://www.nso.gov.vn/en/highlight/2025/02/socio-economic-situation-in-the-fourth-quarter-and-2024/" target="_blank" style="color:#999;text-decoration:underline;">GSO Vietnam</a></div>
      <div class="donut-section">
        <svg class="donut-chart" viewBox="0 0 200 200" id="donutChart">
          <circle cx="100" cy="100" r="75" fill="none" stroke="var(--light-gray)" stroke-width="30"/>
          <circle cx="100" cy="100" r="75" fill="none" stroke="var(--red)" stroke-width="30"
            stroke-dasharray="0 471" class="donut-segment" data-target="155.4"
            transform="rotate(-90 100 100)"/>
          <circle cx="100" cy="100" r="75" fill="none" stroke="var(--accent-green)" stroke-width="30"
            stroke-dasharray="0 471" class="donut-segment" data-target="75.4" data-offset="155.4"
            transform="rotate(-90 100 100)"/>
          <circle cx="100" cy="100" r="75" fill="none" stroke="#E74C3C" stroke-width="30"
            stroke-dasharray="0 471" class="donut-segment" data-target="75.4" data-offset="230.8"
            transform="rotate(-90 100 100)"/>
          <circle cx="100" cy="100" r="75" fill="none" stroke="var(--accent-blue)" stroke-width="30"
            stroke-dasharray="0 471" class="donut-segment" data-target="61.2" data-offset="306.2"
            transform="rotate(-90 100 100)"/>
          <circle cx="100" cy="100" r="75" fill="none" stroke="#999" stroke-width="30"
            stroke-dasharray="0 471" class="donut-segment" data-target="103.6" data-offset="367.4"
            transform="rotate(-90 100 100)"/>
          <text x="100" y="95" text-anchor="middle" font-family="Playfair Display, serif" font-size="20" font-weight="900" fill="var(--dark)">$475B</text>
          <text x="100" y="112" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="8" fill="#999">TOTAL 2025</text>
        </svg>
        <div class="donut-legend">
          <div class="legend-item">
            <div class="legend-color" style="background:var(--red)"></div>
            <span class="legend-label"><a href="https://www.vietnamexportdata.com/blogs/vietnam-electronics-exports-2025-data-report" target="_blank" style="color:var(--slate);text-decoration:none;">Electronics & phones</a></span>
            <span class="legend-value">$126.5B (33%)</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background:var(--accent-green)"></div>
            <span class="legend-label"><a href="https://www.vietnam-briefing.com/news/vietnam-economy-gdp-fdi-and-trade-2025.html/" target="_blank" style="color:var(--slate);text-decoration:none;">Agri/forestry/fishery</a></span>
            <span class="legend-value">$50.8B (11%)</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background:#E74C3C"></div>
            <span class="legend-label"><a href="https://www.worldstopexports.com/vietnams-top-10-exports/" target="_blank" style="color:var(--slate);text-decoration:none;">Textiles & footwear</a></span>
            <span class="legend-value">~$61B (16%)</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background:var(--accent-blue)"></div>
            <span class="legend-label">Machinery & equipment</span>
            <span class="legend-value">~$49B (13%)</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background:#999"></div>
            <span class="legend-label">Other</span>
            <span class="legend-value">~$88B (22%)</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="reveal">
    <div class="chart-container">
      <div class="chart-title">Top Export Destinations, 2025</div>
      <div class="chart-subtitle">Exports in USD billions | Source: <a href="https://www.nso.gov.vn/en/highlight/2025/02/socio-economic-situation-in-the-fourth-quarter-and-2024/" target="_blank" style="color:#999;text-decoration:underline;">GSO Vietnam</a>, <a href="https://www.cnbc.com/2025/04/08/vietnam-emerged-as-a-trade-winner-trump-new-tariffs-may-disrupt-that.html" target="_blank" style="color:#999;text-decoration:underline;">CNBC</a></div>
      <div class="bar-chart" id="partnersChart">
        <div class="bar-row">
          <span class="bar-label"><a href="https://www.cnbc.com/2025/04/08/vietnam-emerged-as-a-trade-winner-trump-new-tariffs-may-disrupt-that.html" target="_blank" style="color:var(--slate);text-decoration:none;">USA</a></span>
          <div class="bar-track"><div class="bar-fill" data-width="100" style="background:var(--red)"><span class="bar-value">$153.2B (~30%)</span></div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">China</span>
          <div class="bar-track"><div class="bar-fill" data-width="42" style="background:var(--accent-blue)"><span class="bar-value">$64.5B</span></div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">EU</span>
          <div class="bar-track"><div class="bar-fill" data-width="36" style="background:var(--accent-green)"><span class="bar-value">$55B</span></div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">S. Korea</span>
          <div class="bar-track"><div class="bar-fill" data-width="20" style="background:#E74C3C"><span class="bar-value">$30B</span></div></div>
        </div>
        <div class="bar-row">
          <span class="bar-label">Japan</span>
          <div class="bar-track"><div class="bar-fill" data-width="18" style="background:var(--gold)"><span class="bar-value">$27B</span></div></div>
        </div>
      </div>
    </div>
  </div>

  <div class="reveal">
    <div class="chart-container">
      <div class="chart-title">The Dual Deficit Pattern</div>
      <div class="chart-subtitle">Vietnam imports components from East Asia, assembles, re-exports to West | Source: <a href="https://www.cnbc.com/2025/04/12/vietnam-reciprocal-tariffs-reflect-trade-deficit-and-ties-to-china.html" target="_blank" style="color:#999;text-decoration:underline;">CNBC</a></div>
      <table class="data-table">
        <tr>
          <th>Trade Partner</th>
          <th>Balance</th>
          <th>Interpretation</th>
        </tr>
        <tr>
          <td>United States</td>
          <td class="highlight" style="color:var(--accent-green)"><a href="https://www.cnbc.com/2025/04/08/vietnam-emerged-as-a-trade-winner-trump-new-tariffs-may-disrupt-that.html" target="_blank" style="color:var(--accent-green);text-decoration:underline;">+$123.5B surplus</a></td>
          <td>Final goods destination</td>
        </tr>
        <tr>
          <td>China</td>
          <td class="highlight warning"><a href="https://www.cnbc.com/2025/04/12/vietnam-reciprocal-tariffs-reflect-trade-deficit-and-ties-to-china.html" target="_blank" style="color:var(--warning);text-decoration:underline;">-$115.6B deficit (widened 40%)</a></td>
          <td>Component supplier</td>
        </tr>
        <tr>
          <td>South Korea</td>
          <td class="warning">-$31.6B deficit</td>
          <td>Electronics parts, Samsung ecosystem</td>
        </tr>
      </table>
    </div>
  </div>

  <div class="reveal">
    <div class="insight-box" style="border-left-color: var(--warning);">
      <h4>The Assembly Trap Explained</h4>
      <p>Vietnam's export success is driven largely by assembling imported inputs. <a href="https://www.rmit.edu.vn/news/all-news/2025/nov/vietnam-electronics-fdi-growth-without-spillovers" target="_blank" style="color:rgba(250,247,242,0.85);text-decoration:underline;">Electronics FDI firms produce about 98% of Vietnam's electronics exports</a> (which totaled US$126.5 billion in 2024). <a href="https://www.worldbank.org/en/country/vietnam/publication/viet-nam-2045-trading-up-in-a-changing-world" target="_blank" style="color:rgba(250,247,242,0.85);text-decoration:underline;">Foreign-owned companies now account for ~73% of all exports</a>. Domestic enterprises often lack linkages, so Vietnam captures only a fraction of the value of exported goods. <a href="https://www.worldbank.org/en/country/vietnam/publication/viet-nam-2045-trading-up-in-a-changing-world" target="_blank" style="color:rgba(250,247,242,0.85);text-decoration:underline;">Services exports are still only ~12% of total exports</a> (and ~7% of manufacturing exports), much lower than in developed economies. This raises concerns of an "assembly trap" where growth relies on assembly jobs with limited skill gains or technology transfer.</p>
    </div>
  </div>

  <div class="reveal">
    <div class="pull-quote">
      <p>"<a href="https://documents.worldbank.org/en/publication/documents-reports/documentdetail/352041468338949354/export-liberalization-job-creation-and-the-skill-premium-evidence-from-the-u-s-vietnam-bilateral-trade-agreement" target="_blank" style="color:var(--dark);text-decoration:underline;">The boom in exports following the BTA was particularly beneficial to wages of unskilled workers and was a key driver of poverty reduction because it was concentrated in labor-intensive manufacturing.</a>"</p>
      <cite>World Bank research on BTA impact</cite>
    </div>
  </div>
</section>

<!-- INTERSTITIAL 2: The Deadline -->
<section class="interstitial" id="interstitial2">
  <div class="interstitial-content">
    <p class="interstitial-stat">Vietnam's demographic dividend ends around <em><a href="https://documents1.worldbank.org/curated/en/201841468616790980/pdf/107004-WP-PUBLIC.pdf" target="_blank" style="color:var(--gold);text-decoration:none;">2035</a></em>.</p>
    <p class="interstitial-context">Only 34 of ~142 middle-income countries have ever made it to high-income status.</p>
  </div>
</section>

<!-- Vietnam Industrial Map -->
<section class="section-wide">
  <div class="reveal">
    <h2 style="margin-bottom:0.5rem">Where the Factories Are</h2>
    <p style="max-width:720px;margin-top:0;">Two clusters: electronics in the north around Hanoi, diversified manufacturing in the south around Ho Chi Minh City.</p>
  </div>
  <div class="reveal">
    <div class="vietnam-map-container" id="vietnamMapContainer">
      <div class="chart-title">Vietnam's FDI Hotspots</div>
      <div class="chart-subtitle">Major foreign investment clusters and key facilities | Source: <a href="https://www.vietnam-briefing.com/news/vietnam-manufacturing-tracker.html/" target="_blank" style="color:#999;text-decoration:underline;">Vietnam Briefing</a></div>

      <div style="display:flex;flex-wrap:wrap;gap:2rem;align-items:flex-start;justify-content:center">
        <!-- Map Column -->
        <div style="flex:1 1 400px;max-width:500px;position:relative">
          <svg class="vietnam-map-svg" viewBox="280 40 540 920" id="vietnamMap" style="width:100%;height:auto;min-height:600px">
            <defs>
              <!-- Glow effect for pins -->
              <filter id="pinGlow" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur stdDeviation="3" result="blur"/>
                <feMerge>
                  <feMergeNode in="blur"/>
                  <feMergeNode in="SourceGraphic"/>
                </feMerge>
              </filter>
              <!-- Pulse animation -->
              <radialGradient id="pulseGradient">
                <stop offset="0%" style="stop-color:#DA251D;stop-opacity:0.4"/>
                <stop offset="100%" style="stop-color:#DA251D;stop-opacity:0"/>
              </radialGradient>
            </defs>

            <!-- Vietnam map from SVG file -->
            <image href="vn.svg" x="0" y="0" width="1000" height="1000" style="opacity:0.85"/>

            <!-- Region highlight boxes - adjusted to match pin positions -->
            <!-- Red River Delta: covers Hanoi, Bac Ninh, Hai Phong, Thai Nguyen area -->
            <rect x="450" y="120" width="150" height="95" rx="8" fill="rgba(218,37,29,0.08)" stroke="rgba(218,37,29,0.3)" stroke-width="2" stroke-dasharray="8 5"/>
            <!-- Southeast Region: covers HCMC, Binh Duong, Dong Nai area -->
            <rect x="500" y="765" width="140" height="90" rx="8" fill="rgba(218,37,29,0.08)" stroke="rgba(218,37,29,0.3)" stroke-width="2" stroke-dasharray="8 5"/>

            <!-- Region labels -->
            <text x="525" y="110" text-anchor="middle" style="font-family:'JetBrains Mono',monospace;font-size:13px;fill:var(--red);text-transform:uppercase;letter-spacing:0.08em;font-weight:600">Red River Delta</text>
            <text x="570" y="875" text-anchor="middle" style="font-family:'JetBrains Mono',monospace;font-size:13px;fill:var(--red);text-transform:uppercase;letter-spacing:0.08em;font-weight:600">Southeast Region</text>

            <!-- Map Pins - Northern Cluster (fine-tuned based on user arrows) -->
            <!-- Bac Ninh - just up and right of Hanoi -->
            <g class="map-pin" id="pin1" data-city="Bac Ninh" data-detail="Samsung HQ: $22.4B invested, 50% of global Samsung phones produced here">
              <circle cx="530" cy="165" r="30" fill="url(#pulseGradient)" class="pulse-ring"/>
              <circle cx="530" cy="165" r="16" class="map-pin-marker" filter="url(#pinGlow)"/>
              <text x="530" y="170" text-anchor="middle" style="font-size:12px;fill:white;font-weight:bold">1</text>
            </g>

            <!-- Thai Nguyen - moved right and down per arrow -->
            <g class="map-pin" id="pin2" data-city="Thai Nguyen" data-detail="Samsung complex: Display manufacturing, component production">
              <circle cx="500" cy="160" r="14" class="map-pin-marker"/>
              <text x="500" y="165" text-anchor="middle" style="font-size:12px;fill:white;font-weight:bold">2</text>
            </g>

            <!-- Hai Phong - coastal, moved up and left per arrow -->
            <g class="map-pin" id="pin3" data-city="Hai Phong" data-detail="LG Display $5.65B + Lach Huyen deep-water port. Gateway for exports">
              <circle cx="560" cy="180" r="14" class="map-pin-marker"/>
              <text x="560" y="185" text-anchor="middle" style="font-size:12px;fill:white;font-weight:bold">3</text>
            </g>

            <!-- Hanoi - central position -->
            <g class="map-pin" id="pin4" data-city="Hanoi" data-detail="Foxconn, Luxshare: Apple supplier hub, AirPods and MacBook assembly">
              <circle cx="510" cy="175" r="14" class="map-pin-marker"/>
              <text x="510" y="180" text-anchor="middle" style="font-size:12px;fill:white;font-weight:bold">4</text>
            </g>

            <!-- Map Pins - Southern Cluster (adjusted: -30px left, -15px up) -->
            <!-- Ho Chi Minh City -->
            <g class="map-pin" id="pin5" data-city="Ho Chi Minh City" data-detail="Intel $1.5B: World's largest chip assembly and test facility">
              <circle cx="542" cy="813" r="30" fill="url(#pulseGradient)" class="pulse-ring"/>
              <circle cx="542" cy="813" r="16" class="map-pin-marker" filter="url(#pinGlow)"/>
              <text x="542" y="818" text-anchor="middle" style="font-size:12px;fill:white;font-weight:bold">5</text>
            </g>

            <!-- Binh Duong -->
            <g class="map-pin" id="pin6" data-city="Binh Duong" data-detail="Called 'The new Dongguan': 4,000+ factories, global furniture hub">
              <circle cx="541" cy="787" r="14" class="map-pin-marker"/>
              <text x="541" y="792" text-anchor="middle" style="font-size:12px;fill:white;font-weight:bold">6</text>
            </g>

            <!-- Dong Nai -->
            <g class="map-pin" id="pin7" data-city="Dong Nai" data-detail="Industrial zone cluster: 32 IZs, $40B cumulative FDI">
              <circle cx="603" cy="801" r="14" class="map-pin-marker"/>
              <text x="603" y="806" text-anchor="middle" style="font-size:12px;fill:white;font-weight:bold">7</text>
            </g>

          </svg>
        </div>

        <!-- Legend Column -->
        <div style="flex:1 1 300px;min-width:280px;max-width:380px">
          <div style="background:var(--cream);border-radius:4px;padding:1rem;border:1px solid var(--light-gray)">
            <div style="font-family:'JetBrains Mono',monospace;font-size:0.65rem;color:#999;text-transform:uppercase;letter-spacing:0.1em;margin-bottom:0.75rem">FDI Hotspots</div>

            <!-- Northern cluster -->
            <div style="margin-bottom:1rem">
              <div style="font-family:'Playfair Display',serif;font-size:0.9rem;font-weight:700;color:var(--dark);margin-bottom:0.5rem;display:flex;align-items:center;gap:0.5rem">
                <span style="background:rgba(218,37,29,0.1);padding:0.15rem 0.4rem;border-radius:2px;font-size:0.7rem;color:var(--red)">NORTH</span>
                Red River Delta
              </div>
              <div class="map-legend-item" data-pin="pin1" style="display:flex;gap:0.5rem;padding:0.4rem 0;border-bottom:1px solid var(--light-gray);cursor:pointer">
                <span style="background:var(--red);color:white;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:bold;flex-shrink:0">1</span>
                <div>
                  <div style="font-weight:600;font-size:0.8rem">Bac Ninh</div>
                  <div style="font-size:0.7rem;color:var(--slate)">Samsung HQ: 50% global phones</div>
                </div>
              </div>
              <div class="map-legend-item" data-pin="pin2" style="display:flex;gap:0.5rem;padding:0.4rem 0;border-bottom:1px solid var(--light-gray);cursor:pointer">
                <span style="background:var(--red);color:white;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:bold;flex-shrink:0">2</span>
                <div>
                  <div style="font-weight:600;font-size:0.8rem">Thai Nguyen</div>
                  <div style="font-size:0.7rem;color:var(--slate)">Samsung display manufacturing</div>
                </div>
              </div>
              <div class="map-legend-item" data-pin="pin3" style="display:flex;gap:0.5rem;padding:0.4rem 0;border-bottom:1px solid var(--light-gray);cursor:pointer">
                <span style="background:var(--red);color:white;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:bold;flex-shrink:0">3</span>
                <div>
                  <div style="font-weight:600;font-size:0.8rem">Hai Phong</div>
                  <div style="font-size:0.7rem;color:var(--slate)">LG $5.65B + deep-water port</div>
                </div>
              </div>
              <div class="map-legend-item" data-pin="pin4" style="display:flex;gap:0.5rem;padding:0.4rem 0;cursor:pointer">
                <span style="background:var(--red);color:white;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:bold;flex-shrink:0">4</span>
                <div>
                  <div style="font-weight:600;font-size:0.8rem">Hanoi</div>
                  <div style="font-size:0.7rem;color:var(--slate)">Foxconn, Luxshare: Apple hub</div>
                </div>
              </div>
            </div>

            <!-- Southern cluster -->
            <div>
              <div style="font-family:'Playfair Display',serif;font-size:0.9rem;font-weight:700;color:var(--dark);margin-bottom:0.5rem;display:flex;align-items:center;gap:0.5rem">
                <span style="background:rgba(218,37,29,0.1);padding:0.15rem 0.4rem;border-radius:2px;font-size:0.7rem;color:var(--red)">SOUTH</span>
                Southeast Region
              </div>
              <div class="map-legend-item" data-pin="pin5" style="display:flex;gap:0.5rem;padding:0.4rem 0;border-bottom:1px solid var(--light-gray);cursor:pointer">
                <span style="background:var(--red);color:white;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:bold;flex-shrink:0">5</span>
                <div>
                  <div style="font-weight:600;font-size:0.8rem">Ho Chi Minh City</div>
                  <div style="font-size:0.7rem;color:var(--slate)">Intel $1.5B, largest global facility</div>
                </div>
              </div>
              <div class="map-legend-item" data-pin="pin6" style="display:flex;gap:0.5rem;padding:0.4rem 0;border-bottom:1px solid var(--light-gray);cursor:pointer">
                <span style="background:var(--red);color:white;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:bold;flex-shrink:0">6</span>
                <div>
                  <div style="font-weight:600;font-size:0.8rem">Binh Duong</div>
                  <div style="font-size:0.7rem;color:var(--slate)">'New Dongguan': 4,000+ factories</div>
                </div>
              </div>
              <div class="map-legend-item" data-pin="pin7" style="display:flex;gap:0.5rem;padding:0.4rem 0;cursor:pointer">
                <span style="background:var(--red);color:white;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:bold;flex-shrink:0">7</span>
                <div>
                  <div style="font-weight:600;font-size:0.8rem">Dong Nai</div>
                  <div style="font-size:0.7rem;color:var(--slate)">32 industrial zones, $40B FDI</div>
                </div>
              </div>
            </div>

            <!-- Key insight -->
            <div style="margin-top:1rem;padding:0.75rem;background:var(--dark);border-radius:4px">
              <div style="font-family:'JetBrains Mono',monospace;font-size:0.6rem;color:var(--gold);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.25rem">Key Pattern</div>
              <div style="font-size:0.75rem;color:var(--cream);line-height:1.4">Two clusters along the coast: electronics in the north, diversified manufacturing in the south.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="map-tooltip" id="mapTooltip">
        <div class="map-tooltip-title" id="tooltipTitle"></div>
        <div id="tooltipDetail"></div>
      </div>
    </div>
  </div>
</section>

<!-- ACT III: THE WINDOW -->
<section class="section" data-section-index="3" data-export-value="475">
  <div class="reveal">
    <span class="chapter-label">Act III</span>
    <h2>The Window</h2>
  </div>
  <div class="reveal reveal-delay-1">
    <p class="lead dropcap">The paradox has a deadline. Vietnam's <a href="https://documents1.worldbank.org/curated/en/201841468616790980/pdf/107004-WP-PUBLIC.pdf" target="_blank" style="color:var(--red);text-decoration:none;">working-age population peaks around 2038 at 72 million</a>, then declines. The demographic dividend that enabled cheap labor ends in the mid-2030s. The <a href="https://documents1.worldbank.org/curated/en/544371632385243499/pdf/Vietnam-Adapting-to-an-Aging-Society.pdf" target="_blank" style="color:var(--slate);text-decoration:none;">old-age dependency ratio nearly triples by 2040</a>. <a href="https://documents1.worldbank.org/curated/en/477421632385962082/pdf/Overview.pdf" target="_blank" style="color:var(--warning);text-decoration:none;">Aging will shave ~0.9 percentage points off annual GDP growth by 2050</a>. Vietnam is getting old before getting rich.</p>
  </div>

  <div class="reveal">
    <p>External shocks are not waiting. In April 2025, the US imposed a <a href="https://www.vietnam-briefing.com/news/us-vietnam-trade-relations-trump-impact-tariff-vietnamese-exports.html/" target="_blank" style="color:var(--red);text-decoration:none;">46% reciprocal tariff</a> on Vietnamese goods. Negotiations reduced this to 20%. The threat exposed a core vulnerability: Vietnam's export model depends on one market absorbing 30% of output.</p>
  </div>

  <div class="reveal">
    <p>The skills gap is stark: Vietnam has approximately <a href="https://en.sggp.org.vn/vietnam-facing-severe-thirst-for-talents-in-strategic-tech-sectors-post123546.html" target="_blank" style="color:var(--red);text-decoration:underline;">1,400 chip engineers</a>. The government's target: 50,000 by 2030. <a href="https://data.worldbank.org/indicator/GB.XPD.RSDV.GD.ZS?locations=VN" target="_blank" style="color:var(--slate);text-decoration:underline;">R&D spending is 0.4% of GDP</a>—Korea escaped the trap at 4.8%. <a href="https://www.worldbank.org/en/country/vietnam/publication/viet-nam-2045-trading-up-in-a-changing-world" target="_blank" style="color:var(--slate);text-decoration:underline;">Only 10% hold a bachelor's degree</a>; only 5% of manufacturing workers are high-skilled.</p>
  </div>

  <div class="reveal">
    <div class="collapsible-sidebar" onclick="this.classList.toggle('open')">
      <div class="collapsible-header">
        <h4>What is the Middle-Income Trap?</h4>
        <span class="collapsible-toggle">▼</span>
      </div>
      <div class="collapsible-content">
        <p>Countries that grow rapidly to ~$10,000-15,000 GDP per capita, then stall. They no longer compete on low wages but haven't developed innovation capacity. Of ~142 countries reaching middle-income since 1960, only 34 escaped. The key factor: <strong>Total Factor Productivity (TFP)</strong>—output growth from innovation rather than just adding labor or capital. Vietnam's R&D is 0.4% of GDP; Korea escaped at 4.8%.</p>
      </div>
    </div>
  </div>

  <div class="reveal">
    <h3 style="margin-top: 2rem;">The Path Forward</h3>
    <p>Vietnam transformed from one of the world's poorest economies to a $475 billion export powerhouse in a single generation. The screwdriver economy was a rational strategy for a poor country seeking industrialization. The question is whether Vietnam can build what comes next before time runs out.</p>
    <p>Success requires moving up the value chain: <a href="https://www.worldbank.org/en/country/vietnam/publication/viet-nam-2045-trading-up-in-a-changing-world" target="_blank" style="color:var(--slate);text-decoration:underline;">developing domestic suppliers</a> who compete with Korean and Taiwanese firms, increasing R&D from 0.4% to 2%+ of GDP, and <a href="https://www.worldbank.org/en/country/vietnam/publication/viet-nam-2045-trading-up-in-a-changing-world" target="_blank" style="color:var(--slate);text-decoration:underline;">strengthening the linkages</a> between foreign investors and local companies. The Party has set an ambitious target of <a href="https://www.reuters.com/world/asia-pacific/vietnams-annual-growth-reaches-8-trade-surplus-with-us-hits-record-despite-2026-01-05/" target="_blank" style="color:var(--slate);text-decoration:underline;">high-income status by 2045</a>.</p>
    <p>The odds are long—only 1 in 4 middle-income countries have made it. But Vietnam has defied the odds before.</p>
  </div>

  <div class="reveal">
    <div class="insight-box" style="border-left-color: var(--gold);">
      <h4>Three Numbers to Remember</h4>
      <p><strong>48%</strong>: Foreign value-added in exports. Vietnam keeps slightly over half.<br>
      <strong>~10 years</strong>: Until the demographic dividend ends.<br>
      <strong>1 in 4</strong>: Historical odds of escaping the middle-income trap.</p>
    </div>
  </div>
</section>

<!-- INTERACTIVE SIMULATOR -->
<section class="section-full" data-section-index="4" style="background: linear-gradient(180deg, var(--dark) 0%, #2a2a2a 100%); padding: 4rem 0;" id="simulator-section">
  <div class="reveal" style="max-width: 1100px; margin: 0 auto; padding: 0 2rem;">
    <div style="text-align: center; margin-bottom: 2.5rem;">
      <span class="chapter-label" style="color: var(--gold);">Interactive Experience</span>
      <h2 style="color: var(--cream);">Build Vietnam: A Policy Simulator</h2>
      <p style="color: rgba(250,247,242,0.7); max-width: 600px; margin: 1rem auto 0;">
        Can you guide Vietnam from $200 GDP per capita to high-income status? Make the policy choices that shaped a nation's economic destiny.
      </p>
    </div>

    <!-- Simulator Container -->
    <div id="simulator" class="simulator-container">

      <!-- Start Screen -->
      <div id="sim-start" class="sim-screen active">
        <div class="sim-start-content">
          <div class="sim-start-flag">&#9733;</div>
          <h3>Can You Beat Vietnam?</h3>
          <p>It's 1986. Vietnam is on the brink: 774% inflation, Soviet aid collapsing, people going hungry. Real Vietnam grew to $4,700 GDP per capita by 2024—impressive, but still in the middle-income trap danger zone ($4,000-12,000).</p>
          <p style="color: var(--gold);">Vietnam made some brilliant moves and some costly mistakes. Can you do better? The demographic window closes by 2036.</p>
          <div class="sim-objectives">
            <div class="sim-objective">
              <span class="sim-obj-icon">&#x1F3AF;</span>
              <span>Escape the trap: reach $13,000+ by 2045</span>
            </div>
            <div class="sim-objective">
              <span class="sim-obj-icon">&#x1F4C8;</span>
              <span>Beat Vietnam's real trajectory</span>
            </div>
            <div class="sim-objective">
              <span class="sim-obj-icon">&#x26A0;</span>
              <span>Avoid Vietnam's policy mistakes</span>
            </div>
          </div>
          <button id="sim-start-btn" class="sim-btn sim-btn-primary">Begin Simulation</button>
        </div>
      </div>

      <!-- Game Screen -->
      <div id="sim-game" class="sim-screen">
        <!-- Dashboard -->
        <div class="sim-dashboard">
          <div class="sim-era-banner" id="sim-era-banner">
            <span class="sim-era-label">Era I</span>
            <span class="sim-era-name">Survival & Stabilization</span>
            <span class="sim-era-years">1986-2000</span>
          </div>

          <div class="sim-metrics">
            <div class="sim-metric">
              <div class="sim-metric-value" id="sim-gdp">$200</div>
              <div class="sim-metric-label">
                GDP per Capita
                <span class="sim-tooltip-trigger" data-tooltip="gdp">&#x24D8;</span>
              </div>
              <div class="sim-metric-bar">
                <div class="sim-metric-fill" id="sim-gdp-bar" style="width: 1.5%"></div>
                <div class="sim-metric-target" style="left: 100%"></div>
              </div>
            </div>
            <div class="sim-metric">
              <div class="sim-metric-value" id="sim-growth">2.8%</div>
              <div class="sim-metric-label">
                GDP Growth
                <span class="sim-tooltip-trigger" data-tooltip="growth">&#x24D8;</span>
              </div>
              <div class="sim-metric-bar">
                <div class="sim-metric-fill growth" id="sim-growth-bar" style="width: 28%"></div>
              </div>
            </div>
            <div class="sim-metric">
              <div class="sim-metric-value" id="sim-fdi">15%</div>
              <div class="sim-metric-label">
                FDI Linkage
                <span class="sim-tooltip-trigger" data-tooltip="fdi">&#x24D8;</span>
              </div>
              <div class="sim-metric-bar">
                <div class="sim-metric-fill fdi" id="sim-fdi-bar" style="width: 15%"></div>
              </div>
            </div>
            <div class="sim-metric warning">
              <div class="sim-metric-value" id="sim-trap">25%</div>
              <div class="sim-metric-label">
                Trap Risk
                <span class="sim-tooltip-trigger" data-tooltip="trap">&#x24D8;</span>
              </div>
              <div class="sim-metric-bar trap">
                <div class="sim-metric-fill trap" id="sim-trap-bar" style="width: 25%"></div>
                <div class="sim-metric-danger" style="left: 80%"></div>
              </div>
            </div>

            <!-- Tooltip popup (shared, positioned by JS) -->
            <div class="sim-tooltip-popup" id="sim-tooltip-popup"></div>
          </div>

          <div class="sim-secondary-metrics">
            <div class="sim-sec-metric">
              <span class="sim-sec-label">Year</span>
              <span class="sim-sec-value" id="sim-year">1986</span>
            </div>
            <div class="sim-sec-metric">
              <span class="sim-sec-label">Stability</span>
              <span class="sim-sec-value" id="sim-stability">60%</span>
            </div>
            <div class="sim-sec-metric">
              <span class="sim-sec-label">Inequality</span>
              <span class="sim-sec-value" id="sim-inequality">0.35</span>
            </div>
            <div class="sim-sec-metric">
              <span class="sim-sec-label">Turn</span>
              <span class="sim-sec-value"><span id="sim-turn">1</span>/15</span>
            </div>
          </div>
        </div>

        <!-- Progress Timeline -->
        <div class="sim-timeline-bar">
          <div class="sim-timeline-track">
            <div class="sim-timeline-progress" id="sim-timeline-progress"></div>
            <div class="sim-timeline-markers" id="sim-timeline-markers">
              <!-- Era markers injected by JS -->
            </div>
          </div>
          <div class="sim-timeline-labels">
            <span>1986</span>
            <span>2000</span>
            <span>2015</span>
            <span>2045</span>
          </div>
        </div>

        <!-- GDP Chart -->
        <div class="sim-chart-container" id="sim-chart-container">
          <div class="sim-chart-header">
            <span class="sim-chart-title">GDP per Capita Trajectory</span>
            <div class="sim-chart-legend">
              <span class="sim-legend-item"><span class="sim-legend-dot player"></span>Your Path</span>
              <span class="sim-legend-item"><span class="sim-legend-dot real"></span>Real Vietnam</span>
            </div>
          </div>
          <div class="sim-chart" id="sim-chart">
            <svg viewBox="0 0 400 150" preserveAspectRatio="none">
              <defs>
                <linearGradient id="playerGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" style="stop-color:var(--gold);stop-opacity:0.3" />
                  <stop offset="100%" style="stop-color:var(--gold);stop-opacity:0" />
                </linearGradient>
              </defs>
              <!-- Grid lines -->
              <line x1="0" y1="37.5" x2="400" y2="37.5" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
              <line x1="0" y1="75" x2="400" y2="75" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
              <line x1="0" y1="112.5" x2="400" y2="112.5" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
              <!-- Target line at $13k -->
              <line x1="0" y1="37.5" x2="400" y2="37.5" stroke="var(--gold)" stroke-width="1" stroke-dasharray="4,4" opacity="0.5"/>
              <!-- Real Vietnam path (static) - based on actual GDP per capita data -->
              <!-- Years: 1986($200), 1989($250), 1992($280), 1995($320), 1998($420), 2001($550), 2004($900), 2007($1150), 2010($1400), 2013($1800), 2016($2200), 2020($2800), 2024($4700), projected to 2045 -->
              <polyline id="sim-real-path" fill="none" stroke="rgba(255,255,255,0.4)" stroke-width="2" stroke-dasharray="5,3"
                points="0,148 20,147.5 41,147.2 61,146.8 81,145.8 102,144.5 122,141 142,138.5 163,136 183,132 203,128 237,122 258,103 285,98 312,82 352,45 400,37"/>
              <!-- Current position marker (2024 @ ~$4,700) -->
              <circle cx="258" cy="103" r="4" fill="rgba(255,255,255,0.6)" stroke="rgba(255,255,255,0.8)" stroke-width="1"/>
              <text x="258" y="96" fill="rgba(255,255,255,0.5)" font-size="8" text-anchor="middle">2024</text>
              <!-- Player path (dynamic) -->
              <path id="sim-player-area" fill="url(#playerGradient)" d=""/>
              <polyline id="sim-player-path" fill="none" stroke="var(--gold)" stroke-width="2.5" points="0,145"/>
            </svg>
            <div class="sim-chart-y-labels">
              <span>$13k</span>
              <span>$10k</span>
              <span>$5k</span>
              <span>$0</span>
            </div>
          </div>
        </div>

        <!-- Decision Area -->
        <div class="sim-decision-area">
          <div class="sim-situation" id="sim-situation">
            <h4 id="sim-situation-title">The Collapse of Central Planning</h4>
            <p id="sim-situation-desc">Agricultural cooperatives are failing. Farmers have no incentive to produce beyond quotas. Food shortages are spreading. You must decide how to reform the agricultural sector.</p>
          </div>

          <div class="sim-choices-header">
            <span class="sim-choices-prompt">Choose your policy:</span>
            <span class="sim-choices-hint">Click a card to decide</span>
          </div>
          <div class="sim-choices" id="sim-choices">
            <!-- Choices will be injected here -->
          </div>

          <!-- History Reveal Panel (shown after choice) -->
          <div class="sim-history-reveal" id="sim-history-reveal">
            <div class="sim-history-header">
              <span class="sim-history-icon">&#x1F4DC;</span>
              <span class="sim-history-label">What Actually Happened</span>
            </div>
            <div class="sim-history-content">
              <p id="sim-history-text"></p>
              <div class="sim-history-comparison" id="sim-history-comparison">
                <!-- Comparison stats injected here -->
              </div>
            </div>
            <button class="sim-btn sim-btn-secondary" id="sim-history-continue">Continue to Next Turn</button>
          </div>
        </div>

        <!-- Event Popup -->
        <div class="sim-event-overlay" id="sim-event-overlay">
          <div class="sim-event-popup" id="sim-event-popup">
            <div class="sim-event-icon" id="sim-event-icon">&#x26A1;</div>
            <h4 id="sim-event-title">Event Title</h4>
            <p id="sim-event-desc">Event description goes here.</p>
            <div class="sim-event-effects" id="sim-event-effects"></div>
            <button class="sim-btn sim-btn-secondary" id="sim-event-close">Continue</button>
          </div>
        </div>
      </div>

      <!-- End Screen -->
      <div id="sim-end" class="sim-screen">
        <div class="sim-end-content">
          <div class="sim-end-icon" id="sim-end-icon">&#9733;</div>
          <h3 id="sim-end-title">Simulation Complete</h3>
          <p id="sim-end-desc">Your results are in.</p>

          <div class="sim-final-stats" id="sim-final-stats">
            <!-- Final stats injected here -->
          </div>

          <div class="sim-end-analysis" id="sim-end-analysis">
            <!-- Analysis injected here -->
          </div>

          <div class="sim-scorecard" id="sim-scorecard">
            <!-- Decision-by-decision scorecard injected here -->
          </div>

          <button id="sim-restart-btn" class="sim-btn sim-btn-primary">Try Again</button>
        </div>
      </div>

    </div>
  </div>
</section>

<style>
/* Simulator Styles */
.simulator-container {
  background: #1e1e1e;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0,0,0,0.4);
  min-height: 600px;
  position: relative;
}

.sim-screen {
  display: none;
  padding: 2rem;
}

.sim-screen.active {
  display: block;
}

/* Start Screen */
.sim-start-content {
  text-align: center;
  max-width: 500px;
  margin: 0 auto;
  padding: 2rem 0;
}

.sim-start-flag {
  font-size: 4rem;
  color: var(--gold);
  margin-bottom: 1rem;
}

.sim-start-content h3 {
  font-family: 'Playfair Display', serif;
  font-size: 2rem;
  color: var(--cream);
  margin-bottom: 1rem;
}

.sim-start-content p {
  color: rgba(250,247,242,0.75);
  margin-bottom: 1rem;
  line-height: 1.6;
}

.sim-objectives {
  background: rgba(255,255,255,0.05);
  border-radius: 6px;
  padding: 1.25rem;
  margin: 1.5rem 0;
  text-align: left;
}

.sim-objective {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  color: rgba(250,247,242,0.85);
  font-size: 0.95rem;
  padding: 0.5rem 0;
}

.sim-obj-icon {
  font-size: 1.2rem;
}

/* Buttons */
.sim-btn {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.85rem;
  letter-spacing: 0.05em;
  padding: 0.85rem 2rem;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
  text-transform: uppercase;
}

.sim-btn-primary {
  background: var(--gold);
  color: var(--dark);
}

.sim-btn-primary:hover {
  background: #e5bc3f;
  transform: translateY(-2px);
}

.sim-btn-secondary {
  background: rgba(255,255,255,0.1);
  color: var(--cream);
  border: 1px solid rgba(255,255,255,0.2);
}

.sim-btn-secondary:hover {
  background: rgba(255,255,255,0.15);
}

/* Dashboard */
.sim-dashboard {
  background: linear-gradient(135deg, #252525 0%, #1a1a1a 100%);
  padding: 1.5rem;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.sim-era-banner {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1.25rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

.sim-era-label {
  background: var(--red);
  color: white;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 0.1em;
  padding: 0.3rem 0.6rem;
  border-radius: 3px;
  text-transform: uppercase;
}

.sim-era-name {
  font-family: 'Playfair Display', serif;
  font-size: 1.1rem;
  color: var(--cream);
  flex: 1;
}

.sim-era-years {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.8rem;
  color: rgba(250,247,242,0.5);
}

.sim-metrics {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 1rem;
}

@media (max-width: 768px) {
  .sim-metrics {
    grid-template-columns: repeat(2, 1fr);
  }
}

.sim-metric {
  background: rgba(255,255,255,0.03);
  border-radius: 6px;
  padding: 1rem;
  border: 1px solid rgba(255,255,255,0.06);
}

.sim-metric.warning .sim-metric-value {
  color: var(--warning);
}

.sim-metric-value {
  font-family: 'Playfair Display', serif;
  font-size: 1.6rem;
  font-weight: 700;
  color: var(--gold);
  margin-bottom: 0.25rem;
}

.sim-metric-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.65rem;
  color: rgba(250,247,242,0.5);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.4rem;
}

/* Tooltip styles */
.sim-tooltip-trigger {
  cursor: help;
  font-size: 0.7rem;
  opacity: 0.6;
  transition: opacity 0.2s;
}

.sim-tooltip-trigger:hover {
  opacity: 1;
}

.sim-tooltip-popup {
  position: fixed;
  background: rgba(20, 18, 15, 0.98);
  border: 1px solid rgba(212,175,55,0.5);
  border-radius: 8px;
  padding: 1rem 1.2rem;
  width: 260px;
  font-size: 0.8rem;
  line-height: 1.6;
  color: rgba(250,247,242,0.95);
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s, visibility 0.2s;
  box-shadow: 0 8px 32px rgba(0,0,0,0.6);
  pointer-events: none;
  text-align: left;
}

.sim-tooltip-popup.active {
  opacity: 1;
  visibility: visible;
}

.sim-tooltip-popup::before {
  content: '';
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  border-left: 8px solid transparent;
  border-right: 8px solid transparent;
  border-bottom: 8px solid rgba(212,175,55,0.5);
}

.sim-tooltip-popup strong {
  color: var(--gold);
  display: block;
  margin-bottom: 0.5rem;
  font-size: 0.85rem;
  font-weight: 600;
}

.sim-metric-bar {
  height: 4px;
  background: rgba(255,255,255,0.1);
  border-radius: 2px;
  position: relative;
  overflow: visible;
}

.sim-metric-fill {
  height: 100%;
  background: var(--gold);
  border-radius: 2px;
  transition: width 0.5s ease;
}

.sim-metric-fill.growth {
  background: var(--accent-green);
}

.sim-metric-fill.fdi {
  background: var(--accent-blue);
}

.sim-metric-fill.trap {
  background: var(--warning);
}

.sim-metric-target,
.sim-metric-danger {
  position: absolute;
  top: -3px;
  width: 2px;
  height: 10px;
  background: var(--gold);
  border-radius: 1px;
}

.sim-metric-danger {
  background: var(--red);
}

.sim-secondary-metrics {
  display: flex;
  justify-content: center;
  gap: 2rem;
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid rgba(255,255,255,0.06);
}

.sim-sec-metric {
  text-align: center;
}

.sim-sec-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.6rem;
  color: rgba(250,247,242,0.4);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  display: block;
  margin-bottom: 0.2rem;
}

.sim-sec-value {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.9rem;
  color: var(--cream);
}

/* Decision Area */
.sim-decision-area {
  padding: 1.5rem 2rem 2rem;
}

.sim-situation {
  background: rgba(218,37,29,0.08);
  border-left: 3px solid var(--red);
  padding: 1.25rem 1.5rem;
  margin-bottom: 1.5rem;
  border-radius: 0 6px 6px 0;
}

.sim-situation h4 {
  font-family: 'Playfair Display', serif;
  font-size: 1.15rem;
  color: var(--cream);
  margin-bottom: 0.5rem;
}

.sim-situation p {
  color: rgba(250,247,242,0.75);
  font-size: 0.95rem;
  line-height: 1.6;
  margin: 0;
}

.sim-choices {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
}

@media (max-width: 700px) {
  .sim-choices {
    grid-template-columns: 1fr;
  }
}

/* Choices header */
.sim-choices-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
  padding: 0 0.25rem;
}

.sim-choices-prompt {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.8rem;
  color: var(--gold);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  font-weight: 600;
}

.sim-choices-hint {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.7rem;
  color: rgba(250,247,242,0.4);
  display: flex;
  align-items: center;
  gap: 0.4rem;
}

.sim-choices-hint::before {
  content: '👇';
  font-size: 0.85rem;
}

.sim-choice {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 8px;
  padding: 1.25rem;
  cursor: pointer;
  transition: all 0.25s ease;
  text-align: left;
  position: relative;
}

.sim-choice::after {
  content: 'SELECT →';
  position: absolute;
  top: 1rem;
  right: 1rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.6rem;
  color: rgba(212,175,55,0.4);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  transition: all 0.25s ease;
}

.sim-choice:hover {
  background: rgba(255,255,255,0.06);
  border-color: var(--gold);
  transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(212,175,55,0.15);
}

.sim-choice:hover::after {
  color: var(--gold);
}

.sim-choice-title {
  font-family: 'Playfair Display', serif;
  font-size: 1rem;
  color: var(--cream);
  margin-bottom: 0.5rem;
}

.sim-choice-desc {
  font-size: 0.85rem;
  color: rgba(250,247,242,0.6);
  line-height: 1.5;
  margin-bottom: 0.75rem;
}

.sim-choice-effects {
  display: flex;
  flex-wrap: wrap;
  gap: 0.4rem;
}

.sim-effect {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.7rem;
  padding: 0.2rem 0.5rem;
  border-radius: 3px;
}

.sim-effect.positive {
  background: rgba(45,106,79,0.25);
  color: #6fcf97;
}

.sim-effect.negative {
  background: rgba(218,37,29,0.2);
  color: #eb8585;
}

.sim-effect.neutral {
  background: rgba(255,255,255,0.1);
  color: rgba(250,247,242,0.7);
}

/* Event Overlay */
.sim-event-overlay {
  display: none;
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.85);
  z-index: 100;
  align-items: center;
  justify-content: center;
  padding: 2rem;
}

.sim-event-overlay.active {
  display: flex;
}

.sim-event-popup {
  background: #252525;
  border-radius: 12px;
  padding: 2rem;
  max-width: 450px;
  text-align: center;
  border: 1px solid rgba(255,255,255,0.1);
  animation: popIn 0.3s ease;
}

@keyframes popIn {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.sim-event-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
}

.sim-event-popup h4 {
  font-family: 'Playfair Display', serif;
  font-size: 1.3rem;
  color: var(--cream);
  margin-bottom: 0.75rem;
}

.sim-event-popup p {
  color: rgba(250,247,242,0.75);
  font-size: 0.95rem;
  line-height: 1.6;
  margin-bottom: 1rem;
}

.sim-event-effects {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-bottom: 1.5rem;
}

/* End Screen */
.sim-end-content {
  text-align: center;
  max-width: 550px;
  margin: 0 auto;
  padding: 2rem 0;
}

.sim-end-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
}

.sim-end-content h3 {
  font-family: 'Playfair Display', serif;
  font-size: 2rem;
  color: var(--cream);
  margin-bottom: 0.75rem;
}

.sim-end-content > p {
  color: rgba(250,247,242,0.7);
  margin-bottom: 1.5rem;
}

.sim-final-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.sim-final-stat {
  background: rgba(255,255,255,0.05);
  border-radius: 6px;
  padding: 1rem;
}

.sim-final-stat-value {
  font-family: 'Playfair Display', serif;
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--gold);
}

.sim-final-stat-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.65rem;
  color: rgba(250,247,242,0.5);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-top: 0.25rem;
}

.sim-end-analysis {
  background: rgba(255,255,255,0.03);
  border-radius: 8px;
  padding: 1.25rem;
  margin-bottom: 1.5rem;
  text-align: left;
}

.sim-end-analysis h4 {
  font-family: 'Playfair Display', serif;
  font-size: 1rem;
  color: var(--cream);
  margin-bottom: 0.5rem;
}

.sim-end-analysis p {
  color: rgba(250,247,242,0.7);
  font-size: 0.9rem;
  line-height: 1.6;
  margin: 0;
}

/* Scorecard Styles */
.sim-scorecard {
  background: rgba(255,255,255,0.03);
  border-radius: 8px;
  padding: 1.25rem;
  margin-bottom: 1.5rem;
  text-align: left;
  max-height: 300px;
  overflow-y: auto;
}

.sim-scorecard h4 {
  font-family: 'Playfair Display', serif;
  font-size: 1rem;
  color: var(--cream);
  margin-bottom: 0.75rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.sim-scorecard-summary {
  font-size: 0.75rem;
  color: rgba(250,247,242,0.6);
  font-family: var(--font-sans);
}

.sim-scorecard-row {
  display: flex;
  align-items: flex-start;
  padding: 0.5rem 0;
  border-bottom: 1px solid rgba(255,255,255,0.05);
  gap: 0.75rem;
}

.sim-scorecard-row:last-child {
  border-bottom: none;
}

.sim-scorecard-turn {
  font-size: 0.65rem;
  color: rgba(250,247,242,0.4);
  min-width: 2rem;
  padding-top: 0.15rem;
}

.sim-scorecard-verdict {
  font-size: 0.9rem;
  min-width: 1.5rem;
}

.sim-scorecard-content {
  flex: 1;
}

.sim-scorecard-title {
  font-size: 0.8rem;
  color: rgba(250,247,242,0.9);
  font-weight: 500;
}

.sim-scorecard-match {
  font-size: 0.7rem;
  margin-top: 0.15rem;
}

.sim-scorecard-match.same {
  color: #6fcf97;
}

.sim-scorecard-match.different {
  color: var(--gold);
}

.sim-scorecard-match.better {
  color: #3498db;
}

.sim-outcome-win {
  color: #6fcf97;
}

.sim-outcome-lose {
  color: #eb8585;
}

/* Progress Timeline */
.sim-timeline-bar {
  padding: 0 1.5rem;
  margin-bottom: 1rem;
}

.sim-timeline-track {
  height: 6px;
  background: rgba(255,255,255,0.1);
  border-radius: 3px;
  position: relative;
  overflow: visible;
}

.sim-timeline-progress {
  height: 100%;
  background: linear-gradient(90deg, var(--red), var(--gold));
  border-radius: 3px;
  width: 0%;
  transition: width 0.5s ease;
  position: relative;
}

.sim-timeline-progress::after {
  content: '';
  position: absolute;
  right: -4px;
  top: -3px;
  width: 12px;
  height: 12px;
  background: var(--gold);
  border-radius: 50%;
  box-shadow: 0 0 10px rgba(242,201,76,0.5);
}

.sim-timeline-markers {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 100%;
  pointer-events: none;
}

.sim-timeline-marker {
  position: absolute;
  top: -8px;
  width: 2px;
  height: 22px;
  background: rgba(255,255,255,0.3);
}

.sim-timeline-marker.era {
  background: var(--red);
  width: 3px;
}

.sim-timeline-labels {
  display: flex;
  justify-content: space-between;
  margin-top: 0.5rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.7rem;
  color: rgba(250,247,242,0.85);
}

/* GDP Chart */
.sim-chart-container {
  background: rgba(0,0,0,0.2);
  border-radius: 6px;
  padding: 1rem 1.5rem;
  margin: 0 1.5rem 1rem;
  border: 1px solid rgba(255,255,255,0.05);
}

.sim-chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.75rem;
}

.sim-chart-title {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.75rem;
  color: rgba(250,247,242,0.9);
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.sim-chart-legend {
  display: flex;
  gap: 1rem;
}

.sim-legend-item {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.7rem;
  color: rgba(250,247,242,0.9);
}

.sim-legend-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.sim-legend-dot.player {
  background: var(--gold);
}

.sim-legend-dot.real {
  background: rgba(255,255,255,0.7);
  border: 1px dashed rgba(255,255,255,0.5);
}

.sim-chart {
  position: relative;
  height: 150px;
}

.sim-chart svg {
  width: 100%;
  height: 100%;
}

.sim-chart-y-labels {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 0 0.5rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.65rem;
  color: rgba(250,247,242,0.8);
  pointer-events: none;
}

/* History Reveal Panel */
.sim-history-reveal {
  display: none;
  background: linear-gradient(135deg, rgba(45,106,79,0.15) 0%, rgba(27,73,101,0.15) 100%);
  border: 1px solid rgba(111,207,151,0.3);
  border-radius: 8px;
  padding: 1.5rem;
  margin-top: 1rem;
  animation: slideUp 0.4s ease;
}

.sim-history-reveal.active {
  display: block;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.sim-history-header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.sim-history-icon {
  font-size: 1.3rem;
}

.sim-history-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.75rem;
  color: #6fcf97;
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

.sim-history-content p {
  color: rgba(250,247,242,0.85);
  font-size: 0.95rem;
  line-height: 1.65;
  margin-bottom: 1rem;
}

.sim-history-comparison {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.75rem;
  margin-bottom: 1.25rem;
}

@media (max-width: 600px) {
  .sim-history-comparison {
    grid-template-columns: 1fr;
  }
}

.sim-comparison-stat {
  background: rgba(0,0,0,0.2);
  border-radius: 6px;
  padding: 0.75rem;
  text-align: center;
}

.sim-comparison-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.6rem;
  color: rgba(250,247,242,0.5);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  display: block;
  margin-bottom: 0.3rem;
}

.sim-comparison-values {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.5rem;
}

.sim-comparison-yours {
  font-family: 'Playfair Display', serif;
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--gold);
}

.sim-comparison-vs {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.6rem;
  color: rgba(250,247,242,0.4);
}

.sim-comparison-real {
  font-family: 'Playfair Display', serif;
  font-size: 1.1rem;
  font-weight: 700;
  color: rgba(255,255,255,0.5);
}

/* Branching indicator */
.sim-branch-warning {
  background: rgba(230,126,34,0.15);
  border: 1px solid rgba(230,126,34,0.3);
  border-radius: 6px;
  padding: 0.75rem 1rem;
  margin-top: 0.75rem;
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
}

.sim-branch-warning-icon {
  font-size: 1rem;
  flex-shrink: 0;
}

.sim-branch-warning-text {
  font-size: 0.85rem;
  color: rgba(250,247,242,0.8);
  line-height: 1.5;
}

.sim-branch-warning-text strong {
  color: var(--warning);
}

/* Locked choice styling */
.sim-choice.locked {
  opacity: 0.5;
  pointer-events: none;
  position: relative;
}

.sim-choice.locked::after {
  content: '🔒 Locked by previous choices';
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.65rem;
  color: rgba(250,247,242,0.5);
}

.sim-choice.boosted {
  border-color: rgba(111,207,151,0.5);
  background: rgba(45,106,79,0.1);
}

.sim-choice.boosted::after {
  content: '⚡ BOOSTED';
  color: #6fcf97;
}

.sim-choice.boosted:hover::after {
  color: #6fcf97;
}
</style>

<!-- SOURCES -->
<section class="section" style="padding-top: 1rem;">
  <div class="reveal">
    <div class="sources-section">
      <h4>Sources</h4>

      <h5>Institutional & Multilateral Organizations</h5>
      <p>
        <a href="https://www.imf.org/en/Publications/CR/Issues/2025/10/03/Vietnam-2025-Article-IV-Consultation-Press-Release-Staff-Report-and-Statement-by-the-570895" target="_blank" style="color:#777;">IMF. Vietnam 2025 Article IV Consultation</a>.<br>
        <a href="https://www.imf.org/-/media/Files/Publications/CR/2025/English/1vnmea2025002-source-pdf.ashx" target="_blank" style="color:#777;">IMF. Vietnam 2025 Article IV Selected Issues (TFP analysis)</a>.<br>
        <a href="https://www.imf.org/external/pubs/ft/wp/2015/wp1502.pdf" target="_blank" style="color:#777;">IMF. Working Paper on Middle-Income Trap</a>.<br>
        <a href="https://www.imf.org/en/news/articles/2024/09/27/pr24347-vietnam-imf-exec-board-concludes-2024-article-iv-consult" target="_blank" style="color:#777;">IMF. 2024 Article IV Consultation Press Release</a>.<br>
        <a href="https://www.worldbank.org/en/country/vietnam/overview.print" target="_blank" style="color:#777;">World Bank. Vietnam Overview</a>.<br>
        <a href="https://data.worldbank.org/country/viet-nam" target="_blank" style="color:#777;">World Bank Open Data. Vietnam Country Data</a>.<br>
        <a href="https://openknowledge.worldbank.org/bitstreams/0d31f96d-f94d-5130-9a9c-a47ea462190f/download" target="_blank" style="color:#777;">World Bank. Vietnam at a Crossroads</a>.<br>
        <a href="https://www.worldbank.org/en/country/vietnam/publication/viet-nam-2045-trading-up-in-a-changing-world" target="_blank" style="color:#777;">World Bank. Viet Nam 2045: Trading Up in a Changing World</a>.<br>
        <a href="https://documents1.worldbank.org/curated/en/099750106152251112/pdf/P1595780c3ae6907a09675024da3f743488.pdf" target="_blank" style="color:#777;">World Bank. Vietnam: Toward High-Quality FDI</a>.<br>
        <a href="https://documents1.worldbank.org/curated/en/261221506064451984/pdf/119861-WP-EnhancingEnterpriseCompetitivenessandSMELinkagesPPostD-PUBLIC.pdf" target="_blank" style="color:#777;">World Bank. Enhancing Enterprise Competitiveness and SME Linkages</a>.<br>
        <a href="https://documents1.worldbank.org/curated/en/338961578925176972/pdf/Vietnam-Connecting-Value-Chains-for-Trade-Competitiveness.pdf" target="_blank" style="color:#777;">World Bank. Connecting Value Chains for Trade Competitiveness</a>.<br>
        <a href="https://documents1.worldbank.org/curated/en/201841468616790980/pdf/107004-WP-PUBLIC.pdf" target="_blank" style="color:#777;">World Bank. Vietnam Demographics: Working-Age Population Projections</a>.<br>
        <a href="https://documents1.worldbank.org/curated/en/544371632385243499/pdf/Vietnam-Adapting-to-an-Aging-Society.pdf" target="_blank" style="color:#777;">World Bank. Vietnam: Adapting to an Aging Society</a>.<br>
        <a href="https://documents1.worldbank.org/curated/en/477421632385962082/pdf/Overview.pdf" target="_blank" style="color:#777;">World Bank. Vietnam Long-Term Growth Modeling Overview</a>.<br>
        <a href="https://www.worldbank.org/en/news/press-release/2020/05/21/decisive-reforms-needed-for-vietnam-to-see-full-benefits-of-eu-trade-agreement-report" target="_blank" style="color:#777;">World Bank. EVFTA Impact Assessment</a>.<br>
        <a href="https://databankfiles.worldbank.org/public/ddpext_download/poverty/33EF03BB-9722-4AE2-ABC7-AA2972D68AFE/Global_POVEQ_VNM.pdf" target="_blank" style="color:#777;">World Bank. Global Poverty & Equity Data: Vietnam</a>.<br>
        <a href="https://www.oecd.org/en/publications/oecd-economic-surveys-viet-nam-2025_fb37254b-en/full-report/harnessing-trade-and-investment-flows-to-boost-productivity_98d56c90.html" target="_blank" style="color:#777;">OECD. Harnessing Trade and Investment Flows to Boost Productivity (2025)</a>.<br>
        <a href="https://www.oecd.org/content/dam/oecd/en/topics/policy-sub-issues/trade-in-value-added/tiva-2023-VNM.pdf" target="_blank" style="color:#777;">OECD. Trade in Value Added (TiVA): Vietnam Country Note 2023</a>.<br>
        <a href="https://www.adb.org/publications/role-total-factor-productivity-growth-middle-income-countries" target="_blank" style="color:#777;">ADB. The Role of Total Factor Productivity Growth in Middle-Income Countries</a>.<br>
        <a href="https://web.wtocenter.org.tw/file/PageFile/359006/WTTPRS410R1.pdf" target="_blank" style="color:#777;">WTO. Trade Policy Review: Viet Nam 2021</a>.<br>
        <a href="https://www.wto.org/english/thewto_e/acc_e/a1_vietnam_e.htm" target="_blank" style="color:#777;">WTO. Accessions: Viet Nam</a>.<br>
        <a href="https://www.ilo.org/media/346061/download" target="_blank" style="color:#777;">ILO. Export and FDI-Driven Industrialization</a>.
      </p>

      <h5>Government & Official Sources</h5>
      <p>
        <a href="https://www.nso.gov.vn/en/highlight/2025/02/socio-economic-situation-in-the-fourth-quarter-and-2024/" target="_blank" style="color:#777;">General Statistics Office of Vietnam (GSO). Socio-Economic Situation Q4 2024</a>.<br>
        <a href="https://www.customs.gov.vn/index.jsp?pageId=2281&aid=209418" target="_blank" style="color:#777;">Vietnam Customs. Full-Year 2024 Trade Statistics ($411.61B exports)</a>.<br>
        <a href="https://vn.usembassy.gov/the-u-s-vietnam-bilateral-trade-agreement-bta-resources-for-understanding/" target="_blank" style="color:#777;">U.S. Embassy Vietnam. Bilateral Trade Agreement Resources</a>.<br>
        <a href="https://www.state.gov/reports/2019-investment-climate-statements/vietnam/" target="_blank" style="color:#777;">U.S. Department of State. 2019 Investment Climate Statements: Vietnam</a>.<br>
        <a href="https://www.trade.gov/country-commercial-guides/vietnam-trade-agreements" target="_blank" style="color:#777;">International Trade Administration. Vietnam Trade Agreements</a>.<br>
        <a href="https://moit.gov.vn/tin-tuc/phat-trien-nguon-nhan-luc/thu-tuong-pham-minh-chinh-tap-trung-dao-tao-50-100-nghin-nhan-luc-nganh-cong-nghiep-ban-dan-giai-doan-2025-2030.html" target="_blank" style="color:#777;">Vietnam Ministry of Industry and Trade. Semiconductor Workforce Training Targets</a>.
      </p>

      <h5>Major News & Analysis</h5>
      <p>
        <a href="https://thediplomat.com/2026/01/vietnams-economy-grew-by-more-than-8-percent-in-2025-government-says/" target="_blank" style="color:#777;">The Diplomat. Vietnam's Economy Grew By More Than 8 Percent in 2025</a>.<br>
        <a href="https://www.cnbc.com/2025/04/08/vietnam-emerged-as-a-trade-winner-trump-new-tariffs-may-disrupt-that.html" target="_blank" style="color:#777;">CNBC. Vietnam Has Been a Big Beneficiary of Global Trade</a>.<br>
        <a href="https://www.cnbc.com/2025/04/12/vietnam-reciprocal-tariffs-reflect-trade-deficit-and-ties-to-china.html" target="_blank" style="color:#777;">CNBC. Vietnam Reciprocal Tariffs Reflect Trade Deficit and Ties to China</a>.<br>
        <a href="https://e.vnexpress.net/news/business/economy/vietnam-stands-on-the-shoulders-of-giants-fails-to-grow-4682307.html" target="_blank" style="color:#777;">VnExpress. Vietnam Stands on the Shoulders of Giants, Fails to Grow</a>.
      </p>

      <h5>Vietnamese Media</h5>
      <p>
        <a href="https://vietnamnet.vn/en/vietnam-s-economy-takes-off-enters-upper-middle-income-bracket-2483165.html" target="_blank" style="color:#777;">VietnamNet. Vietnam's Economy Takes Off, Enters Upper-Middle Income Bracket</a>.<br>
        <a href="https://vietnamnet.vn/en/vietnam-s-record-exports-and-the-hidden-fragility-of-its-economy-2474047.html" target="_blank" style="color:#777;">VietnamNet. Vietnam's Record Exports and the Hidden Fragility of Its Economy</a>.<br>
        <a href="https://theinvestor.vn/korean-chaebol-samsungs-revenue-makes-up-13-of-vietnams-gdp-in-2024-d16297.html" target="_blank" style="color:#777;">The Investor. Samsung's Revenue Makes Up 13% of Vietnam's GDP</a>.<br>
        <a href="https://theinvestor.vn/intel-urged-to-expand-chip-packaging-testing-operations-in-vietnam-d17920.html" target="_blank" style="color:#777;">The Investor. Intel Urged to Expand Chip Operations in Vietnam</a>.
      </p>

      <h5>Vietnam Briefing (Dezan Shira & Associates)</h5>
      <p>
        <a href="https://www.vietnam-briefing.com/doing-business-guide/vietnam/why-vietnam/economic-indicators-and-vietnam-s-gdp-fdi-and-trade-trends" target="_blank" style="color:#777;">Vietnam Briefing. Economic Indicators, FDI, and Trade Trends</a>.<br>
        <a href="https://www.vietnam-briefing.com/news/apple-manufacturers-vietnam.html/" target="_blank" style="color:#777;">Vietnam Briefing. Apple Suppliers in Vietnam</a>.<br>
        <a href="https://www.vietnam-briefing.com/news/us-vietnam-trade-relations-trump-impact-tariff-vietnamese-exports.html/" target="_blank" style="color:#777;">Vietnam Briefing. Impact of Tariffs by President Trump</a>.
      </p>

      <h5>Data & Statistics</h5>
      <p>
        <a href="https://www.indexmundi.com/facts/vietnam/indicator/NE.EXP.GNFS.ZS" target="_blank" style="color:#777;">IndexMundi/World Bank. Vietnam Exports of Goods and Services (% of GDP)</a>.<br>
        <a href="https://www.theglobaleconomy.com/Vietnam/exports/" target="_blank" style="color:#777;">TheGlobalEconomy. Vietnam Exports</a>.<br>
        <a href="https://www.macrotrends.net/global-metrics/countries/vnm/vietnam/trade-gdp-ratio" target="_blank" style="color:#777;">MacroTrends. Vietnam Trade to GDP Ratio</a>.<br>
        <a href="https://tradingeconomics.com/vietnam/gdp-growth-annual" target="_blank" style="color:#777;">Trading Economics. Vietnam GDP Annual Growth Rate</a>.<br>
        <a href="https://www.ceicdata.com/en/indicator/vietnam/government-debt--of-nominal-gdp" target="_blank" style="color:#777;">CEIC Data. Vietnam Government Debt: % of GDP</a>.<br>
        <a href="https://ec.europa.eu/eurostat/statistics-explained/SEPDF/cache/71515.pdf" target="_blank" style="color:#777;">Eurostat. ASEAN-EU International Trade in Goods Statistics</a>.
      </p>

      <h5>Academic & Research</h5>
      <p>
        <a href="https://www.ucl.ac.uk/social-historical-sciences/sites/social_historical_sciences/files/decoding_vietnams_economic_miracle.pdf" target="_blank" style="color:#777;">UCL. Decoding Vietnam's Economic Miracle</a>.<br>
        <a href="https://documents1.worldbank.org/curated/en/939241468127820747/pdf/669250WP00PUBL00Luoc0su0TA-pdf0i007.pdf" target="_blank" style="color:#777;">World Bank. Vietnam: A Short History of Economic Reform</a>.<br>
        <a href="https://www.nber.org/system/files/working_papers/w29830/w29830.pdf" target="_blank" style="color:#777;">NBER. US-Vietnam Bilateral Trade Agreement Impact</a>.<br>
        <a href="https://voxdev.org/topic/trade/lowering-barriers-trade-impact-vietnam" target="_blank" style="color:#777;">VoxDev. Lowering Barriers to Trade: Impact on Vietnam</a>.<br>
        <a href="https://documents.worldbank.org/en/publication/documents-reports/documentdetail/352041468338949354/export-liberalization-job-creation-and-the-skill-premium-evidence-from-the-u-s-vietnam-bilateral-trade-agreement" target="_blank" style="color:#777;">World Bank. Export Liberalization, Job Creation, and the Skill Premium</a>.<br>
        <a href="https://www.eria.org/uploads/9_ch_5-FDI-and-Industrialisation-VietNam.pdf" target="_blank" style="color:#777;">ERIA. FDI and Industrialisation in Vietnam</a>.<br>
        <a href="https://www.eria.org/uploads/media/Research-Project-Report/RPR_FY2009_2_Chapter_7.pdf" target="_blank" style="color:#777;">ERIA. Productivity Spillovers from FDI in Vietnam</a>.<br>
        <a href="https://www.eria.org/uploads/media/ERIA_DP_no.293.pdf" target="_blank" style="color:#777;">ERIA. Value-Added Exports and Local Labor Market in Vietnam</a>.<br>
        <a href="https://www.amro-asia.org/wp-content/uploads/2021/05/The-Role-of-Vietnams-FDI-Inflows-in-Global-Value-Chains-Participation-and-Economic-Growth.pdf" target="_blank" style="color:#777;">AMRO. Vietnam's FDI Inflows in Global Value Chains</a>.<br>
        <a href="https://www.econstor.eu/bitstream/10419/305849/1/id482.pdf" target="_blank" style="color:#777;">econstor. The Effect of Institutions on Productivity Spillovers from FDI</a>.<br>
        <a href="https://vietnam.un.org/sites/default/files/2019-08/NTA%20Executive%20Summary_ENG_FINAL.pdf" target="_blank" style="color:#777;">UNFPA/UN. Vietnam Demographic Dividend Analysis</a>.<br>
        <a href="https://www.tresor.economie.gouv.fr/Articles/1bb7ebaa-6a0d-42d0-b22b-6ed06fefdcd9/files/0c7af478-2c44-4b5f-8889-64cbd15a5c45" target="_blank" style="color:#777;">French Treasury. Vietnam's Domestic Value-Added in Exports</a>.<br>
        <a href="https://voxchina.org/show-3-392.html" target="_blank" style="color:#777;">VoxChina. Exports in Disguise: Trade Rerouting During the US-China Trade War</a>.<br>
        <a href="https://www.researchgate.net/publication/392818115_The_paradox_of_FDI_in_Vietnam" target="_blank" style="color:#777;">ResearchGate. The Paradox of FDI in Vietnam</a>.<br>
        <a href="https://ideas.repec.org/p/ags/pugtwp/333169.html" target="_blank" style="color:#777;">Economic and Distributional Impacts of the EVFTA and CPTPP in Vietnam</a>.
      </p>

      <h5>Think Tanks & Policy Analysis</h5>
      <p>
        <a href="https://www.mufgresearch.com/fx/vietnam-doi-moi-20-the-most-ambitious-structural-reforms-since-1986-21-august-2025/" target="_blank" style="color:#777;">MUFG Research. Vietnam: Doi Moi 2.0</a>.<br>
        <a href="https://www.policycenter.ma/opinion/vietnam-currency-manipulator-implications-developing-countries-%E2%80%93-comments-us-treasury-report" target="_blank" style="color:#777;">Policy Center for the New South. Is Vietnam a Currency Manipulator?</a>.<br>
        <a href="https://thevietnamese.org/2025/10/chasing-the-2045-dream-what-are-the-bottlenecks-holding-viet-nam-back/" target="_blank" style="color:#777;">The Vietnamese Magazine. Chasing the 2045 Dream</a>.
      </p>

      <h5>Supply Chain & Manufacturing</h5>
      <p>
        <a href="https://www.z2data.com/insights/everything-you-need-to-know-about-china-plus-one" target="_blank" style="color:#777;">Z2Data. Everything You Need to Know About China Plus One</a>.<br>
        <a href="https://vietnam.incorp.asia/vietnam-labor-cost/" target="_blank" style="color:#777;">InCorp Vietnam. How Vietnam Labor Costs Attract Foreign Companies</a>.<br>
        <a href="https://www.vietnamexportdata.com/blogs/vietnam-electronics-exports-2025-data-report" target="_blank" style="color:#777;">Vietnam Export Data. Electronics Exports 2025</a>.
      </p>

          </div>
  </div>
</section>

<footer class="footer">
  The Screwdriver Economy: Vietnam's Export Model and Its Structural Weaknesses<br>
  A Macroeconomics Group Project &mdash; February 2026<br>
  Data as of January 2025
</footer>

<script>
  // ==========================================
  // PROGRESS BAR
  // ==========================================
  window.addEventListener('scroll', () => {
    const scrollTop = document.documentElement.scrollTop;
    const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
    const progress = (scrollTop / scrollHeight) * 100;
    document.getElementById('progressBar').style.width = progress + '%';
  });

  // ==========================================
  // REVEAL ANIMATIONS
  // ==========================================
  const revealElements = document.querySelectorAll('.reveal');
  const revealObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
      }
    });
  }, { threshold: 0.12, rootMargin: '0px 0px -40px 0px' });

  revealElements.forEach(el => revealObserver.observe(el));

  // ==========================================
  // INTERSTITIAL ANIMATIONS
  // ==========================================
  const interstitials = document.querySelectorAll('.interstitial-content');
  const interstitialObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
      }
    });
  }, { threshold: 0.3 });

  interstitials.forEach(el => interstitialObserver.observe(el));

  // ==========================================
  // COUNT-UP ANIMATIONS
  // ==========================================
  const counters = document.querySelectorAll('.count-up');
  const counterObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const el = entry.target;
        const target = parseInt(el.dataset.target);
        if (!target || el.dataset.animated) return;
        el.dataset.animated = 'true';
        let current = 0;
        const duration = 1500;
        const step = target / (duration / 16);
        const tick = () => {
          current += step;
          if (current >= target) {
            el.textContent = target;
            return;
          }
          el.textContent = Math.floor(current);
          requestAnimationFrame(tick);
        };
        tick();
      }
    });
  }, { threshold: 0.5 });

  counters.forEach(el => counterObserver.observe(el));

  // ==========================================
  // BAR CHART ANIMATIONS
  // ==========================================
  const barCharts = document.querySelectorAll('.bar-chart');
  const barObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting && !entry.target.dataset.animated) {
        entry.target.dataset.animated = 'true';
        const bars = entry.target.querySelectorAll('.bar-fill');
        bars.forEach((bar, i) => {
          setTimeout(() => {
            bar.style.width = bar.dataset.width + '%';
          }, i * 100);
        });
      }
    });
  }, { threshold: 0.25 });

  barCharts.forEach(el => barObserver.observe(el));

  // ==========================================
  // DONUT CHART ANIMATION
  // ==========================================
  const donutChart = document.getElementById('donutChart');
  const donutObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting && !entry.target.dataset.animated) {
        entry.target.dataset.animated = 'true';
        const segments = entry.target.querySelectorAll('.donut-segment');
        segments.forEach((seg, i) => {
          const target = parseFloat(seg.dataset.target);
          const offset = parseFloat(seg.dataset.offset) || 0;
          setTimeout(() => {
            seg.style.transition = 'stroke-dasharray 1s ease';
            seg.style.strokeDasharray = `${target} ${471 - target}`;
            seg.style.strokeDashoffset = `-${offset}`;
          }, i * 150);
        });
      }
    });
  }, { threshold: 0.25 });

  if (donutChart) donutObserver.observe(donutChart);

  // ==========================================
  // STICKY EXPORT COUNTER
  // ==========================================
  const stickyCounter = document.getElementById('stickyCounter');
  const counterValue = document.getElementById('counterValue');
  const counterEra = document.getElementById('counterEra');
  const counterSubtitle = document.getElementById('counterSubtitle');
  let currentExportValue = 2.4;
  let targetExportValue = 2.4;

  // Each section shows Vietnam's exports at different points in history
  // Updated for 3-act structure
  const exportSections = [
    { index: 1, start: 2.4, end: 150, era: '1986 → 2015', subtitle: 'Act I: The Boom' },
    { index: 2, start: 150, end: 336, era: '2015 → 2024', subtitle: 'Act II: The Screwdriver Economy' },
    { index: 3, start: 336, end: 475, era: '2024 → 2035', subtitle: 'Act III: The Window Closes' },
    { index: 4, start: 475, end: 475, era: '2025+', subtitle: 'Will Vietnam escape the trap?', pulsing: true }
  ];

  function formatExportValue(val) {
    if (val >= 1000) return '$' + (val / 1000).toFixed(1) + 'T';
    if (val >= 100) return '$' + Math.round(val) + 'B';
    if (val >= 10) return '$' + val.toFixed(1) + 'B';
    return '$' + val.toFixed(1) + 'B';
  }

  function animateCounter(from, to, duration = 1000) {
    const startTime = performance.now();
    const animate = (currentTime) => {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const easeProgress = 1 - Math.pow(1 - progress, 3);
      currentExportValue = from + (to - from) * easeProgress;
      counterValue.textContent = formatExportValue(currentExportValue);
      if (progress < 1) requestAnimationFrame(animate);
    };
    requestAnimationFrame(animate);
  }

  // Show counter after scrolling past hero
  const heroSection = document.querySelector('.hero');
  const counterShowObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (!entry.isIntersecting) {
        stickyCounter.classList.add('visible');
      } else {
        stickyCounter.classList.remove('visible');
      }
    });
  }, { threshold: 0.1 });
  counterShowObserver.observe(heroSection);

  // Update counter based on section
  const sectionElements = document.querySelectorAll('[data-section-index]');
  const sectionObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const sectionIndex = parseInt(entry.target.dataset.sectionIndex);
        const sectionData = exportSections.find(s => s.index === sectionIndex);
        if (sectionData) {
          // Update era and subtitle
          counterEra.textContent = sectionData.era;
          counterSubtitle.textContent = sectionData.subtitle;

          if (sectionData.pulsing) {
            stickyCounter.classList.add('pulsing');
          } else {
            stickyCounter.classList.remove('pulsing');
          }
          if (targetExportValue !== sectionData.end) {
            animateCounter(currentExportValue, sectionData.end, 1500);
            targetExportValue = sectionData.end;
          }
        }
      }
    });
  }, { threshold: 0.3 });

  sectionElements.forEach(el => sectionObserver.observe(el));

  // ==========================================
  // SECTION NAVIGATION DOTS
  // ==========================================
  const sectionDots = document.querySelectorAll('.section-dot');
  const allSections = document.querySelectorAll('[data-section-index]');

  sectionDots.forEach(dot => {
    dot.addEventListener('click', () => {
      const sectionIndex = parseInt(dot.dataset.section);
      const targetSection = document.querySelector(`[data-section-index="${sectionIndex}"]`);
      if (targetSection) {
        targetSection.scrollIntoView({ behavior: 'smooth' });
      }
    });
  });

  const dotObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const sectionIndex = entry.target.dataset.sectionIndex;
        sectionDots.forEach(dot => {
          dot.classList.toggle('active', dot.dataset.section === sectionIndex);
        });
      }
    });
  }, { threshold: 0.3 });

  allSections.forEach(section => dotObserver.observe(section));

  // ==========================================
  // PARALLAX EFFECTS
  // ==========================================
  const parallaxStar = document.getElementById('parallaxStar');
  const parallaxDots = document.getElementById('parallaxDots');

  window.addEventListener('scroll', () => {
    const scrollY = window.scrollY;
    if (parallaxStar) {
      parallaxStar.style.transform = `translate(-50%, calc(-50% + ${scrollY * 0.3}px))`;
    }
    if (parallaxDots) {
      parallaxDots.style.backgroundPosition = `${scrollY * 0.05}px ${scrollY * 0.08}px`;
    }
  });

  // ==========================================
  // SOLOW CURVE ANIMATION
  // ==========================================
  const solowChart = document.getElementById('solowChart');
  if (solowChart) {
    const solowObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting && !entry.target.dataset.animated) {
          entry.target.dataset.animated = 'true';

          // Animate main curve
          const solowCurve = document.getElementById('solowCurve');
          solowCurve.style.transition = 'stroke-dashoffset 2.5s ease-out';
          solowCurve.style.strokeDashoffset = '0';

          // Show time connector lines
          const connectors = document.querySelectorAll('.time-connector');
          connectors.forEach((conn, i) => {
            setTimeout(() => {
              conn.style.transition = 'opacity 0.5s ease-out';
              conn.style.opacity = '0.5';
            }, 800 + i * 600);
          });

          // Animate TFP shift curve
          setTimeout(() => {
            const tfpCurve = document.getElementById('tfpCurve');
            tfpCurve.style.transition = 'stroke-dashoffset 1.2s ease-out';
            tfpCurve.style.strokeDashoffset = '0';
          }, 2800);

          // Animate Vietnam dot along curve
          const vietnamDot = document.getElementById('vietnamDot');
          const vietnamLabelGroup = document.getElementById('vietnamLabelGroup');
          const eraLabel = document.getElementById('eraLabel');
          const icrGroup1 = document.getElementById('icrGroup1');
          const icrGroup2 = document.getElementById('icrGroup2');
          const insightCallout = document.getElementById('insightCallout');

          // Path points for Vietnam's journey (matching updated coordinates)
          const pathPoints = [
            { x: 140, y: 185, era: '2000', labelX: 155, labelY: 160 },
            { x: 230, y: 115, era: '2010', labelX: 245, labelY: 90 },
            { x: 340, y: 82, era: '2024', labelX: 355, labelY: 57 }
          ];

          let pointIndex = 0;
          const moveDot = () => {
            if (pointIndex >= pathPoints.length) return;
            const point = pathPoints[pointIndex];
            vietnamDot.style.transition = 'all 1s ease-out';
            vietnamDot.setAttribute('cx', point.x);
            vietnamDot.setAttribute('cy', point.y);

            // Update label group position
            const labelGroup = vietnamLabelGroup;
            const rect = labelGroup.querySelector('rect');
            const labelText = labelGroup.querySelector('#vietnamLabel');
            const eraText = labelGroup.querySelector('#eraLabel');

            rect.setAttribute('x', point.labelX);
            rect.setAttribute('y', point.labelY);
            labelText.setAttribute('x', point.labelX + 32);
            labelText.setAttribute('y', point.labelY + 13);
            eraText.setAttribute('x', point.labelX + 32);
            eraText.setAttribute('y', point.labelY + 23);
            eraText.textContent = point.era;

            if (pointIndex === 0) {
              labelGroup.style.transition = 'opacity 0.5s';
              labelGroup.style.opacity = '1';
              setTimeout(() => {
                icrGroup1.style.transition = 'opacity 0.6s';
                icrGroup1.style.opacity = '1';
              }, 400);
            }
            if (pointIndex === 1) {
              setTimeout(() => {
                icrGroup2.style.transition = 'opacity 0.6s';
                icrGroup2.style.opacity = '1';
              }, 400);
            }
            if (pointIndex === 2) {
              setTimeout(() => {
                insightCallout.style.transition = 'opacity 0.8s';
                insightCallout.style.opacity = '1';
              }, 600);
            }

            pointIndex++;
            if (pointIndex < pathPoints.length) {
              setTimeout(moveDot, 1200);
            }
          };

          setTimeout(moveDot, 600);
        }
      });
    }, { threshold: 0.3 });

    solowObserver.observe(solowChart);
  }

  // ==========================================
  // SANKEY DIAGRAM ANIMATION
  // ==========================================
  const sankeyChart = document.getElementById('sankeyChart');
  if (sankeyChart) {
    const sankeyObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting && !entry.target.dataset.animated) {
          entry.target.dataset.animated = 'true';

          // Show total imports indicator
          setTimeout(() => {
            const totalImports = document.getElementById('totalImports');
            if (totalImports) {
              totalImports.style.transition = 'opacity 0.6s ease-out';
              totalImports.style.opacity = '1';
            }
          }, 200);

          // Animate import paths (left side) with staggered timing
          for (let i = 1; i <= 5; i++) {
            const path = document.getElementById('sankeyImport' + i);
            if (path) {
              setTimeout(() => {
                path.style.transition = 'stroke-dashoffset 1s ease-out';
                path.style.strokeDashoffset = '0';
              }, 300 + i * 180);
            }
          }

          // Show total exports indicator
          setTimeout(() => {
            const totalExports = document.getElementById('totalExports');
            if (totalExports) {
              totalExports.style.transition = 'opacity 0.6s ease-out';
              totalExports.style.opacity = '1';
            }
          }, 1200);

          // Animate export paths (right side) with delay
          for (let i = 1; i <= 5; i++) {
            const path = document.getElementById('sankeyExport' + i);
            if (path) {
              setTimeout(() => {
                path.style.transition = 'stroke-dashoffset 1s ease-out';
                path.style.strokeDashoffset = '0';
              }, 1300 + i * 180);
            }
          }

          // Show insight callout
          setTimeout(() => {
            const sankeyInsight = document.getElementById('sankeyInsight');
            if (sankeyInsight) {
              sankeyInsight.style.transition = 'opacity 0.8s ease-out';
              sankeyInsight.style.opacity = '1';
            }
          }, 2400);

          // Show surplus indicator
          setTimeout(() => {
            const surplusIndicator = document.getElementById('surplusIndicator');
            if (surplusIndicator) {
              surplusIndicator.style.transition = 'opacity 0.8s ease-out';
              surplusIndicator.style.opacity = '1';
            }
          }, 2800);
        }
      });
    }, { threshold: 0.25 });

    sankeyObserver.observe(sankeyChart);
  }

  // ==========================================
  // DEMOGRAPHIC RING ANIMATION
  // ==========================================
  const demoRingContainer = document.getElementById('demoRingContainer');
  if (demoRingContainer) {
    const demoRingObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting && !entry.target.dataset.animated) {
          entry.target.dataset.animated = 'true';
          const ringFill = document.getElementById('demoRingFill');
          // 70% of circumference (2 * PI * 95 = 597)
          // 70% = 418
          setTimeout(() => {
            ringFill.style.strokeDasharray = '418 597';
          }, 300);
        }
      });
    }, { threshold: 0.3 });

    demoRingObserver.observe(demoRingContainer);
  }

  // ==========================================
  // VIETNAM MAP PINS ANIMATION
  // ==========================================
  const vietnamMapContainer = document.getElementById('vietnamMapContainer');
  if (vietnamMapContainer) {
    const mapPins = vietnamMapContainer.querySelectorAll('.map-pin');
    const mapTooltip = document.getElementById('mapTooltip');
    const tooltipTitle = document.getElementById('tooltipTitle');
    const tooltipDetail = document.getElementById('tooltipDetail');
    const legendItems = vietnamMapContainer.querySelectorAll('.map-legend-item');

    const mapObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting && !entry.target.dataset.animated) {
          entry.target.dataset.animated = 'true';
          mapPins.forEach((pin, i) => {
            setTimeout(() => {
              pin.classList.add('visible');
            }, i * 200);
          });
        }
      });
    }, { threshold: 0.3 });

    mapObserver.observe(vietnamMapContainer);

    // Helper function to show tooltip
    const showTooltip = (pin, referenceElement) => {
      const city = pin.dataset.city;
      const detail = pin.dataset.detail;
      tooltipTitle.textContent = city;
      tooltipDetail.textContent = detail;
      mapTooltip.classList.add('visible');

      const rect = vietnamMapContainer.getBoundingClientRect();
      const refRect = referenceElement.getBoundingClientRect();
      mapTooltip.style.left = (refRect.left - rect.left + 25) + 'px';
      mapTooltip.style.top = (refRect.top - rect.top - 10) + 'px';
    };

    // Tooltip functionality for pins
    mapPins.forEach(pin => {
      pin.addEventListener('mouseenter', (e) => {
        showTooltip(pin, pin);
        // Highlight corresponding legend item
        const pinId = pin.id;
        legendItems.forEach(item => {
          if (item.dataset.pin === pinId) {
            item.style.background = 'rgba(218,37,29,0.1)';
          }
        });
      });

      pin.addEventListener('mouseleave', () => {
        mapTooltip.classList.remove('visible');
        legendItems.forEach(item => {
          item.style.background = '';
        });
      });

      // Touch support
      pin.addEventListener('touchstart', (e) => {
        e.preventDefault();
        showTooltip(pin, pin);
        mapTooltip.classList.toggle('visible');
      });
    });

    // Legend item interactions
    legendItems.forEach(item => {
      const pinId = item.dataset.pin;
      const correspondingPin = document.getElementById(pinId);

      item.addEventListener('mouseenter', () => {
        if (correspondingPin) {
          // Highlight the pin
          const marker = correspondingPin.querySelector('.map-pin-marker');
          if (marker) {
            marker.style.transform = 'scale(1.4)';
            marker.style.filter = 'drop-shadow(0 0 6px rgba(218,37,29,0.6))';
          }
          showTooltip(correspondingPin, item);
        }
      });

      item.addEventListener('mouseleave', () => {
        if (correspondingPin) {
          const marker = correspondingPin.querySelector('.map-pin-marker');
          if (marker) {
            marker.style.transform = '';
            marker.style.filter = '';
          }
        }
        mapTooltip.classList.remove('visible');
      });

      item.addEventListener('click', () => {
        if (correspondingPin) {
          correspondingPin.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      });
    });
  }

  // ==========================================
  // RACING BAR CHART ANIMATION
  // ==========================================
  const racingBarContainer = document.getElementById('racingBarContainer');
  if (racingBarContainer) {
    const racingObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting && !entry.target.dataset.animated) {
          entry.target.dataset.animated = 'true';
          const bars = entry.target.querySelectorAll('.racing-bar-fill');

          // First show starting positions
          bars.forEach(bar => {
            bar.style.width = bar.dataset.start + '%';
          });

          // Then animate to end positions
          setTimeout(() => {
            bars.forEach((bar, i) => {
              setTimeout(() => {
                bar.style.width = bar.dataset.end + '%';
              }, i * 200);
            });
          }, 500);
        }
      });
    }, { threshold: 0.3 });

    racingObserver.observe(racingBarContainer);
  }

  // ==========================================
  // CHART TOOLTIPS
  // ==========================================
  function createTooltip() {
    const tooltip = document.createElement('div');
    tooltip.className = 'chart-tooltip';
    tooltip.innerHTML = '<div class="chart-tooltip-value"></div><div class="chart-tooltip-source"></div>';
    document.body.appendChild(tooltip);
    return tooltip;
  }

  const chartTooltip = createTooltip();

  // Add tooltips to bar charts
  const barRows = document.querySelectorAll('.bar-row');
  const tooltipData = {
    'fdiChart': {
      'S. Korea': { value: '$92B cumulative', source: 'Source: MPI, 2024' },
      'Singapore': { value: '$84B cumulative', source: 'Source: MPI, 2024' },
      'Japan': { value: '$74B cumulative', source: 'Source: MPI, 2024' },
      'Taiwan': { value: '$32B cumulative', source: 'Source: MPI, 2024' },
      'China': { value: 'Rising rapidly', source: 'Source: MPI, 2024' }
    },
    'fvaChart': {
      'Vietnam': { value: '48% import intensity', source: 'Source: OECD TiVA, 2020' },
      'Malaysia': { value: '35% import intensity', source: 'Source: OECD TiVA, 2023' },
      'Thailand': { value: '35% import intensity', source: 'Source: OECD TiVA, 2023' },
      'India': { value: '20% import intensity', source: 'Source: OECD TiVA, 2023' },
      'Indonesia': { value: '15% import intensity', source: 'Source: OECD TiVA, 2023' }
    },
    'partnersChart': {
      'USA': { value: '$153.2B (~30% of exports)', source: 'Source: UN Comtrade, 2025' },
      'China': { value: '$64.5B', source: 'Source: UN Comtrade, 2025' },
      'EU': { value: '$55B', source: 'Source: UN Comtrade, 2025' },
      'S. Korea': { value: '$30B', source: 'Source: UN Comtrade, 2025' },
      'Japan': { value: '$27B', source: 'Source: UN Comtrade, 2025' }
    }
  };

  barRows.forEach(row => {
    row.addEventListener('mouseenter', (e) => {
      const chart = row.closest('.bar-chart');
      if (!chart) return;
      const chartId = chart.id;
      const label = row.querySelector('.bar-label')?.textContent.trim();

      if (tooltipData[chartId] && tooltipData[chartId][label]) {
        const data = tooltipData[chartId][label];
        chartTooltip.querySelector('.chart-tooltip-value').textContent = data.value;
        chartTooltip.querySelector('.chart-tooltip-source').textContent = data.source;
        chartTooltip.classList.add('visible');

        const rect = row.getBoundingClientRect();
        chartTooltip.style.left = (rect.left + rect.width / 2) + 'px';
        chartTooltip.style.top = (rect.top - 50) + 'px';
      }
    });

    row.addEventListener('mouseleave', () => {
      chartTooltip.classList.remove('visible');
    });
  });

  // Add tooltips to legend items (donut chart)
  const legendItems = document.querySelectorAll('.legend-item');
  const legendTooltipData = {
    'Electronics & phones': { value: '$126.5B (33% of exports)', source: 'Source: GSO, 2025' },
    'Agri/forestry/fishery': { value: '$50.8B (11% of exports)', source: 'Source: Vietnam Briefing citing GSO, 2025' },
    'Textiles & footwear': { value: '~$61B (16% of exports)', source: 'Source: GSO, 2025' },
    'Machinery & equipment': { value: '~$49B (13% of exports)', source: 'Source: GSO, 2025' },
    'Other': { value: '~$88B (22% of exports)', source: 'Source: GSO, 2025' }
  };

  legendItems.forEach(item => {
    item.addEventListener('mouseenter', (e) => {
      const label = item.querySelector('.legend-label')?.textContent.trim();
      if (legendTooltipData[label]) {
        const data = legendTooltipData[label];
        chartTooltip.querySelector('.chart-tooltip-value').textContent = data.value;
        chartTooltip.querySelector('.chart-tooltip-source').textContent = data.source;
        chartTooltip.classList.add('visible');

        const rect = item.getBoundingClientRect();
        chartTooltip.style.left = (rect.left + rect.width / 2) + 'px';
        chartTooltip.style.top = (rect.top - 50) + 'px';
      }
    });

    item.addEventListener('mouseleave', () => {
      chartTooltip.classList.remove('visible');
    });
  });

  // ==========================================
  // BUILD VIETNAM SIMULATOR
  // ==========================================
  (function() {
    // Game State
    const state = {
      year: 1986,
      turn: 1,
      maxTurns: 15,
      era: 1,
      gdpPerCapita: 200,
      gdpGrowth: 2.8,
      fdiLinkage: 15,
      trapRisk: 25,
      stability: 60,
      inequality: 0.35,
      choices: [],
      gdpHistory: [{ year: 1986, gdp: 200 }],
      flags: {} // For branching consequences
    };

    // Real Vietnam GDP per capita data (approximate, for comparison)
    const realVietnamData = [
      { year: 1986, gdp: 200 },
      { year: 1989, gdp: 250 },
      { year: 1992, gdp: 350 },
      { year: 1995, gdp: 500 },
      { year: 1998, gdp: 650 },
      { year: 2001, gdp: 750 },
      { year: 2004, gdp: 900 },
      { year: 2007, gdp: 1200 },
      { year: 2010, gdp: 1600 },
      { year: 2013, gdp: 2000 },
      { year: 2016, gdp: 2500 },
      { year: 2020, gdp: 3200 },
      { year: 2024, gdp: 4700 },
      { year: 2030, gdp: 6500 },
      { year: 2040, gdp: 9000 },
      { year: 2045, gdp: 10500 }
    ];

    // Era definitions
    const eras = [
      { id: 1, name: "Survival & Stabilization", years: "1986-2000", label: "Era I", turns: [1, 5] },
      { id: 2, name: "Integration & Growth", years: "2001-2015", label: "Era II", turns: [6, 10] },
      { id: 3, name: "Quality & Escape", years: "2016-2045", label: "Era III", turns: [11, 15] }
    ];

    // Policy decisions by turn - with historical context and branching
    const decisions = [
      // ERA I: Survival (Turns 1-5)
      {
        turn: 1,
        title: "The Collapse of Central Planning",
        desc: "Agricultural cooperatives are failing. Farmers have no incentive to produce beyond quotas. Food shortages are spreading. You must decide how to reform the agricultural sector.",
        history: {
          real: "Vietnam chose Resolution 10 (Khoán 10) in 1988, giving households land-use rights. The result was dramatic: Vietnam transformed from a rice importer in 1987 to the world's 3rd-largest rice exporter by 1989. However, the dismantling of cooperatives also collapsed rural social services.",
          realChoice: 0,
          realGdp: 250,
          source: "UCL Economic Miracle Study",
          verdict: "success",
          verdictText: "World Bank considers this a pivotal reform that enabled Vietnam's growth miracle."
        },
        choices: [
          {
            id: "decollectivize",
            title: "Resolution 10: De-collectivize Agriculture",
            desc: "Give households land-use rights and let them sell surplus at market prices. Dismantle the cooperative system.",
            effects: { gdpGrowth: 2.5, stability: 10, trapRisk: -5, inequality: 0.03 },
            tags: ["+2.5% Growth", "+Stability", "-Trap Risk", "+Inequality"],
            setFlags: { agrarian_reform: "radical" }
          },
          {
            id: "gradual_agri",
            title: "Gradual Reform with Safety Nets",
            desc: "Slowly transition while maintaining cooperative social services. Less disruption but slower gains.",
            effects: { gdpGrowth: 1.0, stability: 5, trapRisk: 0, inequality: 0.01 },
            tags: ["+1% Growth", "+Stability", "Slower Impact"],
            setFlags: { agrarian_reform: "gradual" },
            altHistory: "A gradual approach resembles what China attempted in the early 1980s before fully committing to household responsibility. Economists estimate Vietnam would have seen slower but steadier growth (~$200-220 GDP per capita by 1991 vs. the $250 achieved), preserving rural healthcare and education systems. However, the food crisis might have persisted 2-3 years longer, risking political instability."
          }
        ]
      },
      {
        turn: 2,
        title: "Opening to Foreign Capital",
        desc: "Vietnam desperately needs investment capital. You can pass a liberal Foreign Investment Law to attract FDI, but terms matter.",
        history: {
          real: "Vietnam passed the 1987 Foreign Investment Law—exceptionally liberal for a communist state, allowing 100% foreign ownership and guaranteeing against nationalization. This attracted the first wave of Taiwanese and Hong Kong capital for textiles and footwear. However, tax holidays and land preferences inadvertently disadvantaged the nascent domestic private sector, planting seeds of the 'dual economy' problem.",
          realChoice: 0,
          realGdp: 280,
          source: "ERIA FDI Study",
          verdict: "mixed",
          verdictText: "Attracted massive FDI (success) but created an 'enclave economy' with weak local linkages—today FDI firms still account for 74% of exports with minimal technology transfer."
        },
        choices: [
          {
            id: "aggressive_fdi",
            title: "Aggressive FDI Incentives",
            desc: "100% foreign ownership, long tax holidays, profit repatriation guarantees. Maximum attraction.",
            effects: { gdpGrowth: 2.0, fdiLinkage: -8, trapRisk: 5, stability: 5 },
            tags: ["+2% Growth", "-FDI Linkage", "+Trap Risk"],
            setFlags: { fdi_approach: "open" }
          },
          {
            id: "conditional_fdi",
            title: "Conditional FDI with Local Content Rules",
            desc: "Require joint ventures and local supplier development. Slower start but stronger linkages.",
            effects: { gdpGrowth: 0.8, fdiLinkage: 5, trapRisk: -5, stability: 0 },
            tags: ["+0.8% Growth", "+FDI Linkage", "-Trap Risk"],
            setFlags: { fdi_approach: "conditional" },
            altHistory: "This approach mirrors what Malaysia and Indonesia tried with mixed results. Studies suggest Vietnam might have attracted 30-40% less FDI initially (~$240-260 GDP per capita vs. $280), but with stronger technology transfer and local supplier networks. The Moran study found conditional FDI often yields 2-3 year technology lag initially but creates deeper domestic capabilities by year 10-15."
          }
        ]
      },
      {
        turn: 3,
        title: "Macroeconomic Stabilization",
        desc: "Inflation hit 774% last year. The currency is unstable. You need to restore economic order.",
        history: {
          real: "Vietnam pursued aggressive stabilization: tightening fiscal/monetary policy, unifying exchange rates, and phasing out SOE subsidies. Inflation fell from 774% (1986) to single digits by the early 1990s. This painful medicine created the macro stability that enabled FDI to flow.",
          realChoice: 0,
          realGdp: 320,
          source: "World Bank Short History",
          verdict: "success",
          verdictText: "IMF praises the bold reforms for achieving stability without the 'transformational recession' that hit Eastern Europe."
        },
        choices: [
          {
            id: "shock_therapy",
            title: "Shock Therapy: Tight Money",
            desc: "Dramatic interest rate hikes, unified exchange rate, end SOE subsidies. Painful but decisive.",
            effects: { gdpGrowth: -1.5, stability: 15, trapRisk: -8, inequality: 0.02 },
            tags: ["-1.5% Growth", "++Stability", "--Trap Risk"],
            setFlags: { macro_approach: "orthodox" }
          },
          {
            id: "gradual_tightening",
            title: "Gradual Tightening",
            desc: "Slowly reduce inflation while maintaining some support for state enterprises.",
            effects: { gdpGrowth: 0.5, stability: 5, trapRisk: 3, inequality: 0 },
            tags: ["+0.5% Growth", "+Stability", "+Trap Risk"],
            setFlags: { macro_approach: "gradual" },
            altHistory: "Argentina and Brazil tried gradual stabilization in similar situations, often leading to prolonged inflation and delayed FDI. The IMF estimates that without decisive action, Vietnam's hyperinflation could have persisted until the mid-1990s, potentially leaving GDP per capita 15-20% lower (~$270-280 vs. $320) by 1994 and triggering social unrest as seen in other transition economies."
          }
        ]
      },
      {
        turn: 4,
        title: "US Normalization",
        desc: "The embargo is lifting. Normalizing relations with the US could open massive markets for Vietnamese exports.",
        history: {
          real: "Vietnam pursued full normalization, accepting US conditions on POW/MIA cooperation. The embargo lifted in 1994, diplomatic relations established in 1995, and the Bilateral Trade Agreement (BTA) signed in 2001. This opened access to the world's largest consumer market and triggered a massive export boom.",
          realChoice: 0,
          realGdp: 420,
          source: "US Embassy Vietnam",
          verdict: "success",
          verdictText: "Trade with the US grew from $1.5B (2001) to $150B+ by 2024. Economists consider this a major diplomatic and economic win."
        },
        choices: [
          {
            id: "full_us",
            title: "Pursue Full Normalization",
            desc: "Accept US conditions on POW/MIA issues, begin trade negotiations. Political risk but economic opportunity.",
            effects: { gdpGrowth: 1.5, fdiLinkage: 3, stability: -5, trapRisk: -5 },
            tags: ["+1.5% Growth", "+Linkage", "-Stability", "-Trap Risk"],
            setFlags: { us_relations: "full" }
          },
          {
            id: "cautious_us",
            title: "Cautious Engagement",
            desc: "Limited diplomatic progress while maintaining sovereignty concerns. Slower economic benefits.",
            effects: { gdpGrowth: 0.5, fdiLinkage: 0, stability: 5, trapRisk: 2 },
            tags: ["+0.5% Growth", "+Stability"],
            setFlags: { us_relations: "cautious" },
            altHistory: "Cuba maintained this stance and remains under embargo today. Myanmar's isolation until the 2010s shows the cost: lost decades of FDI and export opportunities. Fukase & Martin's World Bank model estimates that without MFN access, Vietnam's exports would have been halved and GDP per capita 20-30% lower (~$330-380 vs. $420 by 1998)."
          }
        ]
      },
      {
        turn: 5,
        title: "Infrastructure Strategy",
        desc: "Where should Vietnam invest its limited infrastructure budget?",
        history: {
          real: "Vietnam invested heavily (~3.6% of GDP) in coastal roads and ports, prioritizing export corridors connecting Hanoi/HCMC to industrial zones. Studies suggest this delivered large GDP gains but an alternative inland-focused allocation could have generated 48-72% higher welfare, with less climate vulnerability.",
          realChoice: 0,
          realGdp: 550,
          source: "Yale Economics / VoxDev",
          verdict: "mixed",
          verdictText: "Coastal focus boosted exports but Yale economists found inland investment could have yielded 48-72% higher welfare gains with better climate resilience."
        },
        choices: [
          {
            id: "coastal_infra",
            title: "Coastal Export Corridors",
            desc: "Prioritize ports, roads to industrial zones, and connections to Hanoi/HCMC. Maximum export efficiency.",
            effects: { gdpGrowth: 1.8, inequality: 0.04, trapRisk: 3, fdiLinkage: -3 },
            tags: ["+1.8% Growth", "+Inequality", "Regional Imbalance"],
            setFlags: { infra_focus: "coastal" }
          },
          {
            id: "balanced_infra",
            title: "Balanced Regional Development",
            desc: "Invest in inland connectivity and rural infrastructure. More inclusive but slower export growth.",
            effects: { gdpGrowth: 0.8, inequality: -0.02, trapRisk: -3, stability: 5 },
            tags: ["+0.8% Growth", "-Inequality", "-Trap Risk"],
            setFlags: { infra_focus: "balanced" },
            altHistory: "Yale/VoxDev study found that inland-focused infrastructure could have generated 48-72% higher welfare gains (~$580-620 GDP-equivalent welfare vs. $550 achieved). This translates to roughly 1-1.5 percentage points higher long-run growth, with better climate resilience. However, short-term export competitiveness might have suffered."
          }
        ]
      },
      // ERA II: Integration (Turns 6-10)
      {
        turn: 6,
        title: "WTO Accession Negotiations",
        desc: "Vietnam has the opportunity to join the WTO. This requires significant domestic reforms and opening service sectors.",
        history: {
          real: "Vietnam pursued full WTO accession in 2007, accepting conditions to lower tariffs, open banking/telecom, and reduce SOE subsidies. Reformers used international commitments as leverage against conservative factions. FDI surged 70% in 2007, hitting $64B registered in 2008.",
          realChoice: 0,
          realGdp: 900,
          source: "WTO Trade Policy Review",
          verdict: "success",
          verdictText: "WTO accession exceeded model predictions. Productivity gains in manufacturing reached 3.7% annually. Strong consensus among economists."
        },
        branchEffects: {
          condition: (flags) => flags.us_relations === "cautious",
          warning: "Your cautious approach to US relations makes WTO accession harder. Full membership benefits reduced.",
          modifier: { gdpGrowth: -0.5 }
        },
        choices: [
          {
            id: "full_wto",
            title: "Full WTO Accession",
            desc: "Accept all conditions: lower tariffs, open banking/telecom, reform SOEs. Lock in reforms.",
            effects: { gdpGrowth: 2.5, fdiLinkage: -5, trapRisk: -8, stability: -5 },
            tags: ["+2.5% Growth", "-FDI Linkage", "--Trap Risk"],
            setFlags: { wto: "full" }
          },
          {
            id: "limited_wto",
            title: "Negotiate Extended Transitions",
            desc: "Seek longer phase-in periods for sensitive sectors. Protect domestic firms longer.",
            effects: { gdpGrowth: 1.2, fdiLinkage: 3, trapRisk: 5, stability: 5 },
            tags: ["+1.2% Growth", "+Linkage", "+Trap Risk"],
            setFlags: { wto: "limited" },
            altHistory: "Indonesia and Philippines took this more cautious WTO approach. The CEPII study estimates Vietnam would have foregone ~1% of GDP welfare gains annually. Combined with missing the 2007-08 FDI surge (which hit $64B registered), GDP per capita could have been ~$750-800 vs. the $900 achieved by 2007."
          }
        ]
      },
      {
        turn: 7,
        title: "The SOE Question: Vinashin",
        desc: "State shipbuilder Vinashin wants to expand into finance and real estate with government backing. The chaebol model beckons.",
        history: {
          real: "Vietnam backed Vinashin with sovereign credit ($750M bond) and allowed diversification. It was a disaster: corruption, mismanagement, and a $4.5B default in 2010 paralyzed the banking system. This is Vietnam's cautionary tale about state capitalism without accountability.",
          realChoice: 0,
          realGdp: 1150,
          source: "World Bank Vietnam Reports",
          verdict: "mistake",
          verdictText: "IMF and Moody's flag this as a major policy error. The $4.5B default damaged sovereign credit ratings and required years of banking sector cleanup."
        },
        branchEffects: {
          condition: (flags) => flags.macro_approach === "gradual",
          warning: "Your gradual stabilization left SOEs with soft budget expectations. Vinashin is even more likely to take excessive risks.",
          modifier: { trapRisk: 5 }
        },
        choices: [
          {
            id: "back_soe",
            title: "Back the National Champion",
            desc: "Provide sovereign credit and let Vinashin diversify. Build a Korean-style conglomerate.",
            effects: { gdpGrowth: 1.5, trapRisk: 12, stability: -8, fdiLinkage: -5 },
            tags: ["+1.5% Growth", "++Trap Risk", "-Stability", "Crisis Risk"],
            setFlags: { soe_strategy: "champion" }
          },
          {
            id: "hard_budget",
            title: "Hard Budget Constraints",
            desc: "Force SOEs to compete without soft loans. Allow failures. Politically painful.",
            effects: { gdpGrowth: -0.5, trapRisk: -10, stability: -5, fdiLinkage: 5 },
            tags: ["-0.5% Growth", "--Trap Risk", "+Linkage"],
            setFlags: { soe_strategy: "market" },
            altHistory: "This is what reformers advocated but lost. Singapore and Taiwan enforced hard budget constraints on state firms. Studies suggest Vietnam could have avoided the $4.5B Vinashin debacle, banking crisis, and inflation spike. By avoiding these, GDP per capita could have been ~$1,300-1,400 by 2010 vs. $1,150 achieved—and without years of painful cleanup."
          }
        ]
      },
      {
        turn: 8,
        title: "The Credit Boom",
        desc: "FDI is flooding in post-WTO. Banks are lending aggressively. Real estate prices are surging. What do you do?",
        history: {
          real: "Vietnam let it ride. Credit grew >30% per year. Combined with the Vinashin debacle and a 2009 stimulus, inflation hit 23% (2008) and 18.6% (2011). Real estate crashed, NPLs reached ~15% (unofficially), and years were spent cleaning up bank balance sheets via VAMC.",
          realChoice: 0,
          realGdp: 1400,
          source: "IMF Article IV Reports",
          verdict: "mistake",
          verdictText: "World Bank/IMF cite overly expansionary policy fueling 35% credit growth and 20%+ inflation. Consensus among experts: this was overheating that cost years of cleanup."
        },
        branchEffects: {
          condition: (flags) => flags.soe_strategy === "champion",
          warning: "Your SOE backing has cross-ownership with banks. Letting the boom ride is especially dangerous.",
          modifier: { trapRisk: 5, stability: -5 }
        },
        choices: [
          {
            id: "let_ride",
            title: "Let It Ride",
            desc: "High growth is good. Don't interfere with the market momentum. Maximize the boom.",
            effects: { gdpGrowth: 2.0, trapRisk: 10, stability: -10, inequality: 0.03 },
            tags: ["+2% Growth", "++Trap Risk", "--Stability", "Bubble Risk"],
            setFlags: { credit_policy: "loose" }
          },
          {
            id: "tighten",
            title: "Macroprudential Tightening",
            desc: "Raise reserve requirements, limit real estate lending, sterilize capital flows.",
            effects: { gdpGrowth: 0.0, trapRisk: -5, stability: 8, inequality: -0.01 },
            tags: ["0% Growth Impact", "-Trap Risk", "+Stability"],
            setFlags: { credit_policy: "tight" },
            altHistory: "China implemented strict credit controls in similar overheating situations. The IMF notes that macroprudential tightening could have prevented the 23% inflation spike and real estate crash. Peak growth would have been lower (~6-7% vs 8.5%) but the crash avoided. By 2012, GDP per capita could have been ~$1,500-1,600 vs $1,400 achieved, with healthier banks."
          }
        ]
      },
      {
        turn: 9,
        title: "Human Capital Investment",
        desc: "Vietnam's PISA scores are strong, but higher education and vocational training lag. Where to invest?",
        history: {
          real: "Vietnam maintained its basic education focus. While K-12 outcomes rival OECD countries, only ~26% of the workforce has formal training/degrees. The vocational system remains fragmented and disconnected from industry needs—a key bottleneck for moving up value chains.",
          realChoice: 1,
          realGdp: 1800,
          source: "OECD Economic Survey 2025",
          verdict: "mixed",
          verdictText: "Basic education success (PISA scores rival rich countries), but delayed tertiary investment created a skills bottleneck—now a binding constraint for high-tech industries."
        },
        branchEffects: {
          condition: (flags) => flags.fdi_approach === "open",
          warning: "Your aggressive FDI incentives created an assembly economy. Without skilled workers, upgrading is impossible.",
          boost: 1,
          boostText: "Education investment is extra valuable for breaking out of assembly"
        },
        choices: [
          {
            id: "tertiary_push",
            title: "Expand Tertiary & Vocational",
            desc: "Major investment in universities and technical training. Prepare for industrial upgrading.",
            effects: { gdpGrowth: -0.3, trapRisk: -12, fdiLinkage: 8, inequality: 0.02 },
            tags: ["Short-term Cost", "--Trap Risk", "++Linkage", "Long-term Gain"],
            setFlags: { education: "upgraded" },
            altHistory: "South Korea invested heavily in tertiary education during its middle-income phase, reaching 70%+ university enrollment. Returns to tertiary education in Vietnam are 15-20% per year of schooling. CSIRO modeling suggests this path could boost TFP contribution from 30% to 40%+ of growth, potentially adding 0.5-1% to annual GDP growth long-term."
          },
          {
            id: "basic_education",
            title: "Maintain Basic Education Focus",
            desc: "Keep emphasizing primary/secondary. Sufficient for current assembly-based model.",
            effects: { gdpGrowth: 0.5, trapRisk: 5, fdiLinkage: -3, inequality: -0.01 },
            tags: ["+0.5% Growth", "+Trap Risk", "-Linkage"],
            setFlags: { education: "basic" }
          }
        ]
      },
      {
        turn: 10,
        title: "The Formosa Environmental Crisis",
        desc: "A Taiwanese steel plant has discharged toxic waste, killing fish across four provinces. Mass protests erupt.",
        history: {
          real: "Vietnam took a mixed approach: extracted a $500M settlement from Formosa and enacted some new regulations, but avoided a broader crackdown on polluting FDI. The 'I Choose Fish' protests marked a turning point in environmental awareness but fundamental enforcement gaps remain.",
          realChoice: 1,
          realGdp: 2200,
          source: "Various news sources, 2016",
          verdict: "mistake",
          verdictText: "Government response criticized as inadequate. Transparency lacking, activists arrested. Economists cite weak enforcement as emblematic of 'growth at all costs' mentality."
        },
        choices: [
          {
            id: "strict_env",
            title: "Strict Environmental Enforcement",
            desc: "Heavy fines, strict new regulations, shut down violators. Signal that pollution has costs.",
            effects: { gdpGrowth: -0.8, trapRisk: -8, stability: 10, fdiLinkage: 5 },
            tags: ["-0.8% Growth", "-Trap Risk", "+Stability", "Green Signal"],
            setFlags: { environment: "strict" },
            altHistory: "China's strict enforcement after major pollution scandals attracted higher-quality FDI seeking stable regulatory environments. Studies show this shifts FDI composition toward cleaner, higher-value projects. Short-term GDP might be 0.5-1% lower, but long-run welfare-equivalent GDP could be higher due to avoided environmental/health costs."
          },
          {
            id: "limited_env",
            title: "Limited Response",
            desc: "Handle this case quietly. Maintain friendly FDI environment. Avoid scaring investors.",
            effects: { gdpGrowth: 0.3, trapRisk: 5, stability: -8, fdiLinkage: -3 },
            tags: ["+0.3% Growth", "+Trap Risk", "--Stability", "Social Risk"],
            setFlags: { environment: "weak" }
          }
        ]
      },
      // ERA III: Escape (Turns 11-15)
      {
        turn: 11,
        title: "Deep FTAs: CPTPP & EVFTA",
        desc: "Vietnam can join comprehensive trade agreements with strict labor/environment rules and deep market access.",
        history: {
          real: "Vietnam signed both CPTPP (2018) and EVFTA (2020), accepting labor/environment chapters and SOE disciplines in exchange for deep market access. These 'external anchors' helped reformers push through domestic changes that would otherwise face internal resistance.",
          realChoice: 0,
          realGdp: 2800,
          source: "WTO/CPTPP Documentation",
          verdict: "success",
          verdictText: "Studies show significant trade boosts. EVFTA especially positive. Strong consensus among economists that deep FTAs locked in beneficial reforms."
        },
        branchEffects: {
          condition: (flags) => flags.environment === "weak",
          warning: "Your weak environmental enforcement makes EVFTA compliance harder. EU may impose non-tariff barriers.",
          modifier: { gdpGrowth: -0.3 }
        },
        choices: [
          {
            id: "deep_ftas",
            title: "Sign Deep FTAs",
            desc: "Accept labor reform requirements, SOE disciplines, and competition rules for full market access.",
            effects: { gdpGrowth: 1.5, trapRisk: -10, fdiLinkage: 5, stability: -3 },
            tags: ["+1.5% Growth", "--Trap Risk", "+Linkage"],
            setFlags: { trade: "deep" }
          },
          {
            id: "selective_ftas",
            title: "Selective Participation",
            desc: "Negotiate exceptions for sensitive areas. Maintain more policy flexibility.",
            effects: { gdpGrowth: 0.8, trapRisk: 3, fdiLinkage: -2, stability: 3 },
            tags: ["+0.8% Growth", "+Trap Risk", "Policy Space"],
            setFlags: { trade: "selective" },
            altHistory: "India took this approach, staying out of RCEP and limiting FTA commitments. Studies show EVFTA alone boosted trade by 18%+. Selective participation could mean ~$2,400-2,600 GDP per capita by 2020 vs $2,800 achieved, plus missing the 'external anchor' that helped reformers push domestic changes."
          }
        ]
      },
      {
        turn: 12,
        title: "Resolution 68: Private Sector Strategy",
        desc: "The Party recognizes the private sector as the 'most important driving force.' How to implement?",
        history: {
          real: "Vietnam issued Resolution 68 in 2025, targeting 2 million enterprises and 20 'National Champions' by 2030. The strategy tilts toward large conglomerates (Vingroup, FPT, Hoa Phat), risking oligarchy formation similar to Thailand. SME credit programs have historically failed due to rigid collateral requirements.",
          realChoice: 0,
          realGdp: 3800,
          source: "Resolution 68, Lowy Institute",
          verdict: "mixed",
          verdictText: "Brookings critiques see risk of crony capitalism. World Bank notes governance issues. Ongoing debate—could succeed like Korea's chaebols or fail like Thailand's oligarchs."
        },
        branchEffects: {
          condition: (flags) => flags.soe_strategy === "champion",
          warning: "Your SOE champion strategy created crony capitalism patterns. National Champions risk becoming oligarchs.",
          modifier: { trapRisk: 5, inequality: 0.02 }
        },
        choices: [
          {
            id: "champions",
            title: "National Champions Strategy",
            desc: "Channel resources to large conglomerates like Vingroup and FPT. Build global players.",
            effects: { gdpGrowth: 1.2, trapRisk: 8, fdiLinkage: -5, inequality: 0.04 },
            tags: ["+1.2% Growth", "+Trap Risk", "Oligarchy Risk"],
            setFlags: { private_sector: "champions" }
          },
          {
            id: "sme_focus",
            title: "SME Development Focus",
            desc: "Credit guarantees, regulatory simplification for small firms. Broader but slower.",
            effects: { gdpGrowth: 0.5, trapRisk: -8, fdiLinkage: 8, inequality: -0.02 },
            tags: ["+0.5% Growth", "-Trap Risk", "++Linkage", "Inclusive"],
            setFlags: { private_sector: "sme" },
            altHistory: "Taiwan's industrial miracle was built on SME networks, not chaebols. Studies show dense SME ecosystems create stronger FDI linkages—potentially increasing the 'local content' of exports from ~25% to 40-50% over 10-15 years. Growth may be 0.5% slower annually but with higher domestic value capture and lower inequality."
          }
        ]
      },
      {
        turn: 13,
        title: "The Semiconductor Opportunity",
        desc: "Intel and Samsung are expanding chip operations. Vietnam needs 50,000 chip engineers but has ~1,400. What's the priority?",
        history: {
          real: "Vietnam is attempting both paths: PM Pham Minh Chinh announced targets for 50,000-100,000 semiconductor workers by 2030, while also courting Samsung/Intel training centers. The challenge is real: Intel has been in Vietnam since 2006 but local content remains ~5% for chips.",
          realChoice: 1,
          realGdp: 5200,
          source: "Ministry of Industry and Trade",
          verdict: "pending",
          verdictText: "Still unfolding. The gap between 1,400 current chip engineers and 50,000 target is daunting. Success depends on execution over the next decade."
        },
        branchEffects: {
          condition: (flags) => flags.education === "basic",
          locked: 0,
          lockText: "Your basic education focus left no foundation for tech education. Massive push is not viable."
        },
        choices: [
          {
            id: "tech_education",
            title: "Massive Tech Education Push",
            desc: "Partner with universities, fund overseas training, import expertise. 10-year commitment.",
            effects: { gdpGrowth: -0.5, trapRisk: -15, fdiLinkage: 12, stability: 0 },
            tags: ["High Investment", "---Trap Risk", "+++Linkage", "Long-term"],
            setFlags: { tech: "domestic" },
            altHistory: "South Korea and Taiwan invested heavily in semiconductor education in the 1980s-90s, creating TSMC and Samsung's chip divisions. This path requires patience—GDP impact may be negative (-0.5%) for 5 years—but countries that made this investment saw TFP contribution rise from 30% to 50%+ of growth, enabling the leap to high-income status."
          },
          {
            id: "foreign_training",
            title: "Attract Foreign Training Centers",
            desc: "Let Samsung and Intel run their own academies. Faster but less local control.",
            effects: { gdpGrowth: 0.5, trapRisk: -5, fdiLinkage: 3, stability: 3 },
            tags: ["+0.5% Growth", "-Trap Risk", "+Linkage"],
            setFlags: { tech: "foreign" }
          }
        ]
      },
      {
        turn: 14,
        title: "The Energy Transition (JETP)",
        desc: "Vietnam depends on coal but has a $15.5B green transition deal on the table. Energy costs vs climate.",
        history: {
          real: "Vietnam signed the $15.5B JETP deal but implementation is slow. Power shortages hit manufacturing in 2023-24. The country remains coal-dependent (~50% of power) while facing EU Carbon Border Adjustment Mechanism (CBAM) taxes on exports. A classic transition dilemma.",
          realChoice: 1,
          realGdp: 6800,
          source: "JETP Documentation, IEA",
          verdict: "pending",
          verdictText: "Still unfolding. JETP implementation lagging while power shortages hurt manufacturing. The energy transition dilemma remains unresolved."
        },
        branchEffects: {
          condition: (flags) => flags.environment === "strict",
          boost: 0,
          boostText: "Your environmental track record makes green transition more credible to investors"
        },
        choices: [
          {
            id: "green_push",
            title: "Aggressive Green Transition",
            desc: "Phase out coal rapidly, massive renewable investment. Higher energy costs but future-proof.",
            effects: { gdpGrowth: -0.8, trapRisk: -10, fdiLinkage: 5, stability: -5 },
            tags: ["-0.8% Growth", "--Trap Risk", "Green FDI", "Transition Pain"],
            setFlags: { energy: "green" },
            altHistory: "Germany's Energiewende shows both the promise and pain: higher energy costs hurt competitiveness short-term (0.5-1% GDP drag). But with EU's CBAM taxing carbon-intensive imports by 2026+, green manufacturing becomes essential. World Bank estimates climate inaction could cost Vietnam 12.5% of GDP by 2050."
          },
          {
            id: "gradual_energy",
            title: "Gradual Energy Shift",
            desc: "Maintain coal baseline while slowly building renewables. Cheaper but climate/trade risks.",
            effects: { gdpGrowth: 0.3, trapRisk: 5, fdiLinkage: -3, stability: 3 },
            tags: ["+0.3% Growth", "+Trap Risk", "Carbon Tax Risk"],
            setFlags: { energy: "brown" }
          }
        ]
      },
      {
        turn: 15,
        title: "The 2045 Crossroads",
        desc: "The demographic window is closing. This is the final push. What defines Vietnam's legacy?",
        history: {
          real: "Vietnam's path remains unwritten. Current trajectory: GDP per capita ~$4,700 (2024), targeting high-income by 2045. R&D spending is only 0.4% of GDP (vs 2%+ needed). FDI still dominates exports (~74%). The demographic dividend ends around 2035-40. Time is running out.",
          realChoice: -1,
          realGdp: 10500,
          source: "World Bank Vietnam 2045 Report",
          verdict: "pending",
          verdictText: "The ultimate test. Vietnam must boost R&D from 0.4% to 2%+ of GDP and build innovation capacity before the demographic window closes in 2036."
        },
        branchEffects: {
          condition: (flags) => flags.tech === "domestic" && flags.education === "upgraded",
          boost: 0,
          boostText: "Your education investments pay off! Innovation pivot has a much higher chance of success."
        },
        choices: [
          {
            id: "innovation",
            title: "Innovation Economy Pivot",
            desc: "R&D at 2%+ of GDP, startup ecosystem, university autonomy. Accept slower near-term growth.",
            effects: { gdpGrowth: -0.3, trapRisk: -20, fdiLinkage: 15, inequality: 0.02 },
            tags: ["Investment Phase", "----Trap Risk", "Innovation Path"],
            setFlags: { endgame: "innovation" },
            altHistory: "This is the path South Korea took in the 1990s-2000s, accepting slower growth to build innovation capacity. Korea's R&D jumped from 1% to 4%+ of GDP, enabling the leap from $8,000 to $35,000+ GDP per capita. It's the only proven path to high-income status for manufacturing-based economies."
          },
          {
            id: "manufacturing",
            title: "Double Down on Manufacturing",
            desc: "Maximize the remaining labor advantage. Extract every dollar from the current model.",
            effects: { gdpGrowth: 1.5, trapRisk: 15, fdiLinkage: -8, inequality: 0.03 },
            tags: ["+1.5% Growth", "+++Trap Risk", "Assembly Trap"],
            setFlags: { endgame: "manufacturing" },
            altHistory: "This is Thailand's current trajectory—stuck at ~$7,000-8,000 GDP per capita for two decades. Productivity growth just 2.6% (2016-23). As wages rise and demographics shift, the country becomes uncompetitive in assembly but lacks skills for innovation. The classic middle-income trap that 75% of countries never escape."
          }
        ]
      }
    ];

    // Random events that can trigger
    const events = [
      {
        id: "asian_crisis",
        trigger: (s) => s.turn === 4 && Math.random() > 0.5,
        icon: "&#x1F4C9;",
        title: "Asian Financial Crisis",
        desc: "Thailand's currency collapses. Regional contagion spreads. FDI dries up temporarily.",
        effects: { gdpGrowth: -1.5, stability: -10 }
      },
      {
        id: "wto_boom",
        trigger: (s) => s.turn === 7 && s.choices.includes("Full WTO Accession"),
        icon: "&#x1F4C8;",
        title: "WTO Dividend",
        desc: "FDI floods in after WTO accession. Samsung announces a $1B factory.",
        effects: { gdpGrowth: 1.5, fdiLinkage: -3 }
      },
      {
        id: "vinashin_collapse",
        trigger: (s) => s.turn === 9 && s.choices.includes("Back the National Champion"),
        icon: "&#x1F4A5;",
        title: "Vinashin Collapse",
        desc: "The state shipbuilder defaults on $4.5B in debt. Banking system freezes. Crisis mode.",
        effects: { gdpGrowth: -2.0, stability: -15, trapRisk: 10 }
      },
      {
        id: "china_plus_one",
        trigger: (s) => s.turn === 12 && Math.random() > 0.4,
        icon: "&#x1F3ED;",
        title: "China Plus One Wave",
        desc: "US-China trade war accelerates. Companies are relocating supply chains to Vietnam.",
        effects: { gdpGrowth: 2.0, fdiLinkage: -5, trapRisk: -3 }
      },
      {
        id: "tariff_threat",
        trigger: (s) => s.turn === 14 && s.gdpGrowth > 6 && Math.random() > 0.5,
        icon: "&#x26A0;",
        title: "US Tariff Threat",
        desc: "The US threatens 46% tariffs on Vietnamese exports due to the large trade surplus.",
        effects: { gdpGrowth: -1.0, stability: -8 }
      }
    ];

    // DOM Elements
    const elements = {
      startScreen: document.getElementById('sim-start'),
      gameScreen: document.getElementById('sim-game'),
      endScreen: document.getElementById('sim-end'),
      startBtn: document.getElementById('sim-start-btn'),
      restartBtn: document.getElementById('sim-restart-btn'),
      eraBanner: document.getElementById('sim-era-banner'),
      situation: document.getElementById('sim-situation'),
      situationTitle: document.getElementById('sim-situation-title'),
      situationDesc: document.getElementById('sim-situation-desc'),
      choicesContainer: document.getElementById('sim-choices'),
      eventOverlay: document.getElementById('sim-event-overlay'),
      eventIcon: document.getElementById('sim-event-icon'),
      eventTitle: document.getElementById('sim-event-title'),
      eventDesc: document.getElementById('sim-event-desc'),
      eventEffects: document.getElementById('sim-event-effects'),
      eventClose: document.getElementById('sim-event-close'),
      endIcon: document.getElementById('sim-end-icon'),
      endTitle: document.getElementById('sim-end-title'),
      endDesc: document.getElementById('sim-end-desc'),
      finalStats: document.getElementById('sim-final-stats'),
      endAnalysis: document.getElementById('sim-end-analysis'),
      // Metrics
      gdp: document.getElementById('sim-gdp'),
      gdpBar: document.getElementById('sim-gdp-bar'),
      growth: document.getElementById('sim-growth'),
      growthBar: document.getElementById('sim-growth-bar'),
      fdi: document.getElementById('sim-fdi'),
      fdiBar: document.getElementById('sim-fdi-bar'),
      trap: document.getElementById('sim-trap'),
      trapBar: document.getElementById('sim-trap-bar'),
      year: document.getElementById('sim-year'),
      stability: document.getElementById('sim-stability'),
      inequality: document.getElementById('sim-inequality'),
      turn: document.getElementById('sim-turn'),
      // New elements
      timelineProgress: document.getElementById('sim-timeline-progress'),
      playerPath: document.getElementById('sim-player-path'),
      playerArea: document.getElementById('sim-player-area'),
      historyReveal: document.getElementById('sim-history-reveal'),
      historyText: document.getElementById('sim-history-text'),
      historyComparison: document.getElementById('sim-history-comparison'),
      historyContinue: document.getElementById('sim-history-continue')
    };

    // Current decision for history reveal
    let currentDecision = null;
    let currentChoiceIndex = null;

    // Initialize
    // Tooltip content definitions
    const tooltipContent = {
      gdp: `<strong>GDP per Capita</strong>Your country's total economic output divided by population. Goal: reach $13,000+ (high-income threshold) by 2045.`,
      growth: `<strong>GDP Growth Rate</strong>How fast your economy is growing annually. Higher is better, but growth without linkages can create a "dual economy."`,
      fdi: `<strong>FDI Linkage</strong>How connected foreign investment is to domestic firms. High linkage = technology transfer and local supplier development. Low linkage = "screwdriver economy" where value stays foreign.`,
      trap: `<strong>Middle-Income Trap Risk</strong>The danger of stagnating at $4,000-12,000 GDP per capita. Countries get stuck when wages rise faster than productivity, losing competitiveness in low-cost manufacturing before developing innovation capacity. Thailand and Malaysia are cautionary examples.`
    };

    function init() {
      elements.startBtn.addEventListener('click', startGame);
      elements.restartBtn.addEventListener('click', restartGame);
      elements.eventClose.addEventListener('click', closeEvent);
      if (elements.historyContinue) {
        elements.historyContinue.addEventListener('click', continueAfterHistory);
      }
      initTooltips();
    }

    // Tooltip functionality
    function initTooltips() {
      const popup = document.getElementById('sim-tooltip-popup');
      const triggers = document.querySelectorAll('.sim-tooltip-trigger');

      triggers.forEach(trigger => {
        trigger.addEventListener('mouseenter', (e) => {
          const key = trigger.getAttribute('data-tooltip');
          const content = tooltipContent[key];
          if (content && popup) {
            popup.innerHTML = content;

            // Position the popup below the metrics section
            const metricsSection = document.querySelector('.sim-metrics');
            const metricsRect = metricsSection ? metricsSection.getBoundingClientRect() : null;
            const triggerRect = trigger.getBoundingClientRect();

            // Center horizontally on the trigger, position below metrics
            const popupWidth = 260;
            let leftPos = triggerRect.left + triggerRect.width/2 - popupWidth/2;

            // Keep within viewport
            if (leftPos < 10) leftPos = 10;
            if (leftPos + popupWidth > window.innerWidth - 10) {
              leftPos = window.innerWidth - popupWidth - 10;
            }

            popup.style.left = leftPos + 'px';
            popup.style.top = (metricsRect ? metricsRect.bottom + 15 : triggerRect.bottom + 15) + 'px';
            popup.classList.add('active');
          }
        });

        trigger.addEventListener('mouseleave', () => {
          if (popup) popup.classList.remove('active');
        });
      });
    }

    function startGame() {
      resetState();
      showScreen('game');
      updateUI();
      updateChart();
      updateTimeline();
      showDecision();
    }

    function restartGame() {
      resetState();
      showScreen('game');
      updateUI();
      updateChart();
      updateTimeline();
      showDecision();
    }

    function resetState() {
      state.year = 1986;
      state.turn = 1;
      state.era = 1;
      state.gdpPerCapita = 200;
      state.gdpGrowth = 2.8;
      state.fdiLinkage = 15;
      state.trapRisk = 25;
      state.stability = 60;
      state.inequality = 0.35;
      state.choices = [];
      state.gdpHistory = [{ year: 1986, gdp: 200 }];
      state.flags = {};
    }

    function showScreen(screen) {
      elements.startScreen.classList.remove('active');
      elements.gameScreen.classList.remove('active');
      elements.endScreen.classList.remove('active');

      if (screen === 'start') elements.startScreen.classList.add('active');
      if (screen === 'game') elements.gameScreen.classList.add('active');
      if (screen === 'end') elements.endScreen.classList.add('active');
    }

    function updateUI() {
      // Update metrics
      elements.gdp.textContent = '$' + formatNumber(Math.round(state.gdpPerCapita));
      elements.gdpBar.style.width = Math.min(100, (state.gdpPerCapita / 13000) * 100) + '%';

      elements.growth.textContent = state.gdpGrowth.toFixed(1) + '%';
      elements.growthBar.style.width = Math.min(100, Math.max(0, state.gdpGrowth * 10)) + '%';

      elements.fdi.textContent = Math.round(state.fdiLinkage) + '%';
      elements.fdiBar.style.width = Math.min(100, state.fdiLinkage) + '%';

      elements.trap.textContent = Math.round(state.trapRisk) + '%';
      elements.trapBar.style.width = Math.min(100, state.trapRisk) + '%';

      elements.year.textContent = state.year;
      elements.stability.textContent = Math.round(state.stability) + '%';
      elements.inequality.textContent = state.inequality.toFixed(2);
      elements.turn.textContent = state.turn;

      // Update era banner
      const era = eras.find(e => state.turn >= e.turns[0] && state.turn <= e.turns[1]);
      if (era) {
        state.era = era.id;
        elements.eraBanner.innerHTML = `
          <span class="sim-era-label">${era.label}</span>
          <span class="sim-era-name">${era.name}</span>
          <span class="sim-era-years">${era.years}</span>
        `;
      }
    }

    function updateTimeline() {
      if (!elements.timelineProgress) return;
      // Timeline spans 1986-2045 (59 years)
      const progress = ((state.year - 1986) / 59) * 100;
      elements.timelineProgress.style.width = Math.min(100, progress) + '%';
    }

    function updateChart() {
      if (!elements.playerPath) return;

      // Convert GDP history to SVG points
      const points = state.gdpHistory.map((d, i) => {
        const x = ((d.year - 1986) / 59) * 400;
        const y = 150 - (Math.min(d.gdp, 15000) / 15000) * 150;
        return `${x},${y}`;
      }).join(' ');

      elements.playerPath.setAttribute('points', points);

      // Create area fill
      if (elements.playerArea && state.gdpHistory.length > 1) {
        const firstPoint = state.gdpHistory[0];
        const lastPoint = state.gdpHistory[state.gdpHistory.length - 1];
        const startX = ((firstPoint.year - 1986) / 59) * 400;
        const endX = ((lastPoint.year - 1986) / 59) * 400;

        const areaPath = `M ${startX},150 L ${points} L ${endX},150 Z`;
        elements.playerArea.setAttribute('d', areaPath);
      }
    }

    function formatNumber(num) {
      if (num >= 1000) {
        return (num / 1000).toFixed(1) + 'k';
      }
      return num.toString();
    }

    function showDecision() {
      const decision = decisions.find(d => d.turn === state.turn);
      if (!decision) {
        endGame();
        return;
      }

      currentDecision = decision;

      // Hide history reveal panel
      if (elements.historyReveal) {
        elements.historyReveal.classList.remove('active');
      }

      elements.situationTitle.textContent = decision.title;
      elements.situationDesc.textContent = decision.desc;

      // Check for branch effects and locked choices
      let branchWarning = '';
      let lockedChoice = -1;
      let boostedChoice = -1;

      if (decision.branchEffects) {
        const be = decision.branchEffects;
        if (be.condition && be.condition(state.flags)) {
          if (be.warning) {
            branchWarning = be.warning;
          }
          if (be.locked !== undefined) {
            lockedChoice = be.locked;
          }
          if (be.boost !== undefined) {
            boostedChoice = be.boost;
          }
        }
      }

      // Create shuffled indices to randomize choice order
      const choiceIndices = decision.choices.map((_, i) => i);
      // Fisher-Yates shuffle
      for (let i = choiceIndices.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [choiceIndices[i], choiceIndices[j]] = [choiceIndices[j], choiceIndices[i]];
      }

      elements.choicesContainer.innerHTML = choiceIndices.map(originalIndex => {
        const choice = decision.choices[originalIndex];
        const isLocked = originalIndex === lockedChoice;
        const isBoosted = originalIndex === boostedChoice;
        let extraClass = '';
        if (isLocked) extraClass = ' locked';
        if (isBoosted) extraClass = ' boosted';

        return `
        <div class="sim-choice${extraClass}" data-choice="${originalIndex}">
          <div class="sim-choice-title">${choice.title}</div>
          <div class="sim-choice-desc">${choice.desc}</div>
          <div class="sim-choice-effects">
            ${choice.tags.map(tag => {
              const isPositive = tag.includes('+') && !tag.includes('-') && !tag.includes('Risk') && !tag.includes('Inequality');
              const isNegative = tag.includes('-') || tag.includes('Risk') || tag.includes('Trap') || tag.includes('Crisis') || tag.includes('Pain') || tag.includes('Cost');
              const cls = isPositive ? 'positive' : (isNegative ? 'negative' : 'neutral');
              return `<span class="sim-effect ${cls}">${tag}</span>`;
            }).join('')}
          </div>
        </div>
      `}).join('');

      // Add branch warning if applicable
      if (branchWarning) {
        const warningHtml = `
          <div class="sim-branch-warning">
            <span class="sim-branch-warning-icon">&#x26A0;</span>
            <span class="sim-branch-warning-text"><strong>Previous choices affect this decision:</strong> ${branchWarning}</span>
          </div>
        `;
        elements.choicesContainer.insertAdjacentHTML('beforeend', warningHtml);
      }

      // Add click handlers
      document.querySelectorAll('.sim-choice:not(.locked)').forEach(el => {
        el.addEventListener('click', () => {
          const choiceIndex = parseInt(el.dataset.choice);
          currentChoiceIndex = choiceIndex;
          makeChoice(decision.choices[choiceIndex], decision);
        });
      });
    }

    function makeChoice(choice, decision) {
      // Record choice
      state.choices.push(choice.title);

      // Set flags from this choice
      if (choice.setFlags) {
        Object.assign(state.flags, choice.setFlags);
      }

      // Apply branch modifiers if applicable
      if (decision.branchEffects) {
        const be = decision.branchEffects;
        if (be.condition && be.condition(state.flags) && be.modifier) {
          applyEffects(be.modifier);
        }
      }

      // Apply choice effects
      applyEffects(choice.effects);

      // Calculate GDP growth for this turn
      calculateGrowth();

      // Update chart and timeline
      updateUI();
      updateChart();
      updateTimeline();

      // Check for events
      const triggeredEvent = events.find(e => e.trigger(state) && !state.choices.includes('event_' + e.id));
      if (triggeredEvent) {
        state.choices.push('event_' + triggeredEvent.id);
        showEvent(triggeredEvent);
      } else {
        // Show history reveal instead of immediately advancing
        showHistoryReveal(decision, currentChoiceIndex);
      }
    }

    function showHistoryReveal(decision, choiceIndex) {
      if (!elements.historyReveal || !decision.history) {
        advanceTurn();
        return;
      }

      const history = decision.history;
      const yourChoice = decision.choices[choiceIndex];
      const realChoice = history.realChoice >= 0 ? decision.choices[history.realChoice].title : "Still unfolding...";
      const matchedHistory = history.realChoice === choiceIndex;

      // Build verdict badge
      let verdictBadge = '';
      if (history.verdict && history.verdictText) {
        const verdictStyles = {
          success: { icon: '✅', color: '#6fcf97', label: 'SUCCESS' },
          mixed: { icon: '⚠️', color: '#f0ad4e', label: 'MIXED RESULTS' },
          mistake: { icon: '❌', color: '#e74c3c', label: 'POLICY ERROR' },
          pending: { icon: '⏳', color: 'rgba(250,247,242,0.6)', label: 'STILL UNFOLDING' }
        };
        const v = verdictStyles[history.verdict] || verdictStyles.pending;
        verdictBadge = `<div style="margin-bottom: 1rem; padding: 0.6rem 0.8rem; background: rgba(${history.verdict === 'mistake' ? '231,76,60' : history.verdict === 'success' ? '111,207,151' : history.verdict === 'mixed' ? '240,173,78' : '250,247,242'},0.1); border-left: 3px solid ${v.color}; border-radius: 4px;">
          <span style="font-size: 0.75rem; font-weight: 700; color: ${v.color}; letter-spacing: 0.05em;">${v.icon} ECONOMIST VERDICT: ${v.label}</span>
          <p style="margin: 0.3rem 0 0 0; font-size: 0.85rem; color: rgba(250,247,242,0.8);">${history.verdictText}</p>
        </div>`;
      }

      // Build history text
      let historyHtml = '';

      if (matchedHistory) {
        // Player chose what Vietnam chose - show what actually happened
        historyHtml = verdictBadge + `<strong style="color: #6fcf97;">You chose the same path as Vietnam.</strong> ` + history.real;
      } else if (history.realChoice >= 0) {
        // Player chose differently - show counterfactual for their choice, then what Vietnam did
        historyHtml = `<strong style="color: var(--gold);">You chose a different path.</strong>`;

        // Show counterfactual for the player's choice if available
        if (yourChoice.altHistory) {
          historyHtml += `<div style="margin: 0.8rem 0; padding: 0.8rem; background: rgba(212,175,55,0.1); border-left: 2px solid var(--gold); border-radius: 4px;">
            <span style="color: var(--gold); font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em;">What might have happened:</span>
            <p style="margin: 0.4rem 0 0 0; color: rgba(250,247,242,0.85);">${yourChoice.altHistory}</p>
          </div>`;
        }

        historyHtml += verdictBadge + `<div style="margin-top: 0.8rem;">
          <span style="color: rgba(250,247,242,0.6); font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em;">What Vietnam actually did:</span>
          <p style="margin: 0.4rem 0 0 0;">${history.real}</p>
        </div>`;
      } else {
        // Future decision (realChoice = -1), history is still unwritten
        historyHtml = verdictBadge + `<strong style="color: rgba(250,247,242,0.7);">This decision is still playing out.</strong> ` + history.real;
      }

      elements.historyText.innerHTML = historyHtml;

      // Build comparison stats
      const realGdpAtPoint = history.realGdp || 0;
      elements.historyComparison.innerHTML = `
        <div class="sim-comparison-stat">
          <span class="sim-comparison-label">Your GDP</span>
          <div class="sim-comparison-values">
            <span class="sim-comparison-yours">$${formatNumber(Math.round(state.gdpPerCapita))}</span>
          </div>
        </div>
        <div class="sim-comparison-stat">
          <span class="sim-comparison-label">Real Vietnam (${state.year})</span>
          <div class="sim-comparison-values">
            <span class="sim-comparison-real">$${formatNumber(realGdpAtPoint)}</span>
          </div>
        </div>
        <div class="sim-comparison-stat">
          <span class="sim-comparison-label">Source</span>
          <div class="sim-comparison-values">
            <span class="sim-comparison-real" style="font-size: 0.7rem;">${history.source}</span>
          </div>
        </div>
      `;

      elements.historyReveal.classList.add('active');
      elements.choicesContainer.style.display = 'none';
    }

    function continueAfterHistory() {
      elements.historyReveal.classList.remove('active');
      elements.choicesContainer.style.display = 'grid';

      // Check for random events after history reveal
      const triggeredEvent = events.find(e => e.trigger(state) && !state.choices.includes('event_' + e.id));
      if (triggeredEvent) {
        state.choices.push('event_' + triggeredEvent.id);
        showEvent(triggeredEvent);
      } else {
        advanceTurn();
      }
    }

    function applyEffects(effects) {
      if (effects.gdpGrowth) state.gdpGrowth += effects.gdpGrowth;
      if (effects.fdiLinkage) state.fdiLinkage = Math.max(0, Math.min(100, state.fdiLinkage + effects.fdiLinkage));
      if (effects.trapRisk) state.trapRisk = Math.max(0, Math.min(100, state.trapRisk + effects.trapRisk));
      if (effects.stability) state.stability = Math.max(0, Math.min(100, state.stability + effects.stability));
      if (effects.inequality) state.inequality = Math.max(0.2, Math.min(0.6, state.inequality + effects.inequality));
    }

    function calculateGrowth() {
      // Base growth calculation
      let effectiveGrowth = state.gdpGrowth;

      // Stability penalty
      if (state.stability < 40) {
        effectiveGrowth *= 0.7;
      }

      // High trap risk penalty (diminishing returns)
      if (state.trapRisk > 60 && state.gdpPerCapita > 4000) {
        effectiveGrowth *= 0.8;
      }

      // Apply growth
      const growthMultiplier = 1 + (effectiveGrowth / 100);
      state.gdpPerCapita *= growthMultiplier;

      // Era-based year progression
      const yearsPerTurn = state.era === 1 ? 3 : (state.era === 2 ? 3 : 4);
      state.year += yearsPerTurn;

      // Record GDP history for chart
      state.gdpHistory.push({ year: state.year, gdp: state.gdpPerCapita });

      // Natural trap risk increase as income rises
      if (state.gdpPerCapita > 4000 && state.gdpPerCapita < 12000) {
        state.trapRisk += 2;
      }

      // FDI linkage decay without investment
      if (state.fdiLinkage > 20) {
        state.fdiLinkage -= 1;
      }
    }

    function showEvent(event) {
      elements.eventIcon.innerHTML = event.icon;
      elements.eventTitle.textContent = event.title;
      elements.eventDesc.textContent = event.desc;

      elements.eventEffects.innerHTML = Object.entries(event.effects).map(([key, val]) => {
        const labels = {
          gdpGrowth: 'Growth',
          fdiLinkage: 'FDI Linkage',
          trapRisk: 'Trap Risk',
          stability: 'Stability'
        };
        const isPositive = (key === 'trapRisk' ? val < 0 : val > 0);
        const cls = isPositive ? 'positive' : 'negative';
        const sign = val > 0 ? '+' : '';
        return `<span class="sim-effect ${cls}">${labels[key] || key}: ${sign}${val}</span>`;
      }).join('');

      applyEffects(event.effects);
      elements.eventOverlay.classList.add('active');
    }

    function closeEvent() {
      elements.eventOverlay.classList.remove('active');
      // If we came from a choice, show history reveal
      if (currentDecision && currentDecision.history) {
        showHistoryReveal(currentDecision, currentChoiceIndex);
      } else {
        advanceTurn();
      }
    }

    function advanceTurn() {
      state.turn++;
      updateUI();
      updateChart();
      updateTimeline();

      // Check end conditions
      if (state.turn > state.maxTurns || state.trapRisk >= 100 || state.stability <= 0) {
        endGame();
      } else {
        showDecision();
      }
    }

    function endGame() {
      showScreen('end');

      const escaped = state.gdpPerCapita >= 13000 && state.trapRisk < 80;
      const trapped = state.trapRisk >= 80 || (state.gdpPerCapita < 13000 && state.gdpPerCapita > 4000);
      const collapsed = state.stability <= 0;

      let outcome, icon, desc;

      if (collapsed) {
        outcome = "Economic Collapse";
        icon = "&#x1F4A5;";
        desc = "Political instability overwhelmed the economy. Reform without stability leads to chaos.";
      } else if (escaped) {
        outcome = "High-Income Nation!";
        icon = "&#x1F31F;";
        desc = "Vietnam escaped the middle-income trap and achieved high-income status. You beat the 1-in-4 odds.";
      } else if (trapped) {
        outcome = "Stuck in the Trap";
        icon = "&#x26D4;";
        desc = "Vietnam achieved growth but failed to escape the middle-income trap. Like Thailand and Malaysia, structural weaknesses capped potential.";
      } else {
        outcome = "Slow Progress";
        icon = "&#x23F3;";
        desc = "Vietnam grew but didn't reach middle-income levels. More aggressive reform was needed.";
      }

      elements.endIcon.innerHTML = icon;
      elements.endTitle.innerHTML = `<span class="${escaped ? 'sim-outcome-win' : 'sim-outcome-lose'}">${outcome}</span>`;
      elements.endDesc.textContent = desc;

      elements.finalStats.innerHTML = `
        <div class="sim-final-stat">
          <div class="sim-final-stat-value">$${formatNumber(Math.round(state.gdpPerCapita))}</div>
          <div class="sim-final-stat-label">Final GDP per Capita</div>
        </div>
        <div class="sim-final-stat">
          <div class="sim-final-stat-value">${Math.round(state.trapRisk)}%</div>
          <div class="sim-final-stat-label">Trap Risk</div>
        </div>
        <div class="sim-final-stat">
          <div class="sim-final-stat-value">${Math.round(state.fdiLinkage)}%</div>
          <div class="sim-final-stat-label">FDI Linkage</div>
        </div>
        <div class="sim-final-stat">
          <div class="sim-final-stat-value">${state.inequality.toFixed(2)}</div>
          <div class="sim-final-stat-label">Inequality (Gini)</div>
        </div>
      `;

      // Analysis based on choices
      let analysis = "";
      if (state.fdiLinkage >= 40) {
        analysis = "Your focus on domestic linkages helped avoid the dual economy problem that plagues Vietnam today. ";
      } else {
        analysis = "The weak linkages between FDI and domestic firms mirror Vietnam's real 'screwdriver economy' challenge. ";
      }

      if (state.trapRisk >= 60) {
        analysis += "High trap risk reflects over-reliance on assembly and insufficient investment in innovation and skills.";
      } else {
        analysis += "Managing trap risk through education, R&D, and institutional reform was key to your success.";
      }

      elements.endAnalysis.innerHTML = `
        <h4>Analysis</h4>
        <p>${analysis}</p>
      `;

      // Generate scorecard
      generateScorecard();
    }

    function generateScorecard() {
      const scorecard = document.getElementById('sim-scorecard');
      if (!scorecard) return;

      let sameAsVietnam = 0;
      let avoidedMistakes = 0;
      let totalMistakes = 0;
      let rows = '';

      decisions.forEach((decision, index) => {
        if (index >= state.choices.length) return; // Haven't reached this decision

        const playerChoiceTitle = state.choices[index];
        const history = decision.history;
        const realChoiceIndex = history.realChoice;
        const realChoiceTitle = realChoiceIndex >= 0 ? decision.choices[realChoiceIndex].title : null;
        const playerChoiceIndex = decision.choices.findIndex(c => c.title === playerChoiceTitle);

        const matchedVietnam = playerChoiceTitle === realChoiceTitle;
        const verdict = history.verdict;

        // Track statistics
        if (matchedVietnam) sameAsVietnam++;
        if (verdict === 'mistake') {
          totalMistakes++;
          if (!matchedVietnam) avoidedMistakes++;
        }

        // Verdict icon
        let verdictIcon = '';
        if (verdict === 'success') verdictIcon = '✅';
        else if (verdict === 'mixed') verdictIcon = '⚠️';
        else if (verdict === 'mistake') verdictIcon = '❌';
        else verdictIcon = '⏳';

        // Match status
        let matchText = '';
        let matchClass = '';
        if (realChoiceIndex < 0) {
          matchText = 'Still unfolding';
          matchClass = '';
        } else if (matchedVietnam) {
          matchText = 'Same as Vietnam';
          matchClass = 'same';
        } else if (verdict === 'mistake') {
          matchText = '✓ You avoided Vietnam\'s mistake';
          matchClass = 'better';
        } else {
          matchText = 'Different path';
          matchClass = 'different';
        }

        rows += `
          <div class="sim-scorecard-row">
            <span class="sim-scorecard-turn">T${index + 1}</span>
            <span class="sim-scorecard-verdict">${verdictIcon}</span>
            <div class="sim-scorecard-content">
              <div class="sim-scorecard-title">${decision.title}</div>
              <div class="sim-scorecard-match ${matchClass}">${matchText}</div>
            </div>
          </div>
        `;
      });

      const summaryText = `${sameAsVietnam}/${state.choices.length} same • ${avoidedMistakes}/${totalMistakes} mistakes avoided`;

      scorecard.innerHTML = `
        <h4>
          Decision Scorecard
          <span class="sim-scorecard-summary">${summaryText}</span>
        </h4>
        ${rows}
      `;
    }

    // Start the simulator
    init();
  })();
</script>
</body>
</html>
